<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Técnicas Não Paramétricas – Análise de Sobrevivência</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./CIII_ModelProb.html" rel="next">
<link href="./CI_ConceitosBasicos.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CII_EstimNaoParam.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Técnicas Não Paramétricas</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Análise de Sobrevivência</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/csilv7/ANALISE_DE_SOBREVIVENCIA" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Análise-de-Sobrevivência.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Análise-de-Sobrevivência.docx">
              <i class="bi bi-file-word pe-1"></i>
            Download Docx
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Alternar modo escuro"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CI_ConceitosBasicos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Conceitos Básicos e Exemplos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CII_EstimNaoParam.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Técnicas Não Paramétricas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CIII_ModelProb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Técnicas Paramétricas - Modelos Probabilísticos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referêcias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">2.1</span> Introdução</a></li>
  <li><a href="#o-estimador-de-kaplan-meier" id="toc-o-estimador-de-kaplan-meier" class="nav-link" data-scroll-target="#o-estimador-de-kaplan-meier"><span class="header-section-number">2.2</span> O Estimador de Kaplan-Meier</a>
  <ul class="collapse">
  <li><a href="#propriedades-do-estimador-de-kaplan-meier" id="toc-propriedades-do-estimador-de-kaplan-meier" class="nav-link" data-scroll-target="#propriedades-do-estimador-de-kaplan-meier"><span class="header-section-number">2.2.1</span> Propriedades do Estimador de Kaplan-Meier</a></li>
  <li><a href="#variância-do-estimador-de-kaplan-meier" id="toc-variância-do-estimador-de-kaplan-meier" class="nav-link" data-scroll-target="#variância-do-estimador-de-kaplan-meier"><span class="header-section-number">2.2.2</span> Variância do Estimador de Kaplan-Meier</a></li>
  </ul></li>
  <li><a href="#outros-estimadores-não-parâmetricos" id="toc-outros-estimadores-não-parâmetricos" class="nav-link" data-scroll-target="#outros-estimadores-não-parâmetricos"><span class="header-section-number">2.3</span> Outros Estimadores Não Parâmetricos</a>
  <ul class="collapse">
  <li><a href="#estimador-de-nelson-aalen" id="toc-estimador-de-nelson-aalen" class="nav-link" data-scroll-target="#estimador-de-nelson-aalen"><span class="header-section-number">2.3.1</span> Estimador de Nelson-Aalen</a></li>
  </ul></li>
  <li><a href="#comparação-de-curvas-de-sobrevivência" id="toc-comparação-de-curvas-de-sobrevivência" class="nav-link" data-scroll-target="#comparação-de-curvas-de-sobrevivência"><span class="header-section-number">2.4</span> Comparação de Curvas de Sobrevivência</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Técnicas Não Paramétricas</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar o código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Esconder o código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver o código fonte</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
  body{text-align: justify}
</style>
<div class="progress">
<div class="progress-bar" style="width: 100%;">

</div>
</div>
<section id="introdução" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">2.1</span> Introdução</h2>
<p>Este capítulo apresenta as técnicas não-paramétricas utilizadas para a análise de dados de sobrevivência. Essas técnicas são empregadas quando não se faz suposições sobre a forma específica da distribuição dos tempos de falha, sendo particularmente úteis para dados censurados.</p>
</section>
<section id="o-estimador-de-kaplan-meier" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="o-estimador-de-kaplan-meier"><span class="header-section-number">2.2</span> O Estimador de Kaplan-Meier</h2>
<p>Proposto por <span class="citation" data-cites="kaplan1958nonparametric">Kaplan e Meier (<a href="references.html#ref-kaplan1958nonparametric" role="doc-biblioref">1958</a>)</span>. É um estimador não-paramétrico utilizado para estimar a função de sobrevivência, <span class="math inline">\(S(t)\)</span>. Tal estimador também é chamado de de . O Estimador de Kaplan-Meier é uma adaptação a <span class="math inline">\(S(t)\)</span> empiríca que, na ausência de censura nos dados, é definida como:</p>
<p><span class="math display">\[
\hat{S}(t) = \dfrac{\text{nº de observações que não falharam até o tempo } t}{\text{nº total de observações no estudo}}.
\]</span></p>
<p><span class="math inline">\(\hat{S}(t)\)</span> é uma função que tem uma formato gráfico de escada com degraus nos tempos observados de falha de tamanho <span class="math inline">\(1/n\)</span>, onde <span class="math inline">\(n\)</span> é o tamanho amostral.</p>
<p>O processo utilizado até se obter a estimativa de Kaplan-Meier é um processo passo a passo, em que o próximo passo depende do anterior. De forma suscetível, para qualquer <span class="math inline">\(t\)</span>, <span class="math inline">\(S(t)\)</span> pode ser escrito em termos de probabilidades condicionais. Suponha que existam <span class="math inline">\(n\)</span> pacientes no estudo e <span class="math inline">\(k (\leq n)\)</span> falhas distintas nos tempos <span class="math inline">\(t_{1} \leq t_{2} \leq \cdots \leq t_{k}\)</span>. Considerando <span class="math inline">\(S(t)\)</span> uma função discreta com probabilidade maior que zero somente nos tempos de falha <span class="math inline">\(t_{j}\)</span>, <span class="math inline">\(j = 1, \cdots, k\)</span>, tem-se que:</p>
<p><span id="eq-DecomposeSt"><span class="math display">\[
S(t_{j}) = (1 - q_{1}) (1 - q_{2}) \cdots (1 - q_{j}),
\tag{2.1}\]</span></span></p>
<p>em que <span class="math inline">\(q_{j}\)</span> é a probabilidade de um indivíduo morrer no intervalo <span class="math inline">\([t_{j-1}, t{j})\)</span> sabendo que ele não morreu até <span class="math inline">\(t_{j-1}\)</span> e considerando <span class="math inline">\(t_{0} = 0\)</span>. Ou seja, pode se escrever <span class="math inline">\(q_{j}\)</span> como:</p>
<p><span id="eq-FormProbQj"><span class="math display">\[
q_{j} = P(T \in [t_{j-1}, t{j}) | T \geq t_{j-1}),
\tag{2.2}\]</span></span></p>
<p>para <span class="math inline">\(j = 1, \cdots, k\)</span>.</p>
<p>A expressão geral do estimador de Kaplan-Meier pode ser apresentada após estas considerações preliminares, Formalmente, considere:</p>
<ul>
<li><span class="math inline">\(t_{1} \leq t_{2} \leq \cdots \leq t_{k}\)</span>, os <span class="math inline">\(k\)</span> tempos distintos e ordenados de falha;</li>
<li><span class="math inline">\(d_{j}\)</span> o número de falhas em <span class="math inline">\(t_{j}\)</span>, <span class="math inline">\(j = 1, \cdots, k\)</span>;</li>
<li><span class="math inline">\(n_{j}\)</span> o número de indivíduos sob risco em <span class="math inline">\(t_{j}\)</span>, ou seja, os indivíduos que não falharam e não foram censurados até o instante imediatamente anterior a <span class="math inline">\(t_{j}\)</span>.</li>
</ul>
<p>Com isso, pode-se definir o estimador de Kaplan-Meier como:</p>
<p><span id="eq-ESTKaplanMeier"><span class="math display">\[
\hat{S}_{KM}(t) = \prod_{j \text{ : } t_{j} &lt; t} \left( \dfrac{n_{j} - d_{j}}{n_{j}} \right) = \prod_{j \text{ : } t_{j} &lt; t} \left( 1 - \dfrac{d_{j}}{n_{j}} \right)
\tag{2.3}\]</span></span></p>
<p>De forma intuitiva, por assim dizer, a <a href="#eq-ESTKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.3</span></a> é proveniente da <a href="#eq-DecomposeSt" class="quarto-xref">Equação&nbsp;<span>2.1</span></a>, sendo está, uma decomposição de <span class="math inline">\(S(t)\)</span> em termos <span class="math inline">\(q_{j}\)</span>’s. Assim, a <a href="#eq-ESTKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.3</span></a> é justificada se os <span class="math inline">\(q_{j}\)</span>’s forem estimados por <span class="math inline">\(d_{j}/n_{j}\)</span>, que em palavras está expresso na <a href="#eq-FormProbQj" class="quarto-xref">Equação&nbsp;<span>2.2</span></a>. No artigo original de 1958, Kaplan e Meier provam que a <a href="#eq-ESTKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.3</span></a> é um <em>Estimador de Máxima Verossimilhança</em> (EMV) para <span class="math inline">\(S(t)\)</span>. Seguindo certos passos, é possível provar que que <span class="math inline">\(\hat{S}_{KM}(t)\)</span> é EMV de <span class="math inline">\(S(t)\)</span>. Supondo que <span class="math inline">\(d_{j}\)</span> observações falham no tempo tempo <span class="math inline">\(t_{j}\)</span>, para <span class="math inline">\(j = 1, \cdots, k\)</span>, e <span class="math inline">\(m_{j}\)</span> observações são censuradas no intervalo <span class="math inline">\([t{j}, t_{j+1})\)</span>, nos tempos <span class="math inline">\(t_{j1}, \cdots, t_{jm_{j}}\)</span>. A probabilidade de falha no tempo <span class="math inline">\(t_{j}\)</span> é, então,</p>
<p><span class="math display">\[
S(t_{j}) - S(t_{j}+),
\]</span></p>
<p>com <span class="math inline">\(S(t_{j}+) = \lim_{\Delta t \to 0+} S(t_{j} + \Delta t)\)</span>, <span class="math inline">\(j = 1, \cdots, k\)</span>. Por outro lado, a contribuição para a função de verossimilhança de um tempo de sobrevivência censurado em <span class="math inline">\(t_{jl}\)</span> para <span class="math inline">\(l = 1, \cdots, m_{j}\)</span>, é:</p>
<p><span class="math display">\[
P(T &gt; t_{jl}) = S(t_{jl}+).
\]</span></p>
<p>A função de verossimilhança pode, então, ser escrita como:</p>
<p><span class="math display">\[L(S(\cdot)) = \prod_{j = 0}^{k} \left\{ [ S(t_{j}) - S(t_{j}+) ]^{d_{j}} \prod_{l = 1}^{m_{j}} S(t_{jl}+) \right\}.\]</span></p>
<p>Com isso, é possível provar que <span class="math inline">\(S(t)\)</span> que maximiza <span class="math inline">\(L(S(\cdot))\)</span> é exatamente a expressão dada pela <a href="#eq-ESTKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.3</span></a>.</p>
<section id="propriedades-do-estimador-de-kaplan-meier" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="propriedades-do-estimador-de-kaplan-meier"><span class="header-section-number">2.2.1</span> Propriedades do Estimador de Kaplan-Meier</h3>
<p>Como um estimador de máxima verossimilhança, o estimador de Kaplan-Meier têm interessantes propriedades. As principais são:</p>
<ul>
<li>É não-viciado para grandes amostras;</li>
<li>É fracamente consistente;</li>
<li>Converge assintoticamente para um processo gaussiano.</li>
</ul>
<p>A consistência e normalidade assintótica de <span class="math inline">\(\hat{S}_{KM}(t)\)</span> foram provadas sob certas condições de regularidade, por <span class="citation" data-cites="breslow1974large">Breslow e Crowley (<a href="references.html#ref-breslow1974large" role="doc-biblioref">1974</a>)</span> e <span class="citation" data-cites="meier1975estimation">Meier (<a href="references.html#ref-meier1975estimation" role="doc-biblioref">1975</a>)</span> e, no artigo original, <span class="citation" data-cites="kaplan1958nonparametric">Kaplan e Meier (<a href="references.html#ref-kaplan1958nonparametric" role="doc-biblioref">1958</a>)</span> mostram que <span class="math inline">\(\hat{S}_{KM}(t)\)</span> é um EMV para <span class="math inline">\(S(t)\)</span>, como já dito.</p>
</section>
<section id="variância-do-estimador-de-kaplan-meier" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="variância-do-estimador-de-kaplan-meier"><span class="header-section-number">2.2.2</span> Variância do Estimador de Kaplan-Meier</h3>
<p>Para que se possa construir intervalos de confiança e testar hipóteses para <span class="math inline">\(S(t)\)</span>, se faz necessário ter conhecimento quanto variabilidade e precisão do estimador de Kaplan-Meier. Este estimador, assim como outros, está sujeito a variações que devem ser descritas em termos de estimações intervalares. A expressão assintótica do estimador de Kaplan-Meier é dada pela <a href="#eq-VarKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.4</span></a>.</p>
<p><span id="eq-VarKaplanMeier"><span class="math display">\[
\hat{Var}[\hat{S}_{KM}(t)] = [\hat{S}_{KM}(t)]^{2} \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})}
\tag{2.4}\]</span></span></p>
<p>A expressão dada na <a href="#eq-VarKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.4</span></a>, é conhecida como fórmula de Greenwood e pode ser obtida a partir de propriedades do estimador de máxima verossimilhança. Os detalhes da obtenção da (<a href="#eq-VarKaplanMeier" class="quarto-xref">Equação&nbsp;<span>2.4</span></a> estão disponíveis em Kalbfleisch e Prentice (1980, pag. 12-14).</p>
<p>Como <span class="math inline">\(\hat{S}_{KM}(t)\)</span>, para um <span class="math inline">\(t\)</span> fixo, tem distribuição assintóticamente Normal. O intervalo de confiança com <span class="math inline">\(100(1 - \alpha)\)</span>% de confiança para <span class="math inline">\(\hat{S}_{KM}(t)\)</span> é expresso por:</p>
<p><span class="math display">\[
\hat{S}_{KM}(t) \pm z_{\alpha/2} \sqrt{\hat{Var}[\hat{S}_{KM}(t)]}.
\]</span></p>
<p>Vale salientar que para valores extremos de <span class="math inline">\(t\)</span>, este intervalo de confiança pode apresentar limites que não condizem com a teoria de probabilidades. Para solucionar tal problema, aplica-se uma transformação em <span class="math inline">\(S(t)\)</span> como, por exemplo, <span class="math inline">\(\hat{U}(t) = \log{[-\log{(\hat{S}_{KM}(t)})]}\)</span>. Esta transformação foi sugerida por <span class="citation" data-cites="kalbfleisch1980statistical">Kalbfleisch e Prentice (<a href="references.html#ref-kalbfleisch1980statistical" role="doc-biblioref">1980</a>)</span>, tendo sua variância estimada por:</p>
<p><span class="math display">\[
\hat{Var}[\hat{U}(t)] = \dfrac{ \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})} }{ \left[\sum_{j \text{ : } t_{j} &lt; t} \log{\left( \dfrac{n_{j} - d_{j}}{n_{j}} \right)}\right]^{2}} = \dfrac{ \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})} }{ \left[ \log{\hat{S}_{KM}(t)} \right]^{2} }
\]</span></p>
<p>Logo, pode-se aproximar um intervalo com <span class="math inline">\(100 (1 - \alpha)\%\)</span> de confiança para <span class="math inline">\(S(t)\)</span> desta forma:</p>
<p><span class="math display">\[
\left[ \hat{S}(t) \right]^{ \exp\left\{ \pm z_{\alpha / 2} \sqrt{\hat{Var}[\hat{U}(t)]} \right\}}.
\]</span></p>
<p>Veja uma aplicação do Estimador de Kaplan-Meier. Os dados de Leucemia Pediátrica dispostos no Apêndice (A) do livro <em>Análise de Sobrevivência Aplicada</em> de <span class="citation" data-cites="colosimo2006analise">Colosimo e Giolo (<a href="references.html#ref-colosimo2006analise" role="doc-biblioref">2006</a>)</span>. De posse do conjunto de dados, pode-se estimar a curva de sobrevivência, tal curva foi ilustrada na <a href="#fig-SobrKM" class="quarto-xref">Figura&nbsp;<span>2.1</span></a>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] ATIVAÇÃO DE PACOTES</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] IMPORTAÇÃO E AJUSTE DOS DADOS</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Caminho URL para os dados</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura dos dados</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">read.table</span>(url, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] ESTIMADOR DE KAPLAN-MEIER</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>ekm <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(tempos, cens) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dados)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] VISUALIZAÇÃO</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparando os dados para o ggplot2</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>ekm_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> ekm<span class="sc">$</span>time, <span class="at">survival =</span> ekm<span class="sc">$</span>surv,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> ekm<span class="sc">$</span>lower, <span class="at">upper =</span> ekm<span class="sc">$</span>upper)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico com ggplot2</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ekm_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> survival)) <span class="sc">+</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Fonte: https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt"</span>) <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-SobrKM" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-SobrKM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2.1: Curva de Sobrevivência de Kaplan-Meier com IC de 95%
</figcaption>
<div aria-describedby="fig-SobrKM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CII_EstimNaoParam_files/figure-html/fig-SobrKM-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="outros-estimadores-não-parâmetricos" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="outros-estimadores-não-parâmetricos"><span class="header-section-number">2.3</span> Outros Estimadores Não Parâmetricos</h2>
<p>O estimador de Kaplan-Meier é, indiscutivelmente, o mais utilizado para estimar <span class="math inline">\(S(t)\)</span> em análises de sobrevivência. Ele é amplamente disponibilizado em diversos pacotes estatísticos e abordado em inúmeros textos de estatística básica. Entretanto, outros dois estimadores de <span class="math inline">\(S(t)\)</span> também possuem relevância significativa na literatura especializada: o estimador de Nelson-Aalen e o estimador da tabela de vida.</p>
<p>O estimador de Nelson-Aalen, mais recente que o de Kaplan-Meier, apresenta propriedades similares às deste último. Já o estimador da tabela de vida possui importância histórica, tendo sido utilizado em informações derivadas de censos demográficos para estimar características associadas ao tempo de vida humano. Este estimador foi inicialmente proposto por demógrafos e atuários no final do século XIX, sendo empregado principalmente em grandes amostras.</p>
<p>Nesta seção será abordado apenas o estimador de Nelson-Aalen. Para conhecer mais sobre o estimador da Tabela de Vida ou Tabela Atuarial, consulte a Seção 2.4.2 do livro *Análise de Sobrevivência Aplicada** de <span class="citation" data-cites="colosimo2006analise">Colosimo e Giolo (<a href="references.html#ref-colosimo2006analise" role="doc-biblioref">2006</a>)</span>.</p>
<section id="estimador-de-nelson-aalen" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="estimador-de-nelson-aalen"><span class="header-section-number">2.3.1</span> Estimador de Nelson-Aalen</h3>
<p>Mais recente que o estimador de Kaplan-Meier, este estimador se baseia na função de sobrevivência expressa da seguinte forma:</p>
<p><span class="math display">\[
S(t) = \exp\left\{ - \Lambda(t) \right\},
\]</span></p>
<p>em que <span class="math inline">\(\Lambda(t)\)</span> é a função de risco acumulado apresentada na <a href="CI_ConceitosBasicos.html#sec-TaxaAcu" class="quarto-xref"><span>Seção 1.6.3</span></a>.</p>
<p>A estimativa para <span class="math inline">\(\Lambda(t)\)</span> foi inicialmente proposta por <span class="citation" data-cites="nelson1972theory">Nelson (<a href="references.html#ref-nelson1972theory" role="doc-biblioref">1972</a>)</span> posteriormente retomada por <span class="citation" data-cites="aalen1978nonparametric">Aalen (<a href="references.html#ref-aalen1978nonparametric" role="doc-biblioref">1978</a>)</span> que demonstrou suas propriedades assintóticas utilizando processos de contagem. Na literatura, esse estimador é amplamente conhecido como o estimador de Nelson-Aalen e é definido pela seguinte expressão:</p>
<p><span id="eq-ESTNelsonAalen"><span class="math display">\[
\hat{\Lambda}(t) = \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}} \right),
\tag{2.5}\]</span></span></p>
<p>onde <span class="math inline">\(d_{j}\)</span> e <span class="math inline">\(n_{j}\)</span> são as mesmas definições usadas no estimador de Kaplan-Meier. A variância do estimador, conforme proposta por <span class="citation" data-cites="aalen1978nonparametric">Aalen (<a href="references.html#ref-aalen1978nonparametric" role="doc-biblioref">1978</a>)</span>, é dada por:</p>
<p><span id="eq-VarNelsonAalen"><span class="math display">\[
\hat{Var}(\hat{\Lambda}(t)) = \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}^{2}} \right).
\tag{2.6}\]</span></span></p>
<p>Uma alternativa para a estimativa da variância de <span class="math inline">\(\hat{\Lambda}(t)\)</span>, proposta por <span class="citation" data-cites="klein1991small">Klein (<a href="references.html#ref-klein1991small" role="doc-biblioref">1991</a>)</span>, é:</p>
<p><span class="math display">\[
\hat{Var}(\hat{\Lambda}(t)) = \sum_{j:t_{j} &lt; t} \dfrac{(n_{j} - d_{j})d_{j}}{n_{j}^{3}},
\]</span></p>
<p>entretanto, o estimador da <a href="#eq-VarNelsonAalen" class="quarto-xref">Equação&nbsp;<span>2.6</span></a> apresenta menor vício, tornando-o mais preferível que o proposto por <span class="citation" data-cites="klein1991small">Klein (<a href="references.html#ref-klein1991small" role="doc-biblioref">1991</a>)</span>.</p>
<p>Desta forma, podemos definir, com base no estimador de Nelson-Aalen, um estimador para a função de sobrevivência, podendo ser expressa por:</p>
<p><span class="math display">\[
\hat{S}_{NA}(t) = \exp\left\{- \hat{\Lambda}(t) \right\}.
\]</span></p>
<p>Deve-se, a variância deste estimador, a <span class="citation" data-cites="aalen1978empirical">Aalen e Johansen (<a href="references.html#ref-aalen1978empirical" role="doc-biblioref">1978</a>)</span>. Podendo ser mensurada pela expressão:</p>
<p><span class="math display">\[
\hat{Var}(\hat{S}_{NA}(t)) = \left[ \hat{S}_{NA}(t) \right]^{2} \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}^{2}} \right)
\]</span></p>
<p>Vale destacar que o estimador de Nelson-Aalen aprenseta, na maioria dos casos, estimativas próximas ao estimador de Kaplan-Meier. <span class="citation" data-cites="bohoris1994comparison">Bohoris (<a href="references.html#ref-bohoris1994comparison" role="doc-biblioref">1994</a>)</span> mostrou que <span class="math inline">\(\hat{S}_{NA}(t) \geq \hat{S}_{KM}(t)\)</span> para todo <span class="math inline">\(t\)</span>, isto é, as estimativas obtidas pelo estimador de Nelson-Aalen são maiores ou iguais às estimativas obtidas pelo estimador de Kaplan-Meier.</p>
</section>
</section>
<section id="comparação-de-curvas-de-sobrevivência" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="comparação-de-curvas-de-sobrevivência"><span class="header-section-number">2.4</span> Comparação de Curvas de Sobrevivência</h2>
<p>Imagine um problema da área da saúde, onde se desejar comparar dois grupos, um grupo receberá tratamento através do uso de alguma droga e o outro será o grupo controle. Estatísticas mais comumente usadas podem ser vistas como generalizações para dados censurados, de conhecidos testes não-paramétricos. O teste <em>logrank</em> <span class="citation" data-cites="mantel1966evaluation">(<a href="references.html#ref-mantel1966evaluation" role="doc-biblioref">Mantel 1966</a>)</span> é o mais usado em análise de sobrevivência. <span class="citation" data-cites="gehan1965generalized">Gehan (<a href="references.html#ref-gehan1965generalized" role="doc-biblioref">1965</a>)</span> propôs uma generalização para a estatística de Wilcoxon. Outras generalizações foram propostas por <span class="citation" data-cites="peto1972asymptotically">Peto e Peto (<a href="references.html#ref-peto1972asymptotically" role="doc-biblioref">1972</a>)</span> e <span class="citation" data-cites="prentice1978linear">Prentice (<a href="references.html#ref-prentice1978linear" role="doc-biblioref">1978</a>)</span>, entre outros. <span class="citation" data-cites="latta1981monte">Latta (<a href="references.html#ref-latta1981monte" role="doc-biblioref">1981</a>)</span> fez uso de simulações de Monte Carlo para comparar vários testes não-paramétricos.</p>
<p>Neste texto, ênfase será dada ao teste <em>logrank</em>. Este teste é muito utilizado em análise de sobrevivência e é particularmente apropriado quando a razão das funções de risco dos grupos a serem comparados é aproximadamente constante. Isto é, as populações têm a propriedade de riscos proporcionais. A estatística deste teste é a diferença entre o número observado de falhas em cada grupo e uma quantidade que, para muitos propósitos, pode ser pensada como o correspondente número esperado de falhas sob a hipótese nula. A expressão do teste <em>logrank</em> é obtida de forma similar a do conhecido teste de <span class="citation" data-cites="mantel1959statistical">Mantel e Haenszel (<a href="references.html#ref-mantel1959statistical" role="doc-biblioref">1959</a>)</span>, para combinar tabelas de contigência. O teste <em>logrank</em> tem, também, a mesma expressão do teste de escore para o modelo de regressão de Cox que será apresentado no […]. Outros testes também são apresentados nesta seção.</p>
<p>Considere, inicialmente, o teste de igualdade de duas funções de sobrevivência <span class="math inline">\(S_{1}(t)\)</span> e <span class="math inline">\(S_{2}(t)\)</span>. Sejam <span class="math inline">\(t_{1} &lt; t_{2} &lt; \cdots &lt; t_{k}\)</span> os tempos de falha distintos da amostra formada pela combinação das duas amostras individuais. Suponha que em um tempo <span class="math inline">\(t_{j}\)</span> aconteçam <span class="math inline">\(d_{j}\)</span> falhas e que <span class="math inline">\(n_{j}\)</span> indivíduos estejam sob risco em um tempo imediatamente inferior a <span class="math inline">\(t_{j}\)</span> na amostra combinada e, respectivamente, <span class="math inline">\(d_{ij}\)</span> e <span class="math inline">\(n_{ij}\)</span> na amostra <span class="math inline">\(i\)</span>; <span class="math inline">\(i = 1, 2\)</span> e <span class="math inline">\(j = 1, \cdots, k\)</span>. Em tempo de falha <span class="math inline">\(t_{j}\)</span>, os dados podem ser dispostos em forma de uma tabela de contigência 2 x 2 com <span class="math inline">\(d_{ij}\)</span> falhas e <span class="math inline">\(n_{ij} - d_{ij}\)</span> sobreviventes na coluna <span class="math inline">\(i\)</span>. Isto é mostrado na <a href="#tbl-ExampleTableContig" class="quarto-xref">Tabela&nbsp;<span>2.1</span></a>.</p>
<div class="cell">
<div id="tbl-ExampleTableContig" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ExampleTableContig-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;2.1: Tabela de contingência gerada no tempo <span class="math inline">\(t_{j}\)</span>.
</figcaption>
<div aria-describedby="tbl-ExampleTableContig-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Grupo 1</th>
<th style="text-align: center;">Grupo 2</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Falha</td>
<td style="text-align: center;"><span class="math inline">\(d_{1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(d_{2j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(d_{j}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Não Falha</td>
<td style="text-align: center;"><span class="math inline">\(n_{1j} - d_{1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{2j} - d_{2j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{j} - d_{j}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(n_{1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{2j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n_{j}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Condicional à experiência de falha e censura até o tempo <span class="math inline">\(t_{j}\)</span> (fixando as marginais de coluna) e ao número de falhas no tempo <span class="math inline">\(t_{j}\)</span> (fixando as marginais de linha), a distribuição de <span class="math inline">\(d_{2j}\)</span> é, então, uma hipergeométrica:</p>
<p><span class="math display">\[
\dfrac{ \binom{ n_{1j} }{ d_{1j} } \binom{ n_{2j} }{ d_{2j} } }{ \binom{ n_{j} }{ d_{j} } },
\]</span></p>
<p>A média de <span class="math inline">\(d_{2j}\)</span> é <span class="math inline">\(w_{2j} = n_{2j} d_{j} n_{j}^{-1}\)</span>, o que equivale a dizer que, se não houver diferença entre as duas populações no tempo <span class="math inline">\(t_{j}\)</span>, o número total de falhas (<span class="math inline">\(d_{j}\)</span>) pode ser dividido entre as duas amostras de acordo com a razão entre o número de indivíduos sob risco em cada amostra e o número total sob risco. A variância de <span class="math inline">\(d_{2j}\)</span> obtida a partir da distribuição hipergeométrica é:</p>
<p><span class="math display">\[
(V_{j})_{2} = n_{2j}(n_{j} - n_{2j})d_{j}(n_{j} - d_{j}) n_{j}^{-2} (n_{j} - 1)^{-1}.
\]</span></p>
<p>Então, a estatística <span class="math inline">\(d_{2j} - w_{2j}\)</span> tem média zero e variância <span class="math inline">\((V_{j})_{2}\)</span>. Se as <span class="math inline">\(k\)</span> tabelas de contingência forem independentes, um teste aproximado para a igualdade das duas funções de sobrevivência pode ser baseado na estatística:</p>
<p><span id="eq-EstTestelogrank"><span class="math display">\[
T = \dfrac{ \left[ \sum_{j = 1}^{k} (d_{2j} - w_{2j}) \right]^{2} }{ \sum_{j = 1}^{k} (V_{j})_{2}  } ,
\tag{2.7}\]</span></span></p>
<p>que, sob a hipótese nula <span class="math inline">\(H_{0}: S_{1}(t) = S_{2}(t)\)</span> para todo <span class="math inline">\(t\)</span> no período de acompanhamento, tem uma distribuição qui-quadrado com <span class="math inline">\(1\)</span> grau de liberdade para grandes amostras.</p>
<p>Com o intuito de exemplificar o teste de <em>logrank</em> com dados reais aplicou-se o mesmo aos dados de Leucemia Pediátrica dispostos no Apêndice (A) do livro <em>Análise de Sobrevivência Aplicada</em> de <span class="citation" data-cites="colosimo2006analise">Colosimo e Giolo (<a href="references.html#ref-colosimo2006analise" role="doc-biblioref">2006</a>)</span>, os mesmo dados usados para gerar a <a href="#fig-SobrKM" class="quarto-xref">Figura&nbsp;<span>2.1</span></a>. No teste executado o obejtivo é testar se a curva de sobrevivência das categorias da covariável <code>r6</code> são iguais, sob as hipóteses:</p>
<p><span class="math display">\[
\begin{cases}
  H_{0}: \text{As curvas de sobrevivência dos grupos são iguais ao longo do tempo.} \\
  H_{1}: \text{As curvas de sobrevivência dos grupos são diferentes ao longo do tempo.}
\end{cases}
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] ATIVAÇÃO DE PACOTES</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] IMPORTAÇÃO E AJUSTES DOS DADOS</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Caminho URL para os dados</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura dos dados</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(url, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Decodificando a coluna r_6</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grupo =</span> <span class="fu">ifelse</span>(r6 <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Category Zero"</span>, <span class="st">"Category One"</span>))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] TESTE DE LOGRANK</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando o Teste de Logrank</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>TestLogrank <span class="ot">&lt;-</span> <span class="fu">survdiff</span>(<span class="fu">Surv</span>(tempos, cens)<span class="sc">~</span>grupo, <span class="at">data =</span> df, <span class="at">rho =</span> <span class="dv">0</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(TestLogrank )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(tempos, cens) ~ grupo, data = df, rho = 0)

                     N Observed Expected (O-E)^2/E (O-E)^2/V
grupo=Category One  95       34    37.16     0.269      5.73
grupo=Category Zero  8        5     1.84     5.429      5.73

 Chisq= 5.7  on 1 degrees of freedom, p= 0.02 </code></pre>
</div>
</div>
<p>Se for fixado o nível de significância em 5%, ou seja, <span class="math inline">\(\alpha = 0,05\)</span>, rejeitamos a hipótese nula. Chega-se a essa conclusão olhando para o <span class="math inline">\(p-valor\)</span> (probabilidade de significância) do teste, mensurado em <span class="math inline">\(p-valor =\)</span> 0.02. Como o <span class="math inline">\(p-valor &lt; \alpha\)</span>, rejeita-se <span class="math inline">\(H_{0}\)</span>, logo, as curvas de sobrevivência dos grupos são diferentes ao longo do tempo, ao nível de significância de 5%.</p>
<p>A generalização do teste <em>logrank</em> para a igualdade de <span class="math inline">\(r &gt; 2\)</span> funções de sobrevivência <span class="math inline">\(S_{1}(t), S_{2}(t), ..., S_{r}(t)\)</span> não é complicada. Considere a mesma notação anterior, com o índice <span class="math inline">\(i\)</span> variando, agora, entre <span class="math inline">\(1\)</span> e <span class="math inline">\(r\)</span>. Desta forma, os dados podem ser arranjados em forma de uma tabela de contingência 2 x <span class="math inline">\(r\)</span> falhas <span class="math inline">\(d_{ij}\)</span> e <span class="math inline">\(n_{ij} - d_{ij}\)</span> sobreviventes na coluna <span class="math inline">\(i\)</span>. Ou seja, a <a href="#tbl-ExampleTableContig" class="quarto-xref">Tabela&nbsp;<span>2.1</span></a> passaria a ter <span class="math inline">\(r\)</span> colunas em vez de simplesmente duas.</p>
<div class="progress">
<div class="progress-bar" style="width: 100%;">

</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-aalen1978nonparametric" class="csl-entry" role="listitem">
Aalen, Odd O. 1978. <span>«Nonparametric Inference for a Family of Counting Processes»</span>. <em>Annals of Statistics</em> 6 (4): 701–26. <a href="https://doi.org/10.1214/aos/1176344247">https://doi.org/10.1214/aos/1176344247</a>.
</div>
<div id="ref-aalen1978empirical" class="csl-entry" role="listitem">
Aalen, Odd O., e Søren Johansen. 1978. <span>«An Empirical Transition Matrix for Non-Homogeneous Markov Chains Based on Censored Observations»</span>. <em>Scandinavian Journal of Statistics</em> 5 (3): 141–50.
</div>
<div id="ref-bohoris1994comparison" class="csl-entry" role="listitem">
Bohoris, G. A. 1994. <span>«Comparison of the Cumulative-Hazard and Kaplan-Meier Estimators of the Survivor Function»</span>. <em>IEEE Transactions on Reliability</em> 43 (2): 230–32. <a href="https://doi.org/10.1109/24.293488">https://doi.org/10.1109/24.293488</a>.
</div>
<div id="ref-breslow1974large" class="csl-entry" role="listitem">
Breslow, Norman, e John Crowley. 1974. <span>«A Large Sample Study of the Life Table and Product Limit Estimates under Random Censorship»</span>. <em>The Annals of Statistics</em> 2 (3): 437–53. <a href="https://doi.org/10.1214/aos/1176342705">https://doi.org/10.1214/aos/1176342705</a>.
</div>
<div id="ref-colosimo2006analise" class="csl-entry" role="listitem">
Colosimo, Enrico Antonio, e Suely Ruiz Giolo. 2006. <em>Análise de Sobrevivência Aplicada</em>. 1.ª ed. São Paulo, Brasil: Blucher.
</div>
<div id="ref-gehan1965generalized" class="csl-entry" role="listitem">
Gehan, Edmund A. 1965. <span>«A Generalized Wilcoxon Test for Comparing Arbitrarily Singly-Censored Samples»</span>. <em>Biometrika</em> 52 (1-2): 203–24. <a href="https://doi.org/10.2307/2333825">https://doi.org/10.2307/2333825</a>.
</div>
<div id="ref-kalbfleisch1980statistical" class="csl-entry" role="listitem">
Kalbfleisch, John D., e Ross L. Prentice. 1980. <em>The Statistical Analysis of Failure Time Data</em>. Wiley Series em Probability e Mathematical Statistics. New York: Wiley.
</div>
<div id="ref-kaplan1958nonparametric" class="csl-entry" role="listitem">
Kaplan, Edward L., e Paul Meier. 1958. <span>«Nonparametric Estimation from Incomplete Observations»</span>. <em>Journal of the American Statistical Association</em> 53 (282): 457–81. <a href="https://doi.org/10.1080/01621459.1958.10501452">https://doi.org/10.1080/01621459.1958.10501452</a>.
</div>
<div id="ref-klein1991small" class="csl-entry" role="listitem">
Klein, John P. 1991. <span>«Small Sample Moments of Some Estimators of the Variance of the Kaplan-Meier and Nelson-Aalen Estimators»</span>. <em>Scandinavian Journal of Statistics</em> 18 (4): 333–40. <a href="https://doi.org/10.2307/4616203">https://doi.org/10.2307/4616203</a>.
</div>
<div id="ref-latta1981monte" class="csl-entry" role="listitem">
Latta, Robert B. 1981. <span>«A Monte Carlo Study of Some Two-Sample Rank Tests with Censored Data»</span>. <em>Journal of the American Statistical Association</em> 76 (375): 713–19. <a href="https://doi.org/10.2307/2287572">https://doi.org/10.2307/2287572</a>.
</div>
<div id="ref-mantel1966evaluation" class="csl-entry" role="listitem">
Mantel, Nathan. 1966. <span>«Evaluation of Survival Data and Two New Rank Order Statistics Arising in Its Consideration»</span>. <em>Cancer Chemotherapy Reports</em> 50 (3): 163–70.
</div>
<div id="ref-mantel1959statistical" class="csl-entry" role="listitem">
Mantel, Nathan, e William Haenszel. 1959. <span>«Statistical Aspects of the Analysis of Data from Retrospective Studies of Disease»</span>. <em>Journal of the National Cancer Institute</em> 22 (4): 719–48.
</div>
<div id="ref-meier1975estimation" class="csl-entry" role="listitem">
Meier, Paul. 1975. <span>«Estimation of a Survival Curve from Incomplete Data»</span>. <em>Journal of the American Statistical Association</em> 70 (351): 607–10. <a href="https://doi.org/10.1080/01621459.1975.10479872">https://doi.org/10.1080/01621459.1975.10479872</a>.
</div>
<div id="ref-nelson1972theory" class="csl-entry" role="listitem">
Nelson, Wayne. 1972. <span>«Theory and Applications of Hazard Plotting for Censored Failure Data»</span>. <em>Technometrics</em> 14 (4): 945–66. <a href="https://doi.org/10.1080/00401706.1972.10488981">https://doi.org/10.1080/00401706.1972.10488981</a>.
</div>
<div id="ref-peto1972asymptotically" class="csl-entry" role="listitem">
Peto, Richard, e Julian Peto. 1972. <span>«Asymptotically Efficient Rank Invariant Test Procedures»</span>. <em>Journal of the Royal Statistical Society: Series A (General)</em> 135 (2): 185–98. <a href="https://doi.org/10.2307/2344317">https://doi.org/10.2307/2344317</a>.
</div>
<div id="ref-prentice1978linear" class="csl-entry" role="listitem">
Prentice, Ross L. 1978. <span>«Linear Rank Tests with Right Censored Data»</span>. <em>Biometrika</em> 65 (1): 167–79. <a href="https://doi.org/10.2307/2335206">https://doi.org/10.2307/2335206</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./CI_ConceitosBasicos.html" class="pagination-link" aria-label="Conceitos Básicos e Exemplos">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Conceitos Básicos e Exemplos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./CIII_ModelProb.html" class="pagination-link" aria-label="Técnicas Paramétricas - Modelos Probabilísticos">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Técnicas Paramétricas - Modelos Probabilísticos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Código fonte</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb4" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="in">  body{text-align: justify}</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>:::: progress</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>:::: {.progress-bar style="width: 100%;"}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Técnicas Não Paramétricas</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introdução</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>Este capítulo apresenta as técnicas não-paramétricas utilizadas para a análise de dados de sobrevivência. Essas técnicas são empregadas quando não se faz suposições sobre a forma específica da distribuição dos tempos de falha, sendo particularmente úteis para dados censurados.</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## O Estimador de Kaplan-Meier</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>Proposto por @kaplan1958nonparametric. É um estimador não-paramétrico utilizado para estimar a função de sobrevivência, $S(t)$. Tal estimador também é chamado de de \textit{estimador limite-produto}. O Estimador de Kaplan-Meier é uma adaptação a $S(t)$ empiríca que, na ausência de censura nos dados, é definida como:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>\hat{S}(t) = \dfrac{\text{nº de observações que não falharam até o tempo } t}{\text{nº total de observações no estudo}}.</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>\noindent $\hat{S}(t)$ é uma função que tem uma formato gráfico de escada com degraus nos tempos observados de falha de tamanho $1/n$, onde $n$ é o tamanho amostral.</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>O processo utilizado até se obter a estimativa de Kaplan-Meier é um processo passo a passo, em que o próximo passo depende do anterior. De forma suscetível, para qualquer $t$, $S(t)$ pode ser escrito em termos de probabilidades condicionais. Suponha que existam $n$ pacientes no estudo e $k (\leq n)$ falhas distintas nos tempos $t_{1} \leq t_{2} \leq \cdots \leq t_{k}$. Considerando $S(t)$ uma função discreta com probabilidade maior que zero somente nos tempos de falha $t_{j}$, $j = 1, \cdots, k$, tem-se que:</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>S(t_{j}) = (1 - q_{1}) (1 - q_{2}) \cdots (1 - q_{j}),</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>$$ {#eq-DecomposeSt}</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>\noindent em que $q_{j}$ é a probabilidade de um indivíduo morrer no intervalo $[t_{j-1}, t{j})$ sabendo que ele não morreu até $t_{j-1}$ e considerando $t_{0} = 0$. Ou seja, pode se escrever $q_{j}$ como:</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>q_{j} = P(T \in [t_{j-1}, t{j}) | T \geq t_{j-1}),</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>$$ {#eq-FormProbQj}</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>\noindent para $j = 1, \cdots, k$.</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>A expressão geral do estimador de Kaplan-Meier pode ser apresentada após estas considerações preliminares, Formalmente, considere:</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$t_{1} \leq t_{2} \leq \cdots \leq t_{k}$, os $k$ tempos distintos e ordenados de falha;</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$d_{j}$ o número de falhas em $t_{j}$, $j = 1, \cdots, k$;</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$n_{j}$ o número de indivíduos sob risco em $t_{j}$, ou seja, os indivíduos que não falharam e não foram censurados até o instante imediatamente anterior a $t_{j}$.</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>Com isso, pode-se definir o estimador de Kaplan-Meier como:</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>\hat{S}_{KM}(t) = \prod_{j \text{ : } t_{j} &lt; t} \left( \dfrac{n_{j} - d_{j}}{n_{j}} \right) = \prod_{j \text{ : } t_{j} &lt; t} \left( 1 - \dfrac{d_{j}}{n_{j}} \right)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ESTKaplanMeier}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>De forma intuitiva, por assim dizer, a @eq-ESTKaplanMeier é proveniente da @eq-DecomposeSt, sendo está, uma decomposição de $S(t)$ em termos $q_{j}$'s. Assim, a @eq-ESTKaplanMeier é justificada se os $q_{j}$'s forem estimados por $d_{j}/n_{j}$, que em palavras está expresso na @eq-FormProbQj. No artigo original de 1958, Kaplan e Meier provam que a @eq-ESTKaplanMeier é um *Estimador de Máxima Verossimilhança* (EMV) para $S(t)$. Seguindo certos passos, é possível provar que que $\hat{S}_{KM}(t)$ é EMV de $S(t)$. Supondo que $d_{j}$ observações falham no tempo tempo $t_{j}$, para $j = 1, \cdots, k$, e $m_{j}$ observações são censuradas no intervalo $[t{j}, t_{j+1})$, nos tempos $t_{j1}, \cdots, t_{jm_{j}}$. A probabilidade de falha no tempo $t_{j}$ é, então,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>S(t_{j}) - S(t_{j}+),</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>\noindent com $S(t_{j}+) = \lim_{\Delta t \to 0+} S(t_{j} + \Delta t)$, $j = 1, \cdots, k$. Por outro lado, a contribuição para a função de verossimilhança de um tempo de sobrevivência censurado em $t_{jl}$ para $l = 1, \cdots, m_{j}$, é:</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>P(T &gt; t_{jl}) = S(t_{jl}+).</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>A função de verossimilhança pode, então, ser escrita como:</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>$$L(S(\cdot)) = \prod_{j = 0}^{k} \left<span class="sc">\{</span> <span class="co">[</span><span class="ot"> S(t_{j}) - S(t_{j}+) </span><span class="co">]</span>^{d_{j}} \prod_{l = 1}^{m_{j}} S(t_{jl}+) \right<span class="sc">\}</span>.$$</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>\noindent Com isso, é possível provar que $S(t)$ que maximiza $L(S(\cdot))$ é exatamente a expressão dada pela @eq-ESTKaplanMeier.</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="fu">### Propriedades do Estimador de Kaplan-Meier</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>Como um estimador de máxima verossimilhança, o estimador de Kaplan-Meier têm interessantes propriedades. As principais são:</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>É não-viciado para grandes amostras;</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>É fracamente consistente;</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Converge assintoticamente para um processo gaussiano.</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>A consistência e normalidade assintótica de $\hat{S}_{KM}(t)$ foram provadas sob certas condições de regularidade, por @breslow1974large e @meier1975estimation e, no artigo original, @kaplan1958nonparametric mostram que $\hat{S}_{KM}(t)$ é um EMV para $S(t)$, como já dito.</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variância do Estimador de Kaplan-Meier</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>Para que se possa construir intervalos de confiança e testar hipóteses para $S(t)$, se faz necessário ter conhecimento quanto variabilidade e precisão do estimador de Kaplan-Meier. Este estimador, assim como outros, está sujeito a variações que devem ser descritas em termos de estimações intervalares. A expressão assintótica do estimador de Kaplan-Meier é dada pela @eq-VarKaplanMeier.</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>\hat{Var}<span class="co">[</span><span class="ot">\hat{S}_{KM}(t)</span><span class="co">]</span> = <span class="co">[</span><span class="ot">\hat{S}_{KM}(t)</span><span class="co">]</span>^{2} \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})}</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>$$ {#eq-VarKaplanMeier}</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>A expressão dada na @eq-VarKaplanMeier, é conhecida como fórmula de Greenwood e pode ser obtida a partir de propriedades do estimador de máxima verossimilhança. Os detalhes da obtenção da (@eq-VarKaplanMeier estão disponíveis em Kalbfleisch e Prentice (1980, pag. 12-14).</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>Como $\hat{S}_{KM}(t)$, para um $t$ fixo, tem distribuição assintóticamente Normal. O intervalo de confiança com $100(1 - \alpha)$% de confiança para $\hat{S}_{KM}(t)$ é expresso por:</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>\hat{S}_{KM}(t) \pm z_{\alpha/2} \sqrt{\hat{Var}[\hat{S}_{KM}(t)]}.</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>Vale salientar que para valores extremos de $t$, este intervalo de confiança pode apresentar limites que não condizem com a teoria de probabilidades. Para solucionar tal problema, aplica-se uma transformação em $S(t)$ como, por exemplo, $\hat{U}(t) = \log{<span class="co">[</span><span class="ot">-\log{(\hat{S}_{KM}(t)})</span><span class="co">]</span>}$. Esta transformação foi sugerida por @kalbfleisch1980statistical, tendo sua variância estimada por:</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>\hat{Var}<span class="co">[</span><span class="ot">\hat{U}(t)</span><span class="co">]</span> = \dfrac{ \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})} }{ \left<span class="co">[</span><span class="ot">\sum_{j \text{ : } t_{j} &lt; t} \log{\left( \dfrac{n_{j} - d_{j}}{n_{j}} \right)}\right</span><span class="co">]</span>^{2}} = \dfrac{ \sum_{j \text{ : } t_{j} &lt; t} \dfrac{d_{j}}{n_{j} (n_{j} - d_{j})} }{ \left<span class="co">[</span><span class="ot"> \log{\hat{S}_{KM}(t)} \right</span><span class="co">]</span>^{2} }</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>Logo, pode-se aproximar um intervalo com $100 (1 - \alpha)\%$ de confiança para $S(t)$ desta forma:</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot"> \hat{S}(t) \right</span><span class="co">]</span>^{ \exp\left<span class="sc">\{</span> \pm z_{\alpha / 2} \sqrt{\hat{Var}<span class="co">[</span><span class="ot">\hat{U}(t)</span><span class="co">]</span>} \right<span class="sc">\}</span>}.</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>Veja uma aplicação do Estimador de Kaplan-Meier. Os dados de Leucemia Pediátrica dispostos no Apêndice (A) do livro *Análise de Sobrevivência Aplicada* de @colosimo2006analise. De posse do conjunto de dados, pode-se estimar a curva de sobrevivência, tal curva foi ilustrada na @fig-SobrKM.</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Curva de Sobrevivência de Kaplan-Meier com IC de 95%"</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-SobrKM</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="in"># [1] ATIVAÇÃO DE PACOTES</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="in">library(survival)</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="in"># ---------------------------------</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="in"># [2] IMPORTAÇÃO E AJUSTE DOS DADOS</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="in"># ---------------------------------</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="in"># Caminho URL para os dados</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="in">url &lt;- "https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt"</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="in"># Leitura dos dados</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="in">dados &lt;- read.table(url, header = TRUE)</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------------</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="in"># [3] ESTIMADOR DE KAPLAN-MEIER</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------------</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="in">ekm &lt;- survfit(Surv(tempos, cens) ~ 1, data = dados)</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="in"># [4] VISUALIZAÇÃO</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="in"># Preparando os dados para o ggplot2</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="in">ekm_data &lt;- data.frame(time = ekm$time, survival = ekm$surv,</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="in">  lower = ekm$lower, upper = ekm$upper)</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="in"># Gráfico com ggplot2</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ekm_data, aes(x = time, y = survival)) +</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(color = "blue", lwd = 1.2) +</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "blue", alpha = 0.2) +</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Tempo", y = "Probabilidade de Sobrevivência",</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Fonte: https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt") +</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_size = 12) +</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="in">  theme( plot.caption = element_text(hjust = 0.5, size = 12))</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outros Estimadores Não Parâmetricos</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>O estimador de Kaplan-Meier é, indiscutivelmente, o mais utilizado para estimar $S(t)$ em análises de sobrevivência. Ele é amplamente disponibilizado em diversos pacotes estatísticos e abordado em inúmeros textos de estatística básica. Entretanto, outros dois estimadores de $S(t)$ também possuem relevância significativa na literatura especializada: o estimador de Nelson-Aalen e o estimador da tabela de vida.</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>O estimador de Nelson-Aalen, mais recente que o de Kaplan-Meier, apresenta propriedades similares às deste último. Já o estimador da tabela de vida possui importância histórica, tendo sido utilizado em informações derivadas de censos demográficos para estimar características associadas ao tempo de vida humano. Este estimador foi inicialmente proposto por demógrafos e atuários no final do século XIX, sendo empregado principalmente em grandes amostras.</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>Nesta seção será abordado apenas o estimador de Nelson-Aalen. Para conhecer mais sobre o estimador da Tabela de Vida ou Tabela Atuarial, consulte a Seção 2.4.2 do livro *Análise de Sobrevivência Aplicada** de @colosimo2006analise.</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimador de Nelson-Aalen</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>Mais recente que o estimador de Kaplan-Meier, este estimador se baseia na função de sobrevivência expressa da seguinte forma:</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>S(t) = \exp\left<span class="sc">\{</span> - \Lambda(t) \right<span class="sc">\}</span>,</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>em que $\Lambda(t)$ é a função de risco acumulado apresentada na @sec-TaxaAcu.</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>A estimativa para $\Lambda(t)$ foi inicialmente proposta por @nelson1972theory  posteriormente retomada por @aalen1978nonparametric que demonstrou suas propriedades assintóticas utilizando processos de contagem. Na literatura, esse estimador é amplamente conhecido como o estimador de Nelson-Aalen e é definido pela seguinte expressão:</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>\hat{\Lambda}(t) = \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}} \right),</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ESTNelsonAalen}</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>onde $d_{j}$ e $n_{j}$ são as mesmas definições usadas no estimador de Kaplan-Meier. A variância do estimador, conforme proposta por @aalen1978nonparametric, é dada por:</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>\hat{Var}(\hat{\Lambda}(t)) = \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}^{2}} \right).</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>$$ {#eq-VarNelsonAalen}</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>Uma alternativa para a estimativa da variância de $\hat{\Lambda}(t)$, proposta por @klein1991small, é:</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>\hat{Var}(\hat{\Lambda}(t)) = \sum_{j:t_{j} &lt; t} \dfrac{(n_{j} - d_{j})d_{j}}{n_{j}^{3}},</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>entretanto, o estimador da @eq-VarNelsonAalen apresenta menor vício, tornando-o mais preferível que o proposto por @klein1991small.</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>Desta forma, podemos definir, com base no estimador de Nelson-Aalen, um estimador para a função de sobrevivência, podendo ser expressa por:</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>\hat{S}_{NA}(t) = \exp\left<span class="sc">\{</span>- \hat{\Lambda}(t) \right<span class="sc">\}</span>.</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>Deve-se, a variância deste estimador, a @aalen1978empirical. Podendo ser mensurada pela expressão:</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>\hat{Var}(\hat{S}_{NA}(t)) = \left[ \hat{S}_{NA}(t) \right]^{2} \sum_{j:t_{j} &lt; t} \left( \dfrac{d_{j}}{n_{j}^{2}} \right)</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>Vale destacar que o estimador de Nelson-Aalen aprenseta, na maioria dos casos, estimativas próximas ao estimador de Kaplan-Meier. @bohoris1994comparison mostrou que $\hat{S}_{NA}(t) \geq \hat{S}_{KM}(t)$ para todo $t$, isto é, as estimativas obtidas pelo estimador de Nelson-Aalen são maiores ou iguais às estimativas obtidas pelo estimador de Kaplan-Meier.</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparação de Curvas de Sobrevivência</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>Imagine um problema da área da saúde, onde se desejar comparar dois grupos, um grupo receberá tratamento através do uso de alguma droga e o outro será o grupo controle. Estatísticas mais comumente usadas podem ser vistas como generalizações para dados censurados, de conhecidos testes não-paramétricos. O teste *logrank* <span class="co">[</span><span class="ot">@mantel1966evaluation</span><span class="co">]</span> é o mais usado em análise de sobrevivência. @gehan1965generalized propôs uma generalização para a estatística de Wilcoxon. Outras generalizações foram propostas por @peto1972asymptotically e @prentice1978linear, entre outros. @latta1981monte fez uso de simulações de Monte Carlo para comparar vários testes não-paramétricos.</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>Neste texto, ênfase será dada ao teste *logrank*. Este teste é muito utilizado em análise de sobrevivência e é particularmente apropriado quando a razão das funções de risco dos grupos a serem comparados é aproximadamente constante. Isto é, as populações têm a propriedade de riscos proporcionais. A estatística deste teste é a diferença entre o número observado de falhas em cada grupo e uma quantidade que, para muitos propósitos, pode ser pensada como o correspondente número esperado de falhas sob a hipótese nula. A expressão do teste *logrank* é obtida de forma similar a do conhecido teste de @mantel1959statistical, para combinar tabelas de contigência. O teste *logrank* tem, também, a mesma expressão do teste de escore para o modelo de regressão de Cox que será apresentado no <span class="co">[</span><span class="ot">...</span><span class="co">]</span>. Outros testes também são apresentados nesta seção.</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>Considere, inicialmente, o teste de igualdade de duas funções de sobrevivência $S_{1}(t)$ e $S_{2}(t)$. Sejam $t_{1} &lt; t_{2} &lt; \cdots &lt; t_{k}$ os tempos de falha distintos da amostra formada pela combinação das duas amostras individuais. Suponha que em um tempo $t_{j}$ aconteçam $d_{j}$ falhas e que $n_{j}$ indivíduos estejam sob risco em um tempo imediatamente inferior a $t_{j}$ na amostra combinada e, respectivamente, $d_{ij}$ e $n_{ij}$ na amostra $i$; $i = 1, 2$ e $j = 1, \cdots, k$. Em tempo de falha $t_{j}$, os dados podem ser dispostos em forma de uma tabela de contigência 2 x 2 com $d_{ij}$ falhas e $n_{ij} - d_{ij}$ sobreviventes na coluna $i$. Isto é mostrado na @tbl-ExampleTableContig.</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Tabela de contingência gerada no tempo $t_{j}$."</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-ExampleTableContig</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a><span class="in"># Criando a tabela em R</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="in">    " " = c("Falha", "Não Falha", " "),</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="in">    "1" = c("$d_{1j}$", "$n_{1j} - d_{1j}$", "$n_{1j}$"),</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a><span class="in">    "2" = c("$d_{2j}$", "$n_{2j} - d_{2j}$", "$n_{2j}$"),</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a><span class="in">    " " = c("$d_{j}$", "$n_{j} - d_{j}$", "$n_{j}$")</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a><span class="in">  escape = FALSE,</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "c",</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="in">  col.names = c("", "Grupo 1", "Grupo 2", " "),</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="in">  booktabs = TRUE,</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a><span class="in">  #linesep = c("", "\\addlinespace", "\\addlinespace")</span></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>Condicional à experiência de falha e censura até o tempo $t_{j}$ (fixando as marginais de coluna) e ao número de falhas no tempo $t_{j}$ (fixando as marginais de linha), a distribuição de $d_{2j}$ é, então, uma hipergeométrica:</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>\dfrac{ \binom{ n_{1j} }{ d_{1j} } \binom{ n_{2j} }{ d_{2j} } }{ \binom{ n_{j} }{ d_{j} } },</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>A média de $d_{2j}$ é $w_{2j} = n_{2j} d_{j} n_{j}^{-1}$, o que equivale a dizer que, se não houver diferença entre as duas populações no tempo $t_{j}$, o número total de falhas ($d_{j}$) pode ser dividido entre as duas amostras de acordo com a razão entre o número de indivíduos sob risco em cada amostra e o número total sob risco. A variância de $d_{2j}$ obtida a partir da distribuição hipergeométrica é:</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>(V_{j})_{2} = n_{2j}(n_{j} - n_{2j})d_{j}(n_{j} - d_{j}) n_{j}^{-2} (n_{j} - 1)^{-1}.</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>Então, a estatística $d_{2j} - w_{2j}$ tem média zero e variância $(V_{j})_{2}$. Se as $k$ tabelas de contingência forem independentes, um teste aproximado para a igualdade das duas funções de sobrevivência pode ser baseado na estatística:</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>T = \dfrac{ \left<span class="co">[</span><span class="ot"> \sum_{j = 1}^{k} (d_{2j} - w_{2j}) \right</span><span class="co">]</span>^{2} }{ \sum_{j = 1}^{k} (V_{j})_{2}  } ,</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>$$ {#eq-EstTestelogrank}</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>que, sob a hipótese nula $H_{0}: S_{1}(t) = S_{2}(t)$ para todo $t$ no período de acompanhamento, tem uma distribuição qui-quadrado com $1$ grau de liberdade para grandes amostras.</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>Com o intuito de exemplificar o teste de *logrank* com dados reais aplicou-se o mesmo aos dados de Leucemia Pediátrica dispostos no Apêndice (A) do livro *Análise de Sobrevivência Aplicada* de @colosimo2006analise, os mesmo dados usados para gerar a @fig-SobrKM. No teste executado o obejtivo é testar se a curva de sobrevivência das categorias da covariável <span class="in">`r6`</span> são iguais, sob as hipóteses:</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>  H_{0}: \text{As curvas de sobrevivência dos grupos são iguais ao longo do tempo.} <span class="sc">\\</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>  H_{1}: \text{As curvas de sobrevivência dos grupos são diferentes ao longo do tempo.}</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a><span class="in"># [1] ATIVAÇÃO DE PACOTES</span></span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a><span class="in"># -----------------------</span></span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a><span class="in">library(survival)</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------------------</span></span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a><span class="in"># [2] IMPORTAÇÃO E AJUSTES DOS DADOS</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------------------</span></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a><span class="in"># Caminho URL para os dados</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a><span class="in">url &lt;- "https://docs.ufpr.br/~giolo/asa/dados/leucemia.txt"</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a><span class="in"># Leitura dos dados</span></span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- read.table(url, header = TRUE)</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a><span class="in"># Decodificando a coluna r_6</span></span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- df %&gt;%</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(grupo = ifelse(r6 == 0, "Category Zero", "Category One"))</span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a><span class="in"># [3] TESTE DE LOGRANK</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a><span class="in"># Aplicando o Teste de Logrank</span></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a><span class="in">TestLogrank &lt;- survdiff(Surv(tempos, cens)~grupo, data = df, rho = 0)</span></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a><span class="in">print(TestLogrank )</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>Se for fixado o nível de significância em 5%, ou seja, $\alpha = 0,05$, rejeitamos a hipótese nula. Chega-se a essa conclusão olhando para o $p-valor$ (probabilidade de significância) do teste, mensurado em $p-valor =$ <span class="in">`r round(TestLogrank$pvalue, 2)`</span>. Como o $p-valor &lt; \alpha$, rejeita-se $H_{0}$, logo, as curvas de sobrevivência dos grupos são diferentes ao longo do tempo, ao nível de significância de 5%.</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>A generalização do teste *logrank* para a igualdade de $r &gt; 2$ funções de sobrevivência $S_{1}(t), S_{2}(t), ..., S_{r}(t)$ não é complicada. Considere a mesma notação anterior, com o índice $i$ variando, agora, entre $1$ e $r$. Desta forma, os dados podem ser arranjados em forma de uma tabela de contingência 2 x $r$ falhas $d_{ij}$ e $n_{ij} - d_{ij}$ sobreviventes na coluna $i$. Ou seja, a @tbl-ExampleTableContig passaria a ter $r$ colunas em vez de simplesmente duas.</span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>:::: progress</span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>:::: {.progress-bar style="width: 100%;"}</span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>::::</span></code><button title="Copiar para a área de transferência" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright: (<strong>SILVA, B.C.R - 2024</strong>)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Construído <a href="https://quarto.org/"> Pacote Quarto no R4.3</a>.</p>
</div>
  </div>
</footer>




</body></html>