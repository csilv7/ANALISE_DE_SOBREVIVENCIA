<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Técnicas Paramétricas - Modelos Probabilísticos – Análise de Sobrevivência</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./CII_EstimNaoParam.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CIII_ModelProb.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Técnicas Paramétricas - Modelos Probabilísticos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Análise de Sobrevivência</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/csilv7/ANALISE_DE_SOBREVIVENCIA" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Análise-de-Sobrevivência.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Análise-de-Sobrevivência.docx">
              <i class="bi bi-file-word pe-1"></i>
            Download Docx
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Alternar modo escuro"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CI_ConceitosBasicos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Conceitos Básicos e Exemplos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CII_EstimNaoParam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Técnicas Não Paramétricas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CIII_ModelProb.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Técnicas Paramétricas - Modelos Probabilísticos</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">3.1</span> Introdução</a></li>
  <li><a href="#distribuições-do-tempo-de-sobrevivência" id="toc-distribuições-do-tempo-de-sobrevivência" class="nav-link" data-scroll-target="#distribuições-do-tempo-de-sobrevivência"><span class="header-section-number">3.2</span> Distribuições do Tempo de Sobrevivência</a>
  <ul class="collapse">
  <li><a href="#sec-DistExp" id="toc-sec-DistExp" class="nav-link" data-scroll-target="#sec-DistExp"><span class="header-section-number">3.2.1</span> Distribuição Exponencial</a></li>
  <li><a href="#sec-DistWeibull" id="toc-sec-DistWeibull" class="nav-link" data-scroll-target="#sec-DistWeibull"><span class="header-section-number">3.2.2</span> Distribuição Weibull</a></li>
  <li><a href="#distribuição-lognormal" id="toc-distribuição-lognormal" class="nav-link" data-scroll-target="#distribuição-lognormal"><span class="header-section-number">3.2.3</span> Distribuição lognormal</a></li>
  </ul></li>
  <li><a href="#estimação" id="toc-estimação" class="nav-link" data-scroll-target="#estimação"><span class="header-section-number">3.3</span> Estimação</a>
  <ul class="collapse">
  <li><a href="#método-de-máxima-verossimilhança" id="toc-método-de-máxima-verossimilhança" class="nav-link" data-scroll-target="#método-de-máxima-verossimilhança"><span class="header-section-number">3.3.1</span> Método de Máxima Verossimilhança</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Técnicas Paramétricas - Modelos Probabilísticos</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar o código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Esconder o código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver o código fonte</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
  body{text-align: justify}
</style>
<div class="progress">
<div class="progress-bar" style="width: 100%;">

</div>
</div>
<section id="introdução" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">3.1</span> Introdução</h2>
<p>No Capítulo anteriror, foi vista uma abordagem não paramétrica, onde, a estimação é feita sem se referir a uma distribuição de probabilidade específica para o tempo de sobrevivência.</p>
<p>Obtendo os estimadores não paramétricos diretamente do conjunto de dados. Supondo que o mecanismo gerador dessas informações opere de forma distinta em diferentes momentos no tempo. Funcionando de forma quase que independente, desta forma, conclui-se que a estimação não paramétrica têm tantos parâmetros quanto intervalos no tempo. Ao incluir covariáveis, o modelo de <em>Kaplan-Meier</em> não permite estimar o “efeito” das cováriaveis, mas apenas comparar e testar a igualdade entre duas curvas de sobrevivência.</p>
<p>De acordo com a distribuição de probabilidade que acredita-se descrever a variável resposta <span class="math inline">\(Y\)</span>, e de acordo com a função escolhida para a relação de <span class="math inline">\(Y\)</span> com as covariáveis <span class="math inline">\(x_{1}, x_{2}, \cdots, x_{p}\)</span>, identifica-se o modelo de regressão como: <em>Linear</em>, <em>Poisson</em>, <em>Logísitico</em>, entre outros. Aplica-se a ideia em análise de sobrevivência, de forma que o tempo de ocorrência até um evento de interesse é a variável resposta.</p>
<p>Nesse contexto, neste Capítulo é vista uma abordagem paramétrica para estimar as funções básicas de sobrevivência. Onde se assume como conhecida a distribuição de probabilidade do tempo de evento e, desta forma, os parâmetros seram estimados.</p>
</section>
<section id="distribuições-do-tempo-de-sobrevivência" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="distribuições-do-tempo-de-sobrevivência"><span class="header-section-number">3.2</span> Distribuições do Tempo de Sobrevivência</h2>
<p>Seja <span class="math inline">\(T\)</span> uma variável aleatória que representa “tempo de sobrevivênvia”, qual a distribuição de probabilidade poderia representa-lá?</p>
<p>Como uma característica da variável aleatória <span class="math inline">\(T\)</span> é contínua e não negativa, pode-se a partir dessa caracater´sitica, remover algumas distribuições da lista de possíveis distribuições de probabilidades de <span class="math inline">\(T\)</span>. Desta forma, a distribuição normal já não se torna adequada, pois tal distribuição permite valores negativos. Além disso, o tempo de sobrevivência contém, frequentemente, uma forte assimetria à direita.</p>
<p>Entre os modelos paramétricos, utiliza-se muito a classe <strong>tempo de vida acelerado</strong>. Em tal classe, o tempo de sobrevivência <span class="math inline">\(T\)</span>, obdesce a seguinte relação:</p>
<p><span id="eq-TempVidaAcel"><span class="math display">\[
\ln(T) = \mu + \sigma W,
\tag{3.1}\]</span></span></p>
<p>onde <span class="math inline">\(\mu\)</span> é o parâmetro que representa a média de <span class="math inline">\(\ln(T)\)</span> e <span class="math inline">\(\sigma\)</span> sua dispersão, mas usualmente denominados, respectivamnete, parâmetros de locação e escala. <span class="math inline">\(W\)</span> é uma variável aleatória que possa representar <span class="math inline">\(\ln(T)\)</span> a partir de uma distribuição de probabilidade.</p>
<section id="sec-DistExp" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-DistExp"><span class="header-section-number">3.2.1</span> Distribuição Exponencial</h3>
<p>Se <span class="math inline">\(T \sim Exp(\alpha)\)</span>, a sua função densidade de probabilidade é expressa da seguinte forma:</p>
<p><span id="eq-densitExp"><span class="math display">\[
f(t) = \alpha e^{-\alpha t}, \ t \geq 0 \ \text{e} \ \alpha &gt; 0.
\tag{3.2}\]</span></span></p>
<p>Desta forma, para obtermos, por exemplo, a função de sobrevivência basta integrarmos a função densidade de probabilidade, veja:</p>
<span class="math display">\[\begin{align*}
    S(t) &amp; = P(T \geq t) = \int_{t}^{\infty} \alpha e^{-\alpha t} \ dt \\
         &amp; = \alpha \int_{t}^{\infty} e^{-\alpha t} \ dt = \alpha \int_{t}^{\infty} e^{u} \ \frac{du}{- \alpha} \\
         &amp; = \frac{\alpha}{-\alpha} \int_{t}^{\infty} e^{u} \ du = - \left[ e^{u} \right]_{t}^{\infty} = - \left[ e^{- \alpha t} \right]_{t}^{\infty} \\
         &amp; = - [ e^{- \alpha \infty} - e^{- \alpha t}] = - [0 - e^{- \alpha t}] = e^{- \alpha t}.
\end{align*}\]</span>
<p>Assim, foramalmente, a função de sobrevivência é expressa por:</p>
<p><span id="eq-StExp"><span class="math display">\[
S(t) = e^{- \alpha t}.
\tag{3.3}\]</span></span></p>
<p>Note que o parâmetro <span class="math inline">\(\alpha\)</span> é a velocidade de queda da função sobrevivência. Através das relações entre as funções em análise de sobrevivência, temos a função risco ou taxa de falha. Obtida pela razão entre a densidade de probabilidade e a função de sobrevivência:</p>
<p><span id="eq-RiscoExp"><span class="math display">\[
\lambda(t) = \dfrac{f(t)}{S(t)} = \dfrac{\alpha e^{-\alpha t}}{e^{-\alpha t}} = \alpha = \text{constante}.
\tag{3.4}\]</span></span></p>
<p>Sendo a função risco constante para todo tempo observado <span class="math inline">\(t\)</span>, o risco acumulado é função linear no tempo com uma inclinação na reta dado por <span class="math inline">\(\alpha\)</span>:</p>
<p><span id="eq-RiscoAcumExp"><span class="math display">\[
\Lambda = - \ln[S(t)] = - \ln[e^{-\alpha t}] = - (- \alpha t) = \alpha t
\tag{3.5}\]</span></span></p>
<p>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] DISTRIBUIÇÃO EXPONENCIAL</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.1] FUNÇÕES</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># As funções de sobrevivência, risco e risco acumulado são simplificadas</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>htexp <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha) <span class="fu">rep</span>(alpha, <span class="fu">length</span>(t))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>Ltexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) alpha <span class="sc">*</span> t</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> <span class="dv">1</span>) <span class="co"># Simulando dados de uma exponencial</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)     <span class="co"># Valores de alpha a serem avaliados</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(alphas, <span class="cf">function</span>(alpha) {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">Stexp</span>(tempo, alpha),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htexp</span>(alpha),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">Ltexp</span>(tempo, alpha),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fu">factor</span>(alpha)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.3] GRÁFICOS</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando uma função para gerar gráficos</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> alpha)) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(alpha)) <span class="sc">+</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(alphas, <span class="cf">function</span>(a) <span class="fu">bquote</span>(alpha <span class="sc">==</span> .(a)))) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Veja a seguir a <a href="#fig-SobrExp" class="quarto-xref">Figura&nbsp;<span>3.1</span></a>. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"St"</span>, <span class="st">"S(t)"</span>, <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>), <span class="fu">expression</span>(<span class="fu">S</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-SobrExp" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-SobrExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.1: Função de Sobrevivência para diferentes valores de α
</figcaption>
<div aria-describedby="fig-SobrExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-SobrExp-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscExp" class="quarto-xref">Figura&nbsp;<span>3.2</span></a>. Tal Figura mostra a função de risco para diferentes valores do parâmetro <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"ht"</span>, <span class="fu">expression</span>(<span class="fu">lambda</span>(t)), <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>), <span class="fu">expression</span>(<span class="fu">lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscExp" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.2: Função de Risco para diferentes valores de α
</figcaption>
<div aria-describedby="fig-RiscExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscExp-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscAcumulExp" class="quarto-xref">Figura&nbsp;<span>3.3</span></a>. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco Acumulado</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"Lt"</span>, <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)), <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>), <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscAcumulExp" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscAcumulExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.3: Função de Risco Acumulado para diferentes valores de α
</figcaption>
<div aria-describedby="fig-RiscAcumulExp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscAcumulExp-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<section id="algumas-considerações" class="level4" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="algumas-considerações"><span class="header-section-number">3.2.1.1</span> Algumas Considerações</h4>
<p>Note que quanto maior o valor de <span class="math inline">\(\alpha\)</span> (risco), mas abruptamente a função de sobrevivência <span class="math inline">\(S(t)\)</span> decresce e maior é a inclinação que representa o risco acumulado.</p>
<p>Como a distribuição exponencial possui um único parâmetro se torna matematicamente simples além de possuir um formato assimétrico.</p>
<p>O seu uso em análise de sobrevivência tem certa analogia com a presuposição de normalidade em outras técnicas e áreas da estatísticas. Porém, seu presuposto de risco constante é uma afirmação muuito forte a se fazer a respeito do risco. Por exemplo, está sendo realizado um estudo sobre o cancêr, o tempo de evento de tal experimento é o tempo até que ocorra a morte ou cura do paciente. Para aplicar a distribuição exponecial para modelar esse problema seria necessário pensar que o tempo desde o diagnóstico da doênça não afeta o tempo de ocorrência do evento. O que é delicado de se aceitar, tendo em vista que o prórprio passar do tempo afeta a probabilidade de sobrevivência, o risco, risco acumulado, etc. Tendo em vista que, isso pode ser simplismente por causas naturais como aumento da idade ao passar do tempo (envelhecimento), por exemplo. Desta forma, está consequência da distribuição exponencial, isso é denominado de <strong>falta de memória da distribuição normal</strong>.</p>
<p>Quando <span class="math inline">\(\alpha = 1\)</span>, diz-se que a <strong>distribuição exponecial padrão</strong>. A média <span class="math inline">\(\left( E[t] \right)\)</span> e variância <span class="math inline">\(\left( Var[T] \right)\)</span> do tempo de sobrevivência, quando este seguir uma distribuição em Exponecial, são obtidas a partir da inversa do risco (<span class="math inline">\(\alpha\)</span>). Quanto maior o risco, menor o tempo médio de sobrevivência e menor variabilidade deste em torno na média.</p>
<p><span class="math display">\[
E[T] = \dfrac{1}{\alpha}
\]</span></p>
<p><span class="math display">\[
Var[T] = \dfrac{1}{\alpha^2}
\]</span></p>
<p>Ao afirmar que o tempo de sobrevivência <span class="math inline">\(T\)</span> segue uma distribuição de exponencial equivale a dizer que na <a href="#eq-TempVidaAcel" class="quarto-xref">Equação&nbsp;<span>3.1</span></a>, <span class="math inline">\(W\)</span> segue uma distribuição valor extremo padrão, <span class="math inline">\(\sigma = 1\)</span>. Assim para cada tempo <span class="math inline">\(t\)</span>, a <a href="#eq-TempVidaAcel" class="quarto-xref">Equação&nbsp;<span>3.1</span></a> é escrita da seguinte forma: <span class="math inline">\(\ln(T) = \mu + w\)</span>, como a <span class="math inline">\(E[T] = \frac{1}{\alpha}\)</span> na distribuição exponencial, tem-se que: <span class="math display">\[\mu = - \ln(\alpha).\]</span></p>
<blockquote class="blockquote">
<p>Essa é uma forma de parametrização dos modelos parâmetricos utilizada no R, isto é, o parâmetro <span class="math inline">\(\alpha = e^{-\mu}\)</span>.</p>
</blockquote>
<p>Como a distribuição de <span class="math inline">\(T\)</span> é assimétrica, se torna mais usual utilizar o <em>tempo mediano de sobrevivência</em> ao invés de tempo médio. Pode-se obter o tempo mediano de sobrevivência a partir de um tempo <span class="math inline">\(t\)</span>, tal que, <span class="math inline">\(S(t) = 0,5\)</span>, logo</p>
<span class="math display">\[\begin{align*}
    S(t) &amp; = 0,5 \Leftrightarrow e^{-\alpha t} = 0,5 \Leftrightarrow -\alpha t = \ln(1/2) \\
    \alpha t &amp; = - \ln(2^{-1}) \Leftrightarrow \alpha t = \ln((2^{-1})^{-1}) \\
    \alpha t &amp; = - \ln(2).
\end{align*}\]</span>
<p>Desta forma, o tempo mediano de sobrevivência é definido como:</p>
<p><span class="math display">\[
T_{mediano} = \dfrac{\ln(2)}{\alpha}.
\]</span></p>
<p>Em suma, o modelo exponecial se torna adequado quando o período do experimento é curto para que a supocisão de risco constante possa ser antendida.</p>
</section>
</section>
<section id="sec-DistWeibull" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="sec-DistWeibull"><span class="header-section-number">3.2.2</span> Distribuição Weibull</h3>
<p>Na maioria do casos de análise de sobrevivência na área da saúde, se torna mais lógico supor que o risco não é constante ao longo do tempo.</p>
<p>Atualmente, a <em>Distribuição Weibull</em> é mais utilizada, pois permite a variação do risco ao longo do tempo. Será possível ver que a distribuição exponencial é um caso particular da distribuição weibull.</p>
<p>Se o tempo de sobrevivência <span class="math inline">\(T\)</span> segue uma distribuição Weibull, isto é, <span class="math inline">\(T \sim Weibull(\alpha, \gamma)\)</span>, sua função densidade de probabilidade é expressa por:</p>
<p><span id="eq-densitWei"><span class="math display">\[
f(t) = \gamma \alpha^{\gamma} t^{\gamma - 1} \exp \left\{ -\left( \dfrac{t}{\alpha} \right)^{\gamma} \right\}.
\tag{3.6}\]</span></span></p>
<p>A partir da <a href="#eq-densitWei" class="quarto-xref">Equação&nbsp;<span>3.6</span></a> é possível chegar a função de sobrevivência da distribuição Weibull sendo está função definida como:</p>
<p><span id="eq-StWeibull"><span class="math display">\[
S (t) = \exp \left\{ -\left( \dfrac{t}{\alpha} \right)^{\gamma} \right\},
\tag{3.7}\]</span></span></p>
<p>onde <span class="math inline">\(t \geq 0\)</span>, <span class="math inline">\(\alpha\)</span> o parâmetro taxa e <span class="math inline">\(\gamma\)</span> parâmetro de forma. Ambos os parâmetros sempre positivos.</p>
<p>A função de risco, <span class="math inline">\(\lambda(t)\)</span>, depende do tempo de sobrevivência. Apresentando variação no tempo conforme a expressão:</p>
<p><span id="eq-RiscoWeibull"><span class="math display">\[
\lambda (t) = \gamma \alpha^{\gamma} t^{\gamma - 1}
\tag{3.8}\]</span></span></p>
<p>e a função de risco acumulado da distribuição Weibull é dada por:</p>
<p><span id="eq-RiscAcumWeibull"><span class="math display">\[
\Lambda (t) = - \ln S (t) = -\left( \dfrac{t}{\alpha} \right)^{\gamma}.
\tag{3.9}\]</span></span></p>
<p>Note que, o parâmetro <span class="math inline">\(\gamma\)</span> determina a forma função de risco da seguinte maneira:</p>
<ul>
<li><span class="math inline">\(\gamma &lt; 1 \rightarrow\)</span> função de risco decresce;</li>
<li><span class="math inline">\(\gamma &gt; 1 \rightarrow\)</span> função de risco cresce;</li>
<li><span class="math inline">\(\gamma &gt; 1 \rightarrow\)</span> a função de risco se torna constante, caindo no caso particular da distribuição exponencial.</li>
</ul>
<p>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro <span class="math inline">\(\gamma\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] DISTRIBUIÇÃO WEIBULL</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.1] FUNÇÕES</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Funções para Weibull</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>StWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) <span class="fu">exp</span>(<span class="sc">-</span>(t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>htWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) gamma <span class="sc">*</span> (alpha<span class="sc">^</span>gamma) <span class="sc">*</span> t<span class="sc">^</span>(gamma <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>LtWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) (t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulando dados de uma Weibull</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(n, <span class="at">shape =</span> <span class="dv">2</span>, <span class="at">scale =</span> <span class="dv">1</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span>   <span class="co"># Fixo para simplificar</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>gammas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">2.5</span>, <span class="fl">3.0</span>) <span class="co"># Valores de gamma</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(gammas, <span class="cf">function</span>(gamma) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">StWei</span>(tempo, alpha, gamma),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htWei</span>(tempo, alpha, gamma),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">LtWei</span>(tempo, alpha, gamma),</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">gamma =</span> <span class="fu">factor</span>(gamma)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.3] GRÁFICOS</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Função genérica para gráficos</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> gamma)) <span class="sc">+</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(gamma)) <span class="sc">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(gammas, <span class="cf">function</span>(g) <span class="fu">bquote</span>(gamma <span class="sc">==</span> .(g)))) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleta de cores</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"brown"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Veja a seguir a <a href="#fig-SobrWei" class="quarto-xref">Figura&nbsp;<span>3.4</span></a>. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro <span class="math inline">\(\gamma\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"St"</span>, <span class="fu">expression</span>(<span class="fu">S</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">S</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-SobrWei" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-SobrWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.4: Função de Sobrevivência para diferentes valores de γ
</figcaption>
<div aria-describedby="fig-SobrWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-SobrWei-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscWei" class="quarto-xref">Figura&nbsp;<span>3.5</span></a>. Tal Figura mostra a função de risco para diferentes valores do parâmetro <span class="math inline">\(\gamma\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"ht"</span>, <span class="fu">expression</span>(<span class="fu">lambda</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscWei" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.5: Função de Risco para diferentes valores de γ
</figcaption>
<div aria-describedby="fig-RiscWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscWei-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscAcumWei" class="quarto-xref">Figura&nbsp;<span>3.6</span></a>. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro <span class="math inline">\(\gamma\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco Acumulado</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"Lt"</span>, <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscAcumWei" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscAcumWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.6: Função de Risco Acumulado para diferentes valores de γ
</figcaption>
<div aria-describedby="fig-RiscAcumWei-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscAcumWei-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<section id="algumas-considerações-1" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="algumas-considerações-1"><span class="header-section-number">3.2.2.1</span> Algumas Considerações</h4>
<p>É incluso a função gama na média e variância da distribuição Weibull, assim,</p>
<p><span class="math display">\[
E[T] = \alpha \Gamma[1 + (1/\gamma)]
\]</span> <span class="math display">\[
Var[T] = a^{2} \left[ \Gamma [1 + (2/\gamma)] - \Gamma [1 + (1/\gamma)]^{2} \right]
\]</span></p>
<p>sendo a função gama <span class="math inline">\(\Gamma [k]\)</span>, expressa por <span class="math inline">\(\Gamma [k] = \int_{0}^{\infty} x^{k -1} e^{- x} dx\)</span>.</p>
<p>Afim de se obter o tempo mediano de sobrevivência, igualamos a probabilidade de sobrevivência a 0,5. Desta forma:</p>
<span class="math display">\[\begin{align*}
    S(t) &amp; = 0,5 \Leftrightarrow e^{(-\alpha t)^{\gamma}} = 1/2 \\
    - (\alpha t)^{\gamma} &amp; = - \ln(2^{-1}) \Leftrightarrow \alpha t = \ln(2) \\
    (\alpha t)^{\gamma} &amp; = \ln(2).
\end{align*}\]</span>
<p>Logo,</p>
<p><span class="math display">\[
T_{mediano} = \dfrac{\ln(2)^{1/\gamma}}{\alpha}.
\]</span></p>
</section>
<section id="distribuição-do-valor-extremo-ou-de-gambel" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="distribuição-do-valor-extremo-ou-de-gambel"><span class="header-section-number">3.2.2.2</span> Distribuição do valor extremo ou de Gambel</h4>
<p>Um ponto que deve ser chamada atenção é a relação da distribuição Weibull com outra distribuição. Esta outra distribuição é chamada de <em>distribuição do valor extremo</em> ou de <em>Gambel</em>. Tal distribuição surge ao se tomar o logaritmo de uma variável <span class="math inline">\(T\)</span> com distribuição de Weibull com <span class="math inline">\(f(t)\)</span> dada por <a href="#eq-densitWei" class="quarto-xref">Equação&nbsp;<span>3.6</span></a>, desta forma, <span class="math inline">\(Y = \ln(T)\)</span> tem distribuição do valor extremo com densidade da forma:</p>
</section>
</section>
<section id="distribuição-lognormal" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="distribuição-lognormal"><span class="header-section-number">3.2.3</span> Distribuição lognormal</h3>
<p>Uma outra possibilidade para modelar o tempo de sobrevivência é a <em>distribuição Log-normal</em>. Dizer que <span class="math inline">\(T \sim Normal(\mu, \sigma^{2})\)</span> implica em dizer que <span class="math inline">\(\ln(T) \sim log-Normal(\mu, \sigma^{2})\)</span> em que <span class="math inline">\(\mu\)</span> é a média do logaritmo do tempo de falha e <span class="math inline">\(\sigma^{2}\)</span> sua variância. Pode-se fazer uso desta relação para modelar o tempo de sobrevivência conforme uma distribuição normal, desde que, se aplique o logaritmo aos dados observados. A função densidade para tal distribuição é dada por:</p>
<p><span id="eq-densitLognormal"><span class="math display">\[
f (t) = \dfrac{1}{t \sigma \sqrt{2 \pi}} \exp \left\{- \dfrac{1}{2} \left(\dfrac{\ln(t) - \mu}{\sigma}\right)^{2} \right\}
\tag{3.10}\]</span></span></p>
<p>Assim, quando o tempo de sobrevivência segue uma distribuição log-normal, sua função de sobrevivência e as demais não tem uma forma análitica explícita, desde modo, deve-se fazer uso das relações entre as funções para se obter a função taxa de falha e taxa de falha acumulada. Desta forma, essas funções são expressas, respectivamente, por:</p>
<p><span id="eq-StLognormal"><span class="math display">\[
S (t) = \Phi \left( \dfrac{- \ln(t) + \mu}{\sigma} \right)
\tag{3.11}\]</span></span></p>
<p><span class="math display">\[
\lambda (t) = \dfrac{f (t)}{S (t)} \ \text{ e } \ \Lambda (t) = - \ln S(t)
\]</span></p>
<p>em que <span class="math inline">\(\Phi (\cdot)\)</span> é a função de distribuição acumulada da normal padrão.</p>
<p>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro <span class="math inline">\(\mu\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] DISTRIBUIÇÃO LOG-NORMAL</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.1] FUNÇÕES</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Função densidade (f)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>ftLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">/</span> (t <span class="sc">*</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi))) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> ((<span class="fu">log</span>(t) <span class="sc">-</span> mu) <span class="sc">/</span> sigma)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência (S)</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>StLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pnorm</span>(<span class="sc">-</span>(<span class="fu">log</span>(t) <span class="sc">-</span> mu) <span class="sc">/</span> sigma, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco (h)</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>htLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ftLogNormal</span>(t, mu, sigma) <span class="sc">/</span> <span class="fu">StLogNormal</span>(t, mu, sigma)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco Acumulado (Lambda)</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>LtLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">log</span>(<span class="fu">StLogNormal</span>(t, mu, sigma))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulando dados da distribuição log-normal</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="dv">0</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>mus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>) <span class="co"># Valores de mu</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span>         <span class="co"># Valor fixo de sigma</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(mus, <span class="cf">function</span>(mu) {</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">ft =</span> <span class="fu">ftLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">StLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">LtLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> <span class="fu">factor</span>(mu)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.3] GRÁFICOS</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Função genérica para gráficos</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> mu)) <span class="sc">+</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(mu)) <span class="sc">+</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(mus, <span class="cf">function</span>(m) <span class="fu">bquote</span>(mu <span class="sc">==</span> .(m)))) <span class="sc">+</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleta de cores</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Veja a seguir a <a href="#fig-SobrLognormal" class="quarto-xref">Figura&nbsp;<span>3.7</span></a>. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro <span class="math inline">\(\mu\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"St"</span>, <span class="fu">expression</span>(<span class="fu">S</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">S</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-SobrLognormal" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-SobrLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.7: Função de Sobrevivência para diferentes valores de μ
</figcaption>
<div aria-describedby="fig-SobrLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-SobrLognormal-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscLognormal" class="quarto-xref">Figura&nbsp;<span>3.8</span></a>. Tal Figura mostra a função de risco para diferentes valores do parâmetro <span class="math inline">\(\mu\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"ht"</span>, <span class="fu">expression</span>(<span class="fu">lambda</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscLognormal" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.8: Função de Risco para diferentes valores de μ
</figcaption>
<div aria-describedby="fig-RiscLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscLognormal-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Veja a seguir a <a href="#fig-RiscAcumLognormal" class="quarto-xref">Figura&nbsp;<span>3.9</span></a>. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro <span class="math inline">\(\mu\)</span>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco Acumulado</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_func</span>(dados, <span class="st">"Lt"</span>, <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)), color_values, <span class="fu">expression</span>(<span class="fu">Lambda</span>(t)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-RiscAcumLognormal" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-RiscAcumLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.9: Função de Risco Acumulado para diferentes valores de μ
</figcaption>
<div aria-describedby="fig-RiscAcumLognormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-RiscAcumLognormal-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<section id="algumas-considerações-2" class="level4" data-number="3.2.3.1">
<h4 data-number="3.2.3.1" class="anchored" data-anchor-id="algumas-considerações-2"><span class="header-section-number">3.2.3.1</span> Algumas Considerações</h4>
<p>A média de <span class="math inline">\(T\)</span> é dada por:</p>
<p><span class="math display">\[
E[T] = \exp \{ \mu + \frac{\sigma^2}{2} \},
\]</span></p>
<p>e a variância de <span class="math inline">\(T\)</span> definida como:</p>
<p><span class="math display">\[
Var[T] = \exp \{ 2 \mu + \sigma^2 \} (\exp \{ \sigma^{2} \} - 1).
\]</span></p>
</section>
</section>
</section>
<section id="estimação" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="estimação"><span class="header-section-number">3.3</span> Estimação</h2>
<p>Foi mostrado alguns modelos probabilísticos. Porém, tais modelos apresentam quantidades desconhecidas denominadas de parâmetros ou parâmetro quando o modelo de probabilidade depende apenas de uma quantidade desconhecida, por exemplo, a distribuição exponencial.</p>
<section id="método-de-máxima-verossimilhança" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="método-de-máxima-verossimilhança"><span class="header-section-number">3.3.1</span> Método de Máxima Verossimilhança</h3>
<p>O <em>Método de Máxima Verossimilhança</em> se baseia na ideia de que, a partir de uma amostra aleatória, a estimativa para o parâmetro de interesse maximiza a probabilidade de tal amostra aleatória ser obtida.</p>
<p>Em termos simples, o método de máxima verossimilhança condensa toda informação contida, através da função de verossimilhança, na amostra. Afim de encontrar o(s) parâmetro(s) da distribuição que melhor expliquem essa amostra é realizado o produtório da densidade (<span class="math inline">\(f (t)\)</span>) para cada observação amostral <span class="math inline">\(t_{i}\)</span>, <span class="math inline">\(i = 1, 2, \cdots, n\)</span>. Em livros de estatística básica, a seguinte definição da função verossimilhança é adotada, para um parâmetro (ou conjunto de parâmetros) <span class="math inline">\(\theta\)</span> qualquer:</p>
<p><span class="math display">\[
L (\theta) = \prod_{i = 1}^{n} f (t_{i}, \theta).
\]</span></p>
<p>Perceba que <span class="math inline">\(L\)</span> é função de <span class="math inline">\(\theta\)</span>, sendo este um único parâmetro ou um conjunto de parâmetros, como na distribuição log-normal, onde <span class="math inline">\(\theta = (\mu, \sigma^{2})\)</span>. Entretanto, nota-se que para qualquer observação não censurada, sua contribuição para <span class="math inline">\(L (\theta)\)</span> é a sua densidade, o que na análise de sobrevivência não é o suficiente, já que os dados apresentam censura, implicando no tempo de falha ser na verdade superior ao tempo de censura observado.</p>
<p>Desta forma, faz-se uso da variável indicadora <span class="math inline">\(\delta_{i}\)</span>, apresentada na <a href="CI_ConceitosBasicos.html#sec-ReprDados" class="quarto-xref"><span>Seção 1.5</span></a>, que nos diz se o <span class="math inline">\(i\)</span>-ésimo tempo é tempo de falha ou de censura. Logo, são feitos alguns ajustes na função de verossimilhança. Tais ajustes fazem com que para <span class="math inline">\(\delta_{i} = 1\)</span>, o <span class="math inline">\(i\)</span>-ésimo tempo é tempo de falha e a contribução para <span class="math inline">\(L\)</span> é a própria função densidade de probabilidade, em contraste a isso, se <span class="math inline">\(\delta_{i} = 0\)</span>, o <span class="math inline">\(i\)</span>-ésimo tempo é tempo de censura e a contribuição dessa observação é a função de sobrevivência. Assim, a função de verossimilhança para um parâmetro ou um conjunto de parâmetros <span class="math inline">\(\theta\)</span> pode ser escrita como:</p>
<p><span id="eq-verossilGeneric"><span class="math display">\[
L (\theta) = \prod_{i = 1}^{n} \ [f (t_{i}, \theta)]^{\delta_{i}} \ [S(t_{i})]^{1 - \delta_{i}}
\tag{3.12}\]</span></span></p>
<p>A partir da deriva do log da verossimilhança igualada a zero, <span class="math display">\[\dfrac{\partial \ln L (\theta)}{\partial \theta} = 0,\]</span> é possível encontrar um valor para <span class="math inline">\(\theta\)</span> que maximize <span class="math inline">\(\ln L (\theta)\)</span>, portanto, maximize <span class="math inline">\(L (\theta)\)</span>.</p>
<section id="aplicações" class="level4" data-number="3.3.1.1">
<h4 data-number="3.3.1.1" class="anchored" data-anchor-id="aplicações"><span class="header-section-number">3.3.1.1</span> Aplicações</h4>
<p>Será mostrado nessa seção como encontrar o estimador ou estimadores de máxima verossimilhança para os parâmetros das disitribuições citadas.</p>
<section id="distribuição-exponecial" class="level5" data-number="3.3.1.1.1">
<h5 data-number="3.3.1.1.1" class="anchored" data-anchor-id="distribuição-exponecial"><span class="header-section-number">3.3.1.1.1</span> Distribuição Exponecial</h5>
<p>Para uma distribuição exponencial conforme descrita na <a href="#sec-DistExp" class="quarto-xref"><span>Seção 3.2.1</span></a>. O <em>Estimador de Máxima Verossimilhança</em> do parâmetro <span class="math inline">\(\alpha\)</span> pode ser obtido de acordo com os seguintes passos:</p>
<ol type="1">
<li>Determinar a função verossimilhança <span class="math inline">\(L (\alpha)\)</span>:</li>
</ol>
<span class="math display">\[\begin{align*}
    L (\alpha) &amp; = \prod_{i = 1}^{n} [\alpha \exp \{-\alpha t_{i}\}]^{\delta_{i}} [\exp \{-\alpha t_{i}\}]^{1 - \delta_{i}} \\
               &amp; = \prod_{i = 1}^{n} \alpha^{\delta_{i}} \exp \{ - \alpha t_{i} \}.
\end{align*}\]</span>
<ol start="2" type="1">
<li>Tomar o logaritmo da função verossimilhança <span class="math inline">\(\ln L (\alpha)\)</span>:</li>
</ol>
<span class="math display">\[\begin{align*}
    \ln L (\alpha) &amp; = \sum_{i = 1}^{n} \ln \left[ \alpha^{\delta_{i}} \exp \{ - \alpha t_{i} \} \right] = \sum_{i = 1}^{n} \ln \left[ \alpha^{\delta_{i}} \right] + \sum_{i = 1}^{n} \ln \left[ \exp \{ - \alpha t_{i} \} \right] \\
                   &amp; = \sum_{i = 1}^{n} \delta_{i} \ln \alpha + \sum_{i = 1}^{n} - \alpha t_{i} =  \ln \alpha \sum_{i = 1}^{n} \delta_{i} - \alpha \sum_{i = 1}^{n} t_{i}. \\
\end{align*}\]</span>
<ol start="3" type="1">
<li>Derivar a função do log da verossimilhança <span class="math inline">\(\dfrac{\partial \ln L (\theta)}{\partial \theta} = 0\)</span>:</li>
</ol>
<span class="math display">\[\begin{align*}
    \dfrac{\partial \ln L (\theta)}{\partial \theta}  &amp; = \dfrac{1}{\alpha} \sum_{i = 1}^{n} \delta_{i} - \sum_{i = 1}^{n} t_{i}.
\end{align*}\]</span>
<p>Ao igualar a derivada a zero e isolando <span class="math inline">\(\alpha\)</span> em um dos lados da igualdade e assuminado que a forma análitica de <span class="math inline">\(\alpha\)</span> obtida é um estimador de máxima verossimilhança temos:</p>
<span class="math display">\[\begin{align*}
    \dfrac{\partial \ln L (\theta)}{\partial \theta}  &amp; = 0 \\
    \dfrac{1}{\hat{\alpha}} \sum_{i = 1}^{n} \delta_{i} - \sum_{i = 1}^{n} t_{i} &amp; = 0 \\
    \hat{\alpha} &amp; = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\sum_{i = 1}^{n} t_{i}}
\end{align*}\]</span>
<p>Note que, para o caso em que não se tem censura o numerador, <span class="math inline">\(\sum_{i = 1}^{n} \delta_{i}\)</span>, equivale ao tamanho da amostra <span class="math inline">\(n\)</span>.</p>
<p>A seguir, temos um exemplo computacional. Simulou-se uma amostra proveniente de uma distribuição exponecial e a partir de tal amostra se obteve a estimativa de máxima verossimilhança do parâmetro <span class="math inline">\(\alpha\)</span> de tal amostra.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.1] FUNÇÕES</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="co"># Parâmetro de taxa (escala) populacional</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> alpha) <span class="co"># Simulando dados de uma exponencial</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>emvExp <span class="ot">&lt;-</span> n <span class="sc">/</span> <span class="fu">sum</span>(tempo) <span class="co"># EMV</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tempo =</span> tempo,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">St =</span> <span class="fu">Stexp</span>(tempo, alpha),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">emvSt =</span> <span class="fu">Stexp</span>(tempo, emvExp)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>O valor de verdadeiro do parâmetro <span class="math inline">\(\alpha =\)</span> 1.5. A estimativa de máxima verossimilhança obtida foi <span class="math inline">\(\hat{\alpha} =\)</span> 1.46.</p>
<p>Veja a <a href="#tbl-EMVexpSt" class="quarto-xref">Tabela&nbsp;<span>3.1</span></a> que mostra as dez primeiras observações e suas respectivas funções de sobrevivência, sobrevivência real e sobrevivência estimada.</p>
<div class="cell" data-tbl-cap-location="top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(dados), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Tempo"</span>, <span class="st">"S(t)"</span>, <span class="st">"S(t) EMV"</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">align =</span> <span class="st">'c'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-EMVexpSt" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="top">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-EMVexpSt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;3.1: Real e Estimado para as Funções de Sobrevivência
</figcaption>
<div aria-describedby="tbl-EMVexpSt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Tempo</th>
<th style="text-align: center;">S(t)</th>
<th style="text-align: center;">S(t) EMV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.5623048</td>
<td style="text-align: center;">0.4302206</td>
<td style="text-align: center;">0.4409133</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.3844068</td>
<td style="text-align: center;">0.5617995</td>
<td style="text-align: center;">0.5713079</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.8860366</td>
<td style="text-align: center;">0.2647273</td>
<td style="text-align: center;">0.2751688</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.0210516</td>
<td style="text-align: center;">0.9689160</td>
<td style="text-align: center;">0.9698070</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.0374740</td>
<td style="text-align: center;">0.9453397</td>
<td style="text-align: center;">0.9468876</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.2110008</td>
<td style="text-align: center;">0.7286941</td>
<td style="text-align: center;">0.7354381</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Temos também a comparação dessas duas curvas de sobrevivência, ilustradas na <a href="#fig-CompEMVexp" class="quarto-xref">Figura&nbsp;<span>3.10</span></a>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb18" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados, <span class="fu">aes</span>(<span class="at">x =</span> Tempo)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> St, <span class="at">color =</span> <span class="st">"alpha"</span>), <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> emvSt, <span class="at">color =</span> <span class="st">"emvAlpha"</span>), <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"alpha"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"emvAlpha"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(alpha), <span class="fu">expression</span>(<span class="fu">hat</span>(alpha)))) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Tempo"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">S</span>(t)), </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Parâmetro"</span>) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-CompEMVexp" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-CompEMVexp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.10: Comparação do verdadeiro valor do parâmetro α com sua estimativa de máxima verossimilhança.
</figcaption>
<div aria-describedby="fig-CompEMVexp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-CompEMVexp-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
<section id="distribuição-weibull" class="level5" data-number="3.3.1.1.2">
<h5 data-number="3.3.1.1.2" class="anchored" data-anchor-id="distribuição-weibull"><span class="header-section-number">3.3.1.1.2</span> Distribuição Weibull</h5>
<p>Para uma distribuição Weibull, descrita na <a href="#sec-DistWeibull" class="quarto-xref"><span>Seção 3.2.2</span></a> não há uma forma análitica para <span class="math inline">\(\gamma\)</span> e <span class="math inline">\(\alpha\)</span>. Logo, para obter a sua estimativa de máxima verossimilhança se usa um método de aproximação numérica, será introduzido aqui o <em>Método Iterativo de Newton-Raphson</em>.</p>
<p>O <strong>Método de Newton-Raphson</strong> é uma abordagem iterativa eficiente para resolver equações não lineares, sendo amplamente utilizado na estimação de parâmetros de distribuições estatísticas. Quando aplicado ao ajuste de distribuições, como a <strong>Weibull</strong> no contexto de análise de sobrevivência, o método busca maximizar a função de verossimilhança, resolvendo o sistema de equações derivado das condições de otimalidade (gradiente nulo).</p>
<p>A fórmula iterativa é:</p>
<p><span class="math display">\[
\theta_{n+1} = \theta_n - \mathbf{H}^{-1}(\theta_n) \nabla L(\theta_n),
\]</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(\theta_{n}\)</span> é o vetor de parâmetros estimados na iteração <span class="math inline">\(n\)</span>;</li>
<li><span class="math inline">\(L(\theta)\)</span> é a função log-verossimilhança;</li>
<li><span class="math inline">\(\nabla L(\theta)\)</span> é o vetor gradiente (derivadas parciais de <span class="math inline">\(L(\theta)\)</span>);</li>
<li><span class="math inline">\(\mathbf{H}(\theta)\)</span> é a matriz Hessiana (segunda derivada de <span class="math inline">\(L(\theta)\)</span>).</li>
</ul>
<p><strong>Vantagens no ajuste de distribuições:</strong></p>
<ul>
<li><strong>Eficiência</strong>: O método converge rapidamente quando o ponto inicial <span class="math inline">\(\theta_{0}\)</span> está próximo dos valores reais dos parâmetros.</li>
<li><strong>Flexibilidade</strong>: Adequa-se a diferentes modelos, como a distribuição Weibull, usada para modelar tempos de vida ou sobrevivência.</li>
</ul>
<p><strong>Cuidados na aplicação:</strong></p>
<ul>
<li><strong>Convergência</strong>: Garantida apenas se o ponto inicial estiver próximo da solução e as condições de regularidade forem atendidas.</li>
<li><strong>Cálculo da Hessiana</strong>: Pode ser computacionalmente intensivo para distribuições complexas.</li>
</ul>
<p>No caso da distribuição Weibull, a aplicação do método Newton-Raphson envolve derivadas em relação aos parâmetros de forma (<span class="math inline">\(\gamma\)</span>) e escala (<span class="math inline">\(\alpha\)</span>), permitindo ajustar o modelo aos dados observados de tempos de sobrevivência de forma precisa e eficiente.</p>
<p>Para utilizar o Método Iterativo de Newton-Raphson, pode-se escrever o algoritmo passo a passo. Outra forma, é usar a função do R <code>optim</code>. Será aprensatado as duas formas e seus detalhes serão comentados.</p>
<p>Começando pela construção do algoritmo passo a passo, precisamos definir algumas funções. A primeira é a função de verossimilhança da distribuição Weibull, que pode ser obtida a partir da <a href="#eq-verossilGeneric" class="quarto-xref">Equação&nbsp;<span>3.12</span></a> ao substituir respectivamente a função densidade e sobrevivência da distribuição Weibull respectivamente. Assim:</p>
<span class="math display">\[\begin{align*}
    L (\gamma, \alpha) &amp; = \prod_{i = 1}^{n} \left[ \gamma \alpha^{\gamma} t_{i}^{\gamma - 1} \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\} \right]^{\delta_{i}} \left[ \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\} \right]^{1 - \delta_{i}} \\
    &amp; = \prod_{i = 1}^{n} \left[ \dfrac{\gamma}{\alpha^{\gamma}} t^{\gamma - 1} \right]^{\delta_{i}}  \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\}
\end{align*}\]</span>
<p>Toma-se o logaritmo de <span class="math inline">\(L (\gamma, \alpha)\)</span>, logo:</p>
<span class="math display">\[\begin{align*}
    \ln L (\gamma, \alpha) &amp; = \sum_{i = 1}^{n} \delta_{i} \ln\{ \gamma \} - \sum_{i = 1}^{n} \delta_{i} \gamma \ln\{ \alpha \} + \sum_{i = 1}^{n} \delta_{i} (\gamma - 1) \ln \{ t_{i} \} + \sum_{i = 1}^{n} - (\alpha^{-1} t_{i})^{\gamma} \\
    &amp; = \ln\{ \gamma \} \sum_{i = 1}^{n} \delta_{i} - \gamma \ln\{ \alpha \} \sum_{i = 1}^{n} \delta_{i} + (\gamma - 1) \sum_{i = 1}^{n} \delta_{i} \ln \{ t_{i} \} + \sum_{i = 1}^{n} - (\alpha^{-1} t_{i})^{\gamma}
\end{align*}\]</span>
<p>Agora, aplica-se as derivadas de primeira ordem em relação a <span class="math inline">\(\gamma\)</span> e <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[
\dfrac{\partial \ln L (\gamma, \alpha)}{\partial \gamma} = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\gamma} - \ln\{\alpha\} \sum_{i = 1}^{n} \delta_{i} + \sum_{i = 1}^{n} \delta_{i} \ln\{t_{i}\} - \sum_{i = 1}^{n} (\alpha^{-1} t_{i})^{\gamma} \ln\{ (\alpha^{-1} t_{i})^{\gamma} \}
\]</span></p>
<p><span class="math display">\[
\dfrac{\partial \ln L (\gamma, \alpha)}{\partial \alpha} = - \dfrac{\gamma \sum_{i = 1}^{n} \delta_{i}}{\alpha} + \gamma \alpha^{- \gamma - 1}\sum_{i = 1}^{n} t_{i}^{\gamma}
\]</span></p>
<p>Toma-se agora as derivadas de segunda ordem.</p>
<p><span class="math display">\[
\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \gamma^{2}} = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\gamma^{2}} - \sum_{i = 1}^{n} (\alpha^{-1} t_{i})^{\gamma} [ \ln\{ (\alpha^{-1} t_{i})^{\gamma} \} ]^2
\]</span></p>
<p><span class="math display">\[
\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \alpha^{2}} = \dfrac{\gamma \sum_{i = 1}^{n} \delta_{i}}{\alpha^{2}} - \gamma (\gamma + 1) \alpha^{- \gamma - 2} \sum_{i = 1}^{n} t_{i}^{\gamma}
\]</span></p>
<p><span class="math display">\[
\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \gamma \partial \alpha} = - \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\alpha} + \sum_{i = 1}^{n} \dfrac{t_{i}^{\gamma}}{\alpha^{\gamma + 1}} \left( \gamma \ln \left\{ \dfrac{t_{i}}{\alpha} \right\} + 1 \right)
\]</span></p>
<p>Com todas as derivadas definidas, é possível definirmos algumas funções e variáveis que iremos precisar para utilizar o algoritmo de Newton-Raphson.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Era para ser um bloco de código. Porém, tal código está em manutenção"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Era para ser um bloco de código. Porém, tal código está em manutenção</code></pre>
</div>
</div>
<p>O bloco de código abaixo contém o algoritmo de Newton-Raphson.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Era para ser um bloco de código. Porém, tal código está em manutenção"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Era para ser um bloco de código. Porém, tal código está em manutenção</code></pre>
</div>
</div>
<p>O bloco abaixo mostra o uso da função <code>optim</code> para otimização.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Otimização</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Semente</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulação e Visualização do Dados</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tamanho da amostra</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Parâmetros da distribuição</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>wShape <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>wScale <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulação</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>dadosWeibull <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(n, <span class="at">shape =</span> wShape, <span class="at">scale =</span> wScale)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Função Log-verossimilhança</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>logWeibull <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, dados){</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> theta[<span class="dv">1</span>] <span class="co"># Parâmetro de forma</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> theta[<span class="dv">2</span>] <span class="co"># Parâmetro de escala</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(dados)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> dados</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>logverossimil <span class="ot">&lt;-</span> (n <span class="sc">*</span> <span class="fu">log</span>(gamma)) <span class="sc">-</span> (gamma <span class="sc">*</span> <span class="fu">log</span>(alpha) <span class="sc">*</span> n) <span class="sc">+</span> (gamma <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">log</span>(t)) <span class="sc">-</span> <span class="fu">sum</span>((t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="sc">-</span>logverossimil)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando a função optim</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>theta0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">1</span>) <span class="co"># Chute inicial</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> theta0, <span class="at">fn =</span> logWeibull, <span class="at">gr =</span> <span class="cn">NULL</span> , <span class="at">method =</span> <span class="st">"BFGS"</span> ,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">dados=</span>dadosWeibull)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>estimate</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1] 2.015515 1.507207

$value
[1] 999.1172

$counts
function gradient 
      52        9 

$convergence
[1] 0

$message
NULL

$hessian
          [,1]     [,2]
[1,]  451.7492 -281.952
[2,] -281.9520 1788.248</code></pre>
</div>
</div>
<p>Assim como na distribuição exponencial, será feita uma comparação entre o real e estimado.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AJUSTES DE FORMATAÇÃO</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>StWeibull <span class="ot">&lt;-</span> <span class="cf">function</span>(t, gamma, alpha) <span class="fu">exp</span>(<span class="sc">-</span>(t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Frame</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>dfWeibull <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tempo =</span> dadosWeibull,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">St =</span> <span class="fu">StWeibull</span>(dadosWeibull, wShape, wScale),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">EMVSt =</span> <span class="fu">StWeibull</span>(dadosWeibull, estimate<span class="sc">$</span>par[<span class="dv">1</span>], estimate<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Veja a <a href="#tbl-EMVweibullSt" class="quarto-xref">Tabela&nbsp;<span>3.2</span></a> que mostra as dez primeiras observações e suas respectivas funções de sobrevivência, sobrevivência real e sobrevivência estimada.</p>
<div class="cell" data-tbl-cap-location="top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(dfWeibull), </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Tempo"</span>, <span class="st">"S(t)"</span>, <span class="st">"S(t) EMV"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">align =</span> <span class="st">'c'</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-EMVweibullSt" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="top">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-EMVweibullSt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;3.2: Real e Estimado para as Funções de Sobrevivência da Distribuição Weibull
</figcaption>
<div aria-describedby="tbl-EMVweibullSt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Tempo</th>
<th style="text-align: center;">S(t)</th>
<th style="text-align: center;">S(t) EMV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1.6745421</td>
<td style="text-align: center;">0.2875775</td>
<td style="text-align: center;">0.2904304</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.7315788</td>
<td style="text-align: center;">0.7883051</td>
<td style="text-align: center;">0.7921747</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.4183502</td>
<td style="text-align: center;">0.4089769</td>
<td style="text-align: center;">0.4128247</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.5290778</td>
<td style="text-align: center;">0.8830174</td>
<td style="text-align: center;">0.8858229</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.3716200</td>
<td style="text-align: center;">0.9404673</td>
<td style="text-align: center;">0.9422483</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.6362482</td>
<td style="text-align: center;">0.0455565</td>
<td style="text-align: center;">0.0456849</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Temos também a comparação dessas duas curvas de sobrevivência, ilustradas na <a href="#fig-CompEMVWeibull" class="quarto-xref">Figura&nbsp;<span>3.11</span></a>.</p>
<div class="cell fig-cap-location-top">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb27" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfWeibull, <span class="fu">aes</span>(<span class="at">x =</span> Tempo)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> St, <span class="at">color =</span> <span class="st">"Verdadeiro"</span>), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> EMVSt, <span class="at">color =</span> <span class="st">"EMV"</span>), <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Verdadeiro"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"EMV"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Verdadeiro"</span> <span class="ot">=</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Verdadeiro: "</span>, gamma, <span class="st">", "</span>, alpha)),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EMV"</span> <span class="ot">=</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"EMV: "</span>, <span class="fu">hat</span>(gamma), <span class="st">", "</span>, <span class="fu">hat</span>(alpha)))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Tempo"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">S</span>(t)), </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Parâmetros"</span>) <span class="sc">+</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-CompEMVWeibull" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="top">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-CompEMVWeibull-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.11: Comparação do verdadeiro valor dos parâmetros γ e α com suas estimativas de máxima verossimilhança.
</figcaption>
<div aria-describedby="fig-CompEMVWeibull-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CIII_ModelProb_files/figure-html/fig-CompEMVWeibull-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
<section id="distribuição-log-normal" class="level5" data-number="3.3.1.1.3">
<h5 data-number="3.3.1.1.3" class="anchored" data-anchor-id="distribuição-log-normal"><span class="header-section-number">3.3.1.1.3</span> Distribuição Log-Normal</h5>
</section>
</section>
<section id="aplicações-com-censura" class="level4" data-number="3.3.1.2">
<h4 data-number="3.3.1.2" class="anchored" data-anchor-id="aplicações-com-censura"><span class="header-section-number">3.3.1.2</span> Aplicações com Censura</h4>
<p>Podemos utilizar os conhecimentos até aqui obtidos para modelar e estimar parâmetros, e consequentemente, curvas de sobrevivência onde exista censura. Vejamos os blocos de códigos a seguir.</p>
<ol type="1">
<li>Ativamos os pacotes necessários:</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] Ativação de Pacotes</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Simulamos os dados com censura:</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] Simulação dos Dados</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo Semente</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parâmetros</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>       <span class="co"># Número total de observações</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="dv">2</span>      <span class="co"># Parâmetro shape da Weibull</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">1.5</span>    <span class="co"># Parâmetro scale da Weibull</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>TaxaExp <span class="ot">&lt;-</span> <span class="dv">1</span>    <span class="co"># Taxa da distribuição exponencial</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>propCens <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="co"># Proporção desejada de censuras</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Vetores para armazenar os resultados</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>Tobservado <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>indCensura <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Contadores</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>nFalhas <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>nCensuras <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop para gerar os tempos</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gerar um tempo de falha e um tempo de censura</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  Tfalha <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(<span class="dv">1</span>, <span class="at">shape =</span> gamma, <span class="at">scale =</span> alpha)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  Tcensu <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1</span>, <span class="at">rate =</span> TaxaExp)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar qual é o menor tempo</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (Tfalha <span class="sc">&lt;=</span> Tcensu) {</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    Tobservado[i] <span class="ot">&lt;-</span> Tfalha</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    indCensura[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Falha</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    nFalhas <span class="ot">&lt;-</span> nFalhas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nCensuras <span class="sc">&lt;</span> propCens <span class="sc">*</span> n) {</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>      Tobservado[i] <span class="ot">&lt;-</span> Tcensu</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>      indCensura[i] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Censura</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>      nCensuras <span class="ot">&lt;-</span> nCensuras <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      Tobservado[i] <span class="ot">&lt;-</span> Tfalha</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>      indCensura[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Falha</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>      nFalhas <span class="ot">&lt;-</span> nFalhas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar as proporções</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporção de falhas:"</span>, nFalhas <span class="sc">/</span> n, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Proporção de falhas: 0.666 </code></pre>
</div>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporção de censuras:"</span>, nCensuras <span class="sc">/</span> n, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Proporção de censuras: 0.334 </code></pre>
</div>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dados simulados</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Tempo =</span> Tobservado, <span class="at">Censura =</span> indCensura)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dados, <span class="fu">aes</span>(<span class="at">x =</span> Tempo)) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histograma do Tempo de Sobrevivência - Simulação"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Frequência"</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CIII_ModelProb_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Estimação Não Paramétrica.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] Estimação</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.1] Estimação Não Paramátrica</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.1.1] Estimador de Kaplan-Meier</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo de Kaplan-Meier</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>ekm <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(Tempo, Censura) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dados)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatando como DataFrame</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>DataEKM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> ekm<span class="sc">$</span>time, <span class="at">Survival =</span> ekm<span class="sc">$</span>surv, <span class="at">Type =</span> <span class="st">"Kaplan-Meier"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização da curva</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> DataEKM, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t) - Kaplan-Meier"</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CIII_ModelProb_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Estimação Não Paramétrica - Distribuição Exponencial.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.2] Estimação Paramátrica</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.2.1] Distribuição Exponencial</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV de α</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>emvExp <span class="ot">&lt;-</span> <span class="fu">sum</span>(dados<span class="sc">$</span>Censura) <span class="sc">/</span> <span class="fu">sum</span>(dados<span class="sc">$</span>Tempo)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV da Sobrevivência</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>EMVSurvExp <span class="ot">&lt;-</span> <span class="fu">Stexp</span>(dados<span class="sc">$</span>Tempo, emvExp)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatando como DataFrame</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>DataExp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> dados<span class="sc">$</span>Tempo, <span class="at">Survival =</span> EMVSurvExp, <span class="at">Type =</span> <span class="st">"Exponencial"</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização da curva</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> DataExp, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t) - Exponencial"</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CIII_ModelProb_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li><ol start="4" type="1">
<li>Estimação Não Paramétrica - Distribuição Weibull.</li>
</ol>
<p>::: {.cell}</p>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.2.1] Distribuição Weibull</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>StWeibull <span class="ot">&lt;-</span> <span class="cf">function</span>(t, gamma, alpha) <span class="fu">exp</span>(<span class="sc">-</span>(t <span class="sc">/</span> alpha)<span class="sc">^</span>gamma)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV de γ e α</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Função Log-verossimilhança</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>logWeibull <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, dados){</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> theta[<span class="dv">1</span>] <span class="co"># Parâmetro de forma</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> theta[<span class="dv">2</span>] <span class="co"># Parâmetro de escala</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> dados<span class="sc">$</span>Tempo   <span class="co"># Tempo de falha</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> dados<span class="sc">$</span>Censura <span class="co"># Variável indicadora</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  logv <span class="ot">&lt;-</span> (<span class="fu">sum</span>(c) <span class="sc">*</span> <span class="fu">log</span>(gamma)) <span class="sc">-</span> (gamma <span class="sc">*</span> <span class="fu">log</span>(alpha) <span class="sc">*</span> <span class="fu">sum</span>(c)) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>(gamma <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(c <span class="sc">*</span> <span class="fu">log</span>(t)) <span class="sc">-</span> <span class="fu">sum</span>((t <span class="sc">/</span> alpha)<span class="sc">^</span>gamma)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>logv)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Otimizando</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>Theta0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">1</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> Theta0, <span class="at">fn =</span> logWeibull,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">gr =</span> <span class="cn">NULL</span>, <span class="at">method =</span> <span class="st">"BFGS"</span>, <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">dados =</span> dados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>::: {.cell-output .cell-output-stderr}</p>
<pre><code>Warning in log(gamma): NaNs produzidos
Warning in log(gamma): NaNs produzidos
Warning in log(gamma): NaNs produzidos</code></pre>
<p>:::</p>
<p>::: {.cell-output .cell-output-stderr}</p>
<pre><code>Warning in log(alpha): NaNs produzidos
Warning in log(alpha): NaNs produzidos
Warning in log(alpha): NaNs produzidos
Warning in log(alpha): NaNs produzidos
Warning in log(alpha): NaNs produzidos
Warning in log(alpha): NaNs produzidos</code></pre>
<p>:::</p>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>estimate</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>::: {.cell-output .cell-output-stdout}</p>
<pre><code>$par
[1] 2.013314 1.535915

$value
[1] 745.9756

$counts
function gradient 
      31        9 

$convergence
[1] 0

$message
NULL

$hessian
          [,1]       [,2]
[1,] 304.76432  -96.91392
[2,] -96.91392 1144.24624</code></pre>
<p>:::</p>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV da Sobrevivência</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>EMVSurvWeib <span class="ot">&lt;-</span> <span class="fu">StWeibull</span>(dados<span class="sc">$</span>Tempo, estimate<span class="sc">$</span>par[<span class="dv">1</span>], estimate<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatando como DataFrame</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>DataWeib <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> dados<span class="sc">$</span>Tempo, <span class="at">Survival =</span> EMVSurvWeib, <span class="at">Type =</span> <span class="st">"Weibull"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização da curva</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> DataWeib, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t) - Weibull"</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>::: {.cell-output-display} <img src="CIII_ModelProb_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"> ::: :::</p></li>
</ol>
<p>Por fim, com o objetivo de fazer uma comparação, visual, temos a Figura abaixo.</p>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] Análise Conjunta</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Unindo os dados para visualização</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>AllData <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DataEKM, DataExp, DataWeib)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico com ggplot2</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(AllData, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Type, <span class="at">linetype =</span> Type), <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t): Kaplan-Meier, Weibull e Exponencial"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># c("solid", "dashed", "dotted")</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CIII_ModelProb_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="progress">
<div class="progress-bar" style="width: 100%;">

</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./CII_EstimNaoParam.html" class="pagination-link" aria-label="Técnicas Não Paramétricas">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Técnicas Não Paramétricas</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Código fonte</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="in">  body{text-align: justify}</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>:::: progress</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>::: {.progress-bar style="width: 100%;"}</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Técnicas Paramétricas - Modelos Probabilísticos</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introdução</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>No Capítulo anteriror, foi vista uma abordagem não paramétrica, onde, a estimação é feita sem se referir a uma distribuição de probabilidade específica para o tempo de sobrevivência.</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>Obtendo os estimadores não paramétricos diretamente do conjunto de dados. Supondo que o mecanismo gerador dessas informações opere de forma distinta em diferentes momentos no tempo. Funcionando de forma quase que independente, desta forma, conclui-se que a estimação não paramétrica têm tantos parâmetros quanto intervalos no tempo. Ao incluir covariáveis, o modelo de *Kaplan-Meier* não permite estimar o "efeito" das cováriaveis, mas apenas comparar e testar a igualdade entre duas curvas de sobrevivência.</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>De acordo com a distribuição de probabilidade que acredita-se descrever a variável resposta $Y$, e de acordo com a função escolhida para a relação de $Y$ com as covariáveis $x_{1}, x_{2}, \cdots, x_{p}$, identifica-se o modelo de regressão como: *Linear*, *Poisson*, *Logísitico*, entre outros. Aplica-se a ideia em análise de sobrevivência, de forma que o tempo de ocorrência até um evento de interesse é a variável resposta.</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>Nesse contexto, neste Capítulo é vista uma abordagem paramétrica para estimar as funções básicas de sobrevivência. Onde se assume como conhecida a distribuição de probabilidade do tempo de evento e, desta forma, os parâmetros seram estimados.</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribuições do Tempo de Sobrevivência</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>Seja $T$ uma variável aleatória que representa "tempo de sobrevivênvia", qual a distribuição de probabilidade poderia representa-lá?</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>Como uma característica da variável aleatória $T$ é contínua e não negativa, pode-se a partir dessa caracater´sitica, remover algumas distribuições da lista de possíveis distribuições de probabilidades de $T$. Desta forma, a distribuição normal já não se torna adequada, pois tal distribuição permite valores negativos. Além disso, o tempo de sobrevivência contém, frequentemente, uma forte assimetria à direita.</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>Entre os modelos paramétricos, utiliza-se muito a classe **tempo de vida acelerado**. Em tal classe, o tempo de sobrevivência $T$, obdesce a seguinte relação:</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>\ln(T) = \mu + \sigma W,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>$$ {#eq-TempVidaAcel}</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>onde $\mu$ é o parâmetro que representa a média de $\ln(T)$ e $\sigma$ sua dispersão, mas usualmente denominados, respectivamnete, parâmetros de locação e escala. $W$ é uma variável aleatória que possa representar $\ln(T)$ a partir de uma distribuição de probabilidade.</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distribuição Exponencial {#sec-DistExp}</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>Se $T \sim Exp(\alpha)$, a sua função densidade de probabilidade é expressa da seguinte forma:</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>f(t) = \alpha e^{-\alpha t}, \ t \geq 0 \ \text{e} \ \alpha &gt; 0.</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>$$ {#eq-densitExp}</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>Desta forma, para obtermos, por exemplo, a função de sobrevivência basta integrarmos a função densidade de probabilidade, veja:</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="in">    S(t) &amp; = P(T \geq t) = \int_{t}^{\infty} \alpha e^{-\alpha t} \ dt \\</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="in">         &amp; = \alpha \int_{t}^{\infty} e^{-\alpha t} \ dt = \alpha \int_{t}^{\infty} e^{u} \ \frac{du}{- \alpha} \\</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="in">         &amp; = \frac{\alpha}{-\alpha} \int_{t}^{\infty} e^{u} \ du = - \left[ e^{u} \right]_{t}^{\infty} = - \left[ e^{- \alpha t} \right]_{t}^{\infty} \\</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="in">         &amp; = - [ e^{- \alpha \infty} - e^{- \alpha t}] = - [0 - e^{- \alpha t}] = e^{- \alpha t}.</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>Assim, foramalmente, a função de sobrevivência é expressa por:</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>S(t) = e^{- \alpha t}.</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>$$ {#eq-StExp}</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>Note que o parâmetro $\alpha$ é a velocidade de queda da função sobrevivência. Através das relações entre as funções em análise de sobrevivência, temos a função risco ou taxa de falha. Obtida pela razão entre a densidade de probabilidade e a função de sobrevivência:</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>\lambda(t) = \dfrac{f(t)}{S(t)} = \dfrac{\alpha e^{-\alpha t}}{e^{-\alpha t}} = \alpha = \text{constante}.</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>$$ {#eq-RiscoExp}</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>Sendo a função risco constante para todo tempo observado $t$, o risco acumulado é função linear no tempo com uma inclinação na reta dado por $\alpha$:</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>\Lambda = - \ln<span class="co">[</span><span class="ot">S(t)</span><span class="co">]</span> = - \ln<span class="co">[</span><span class="ot">e^{-\alpha t}</span><span class="co">]</span> = - (- \alpha t) = \alpha t</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>$$ {#eq-RiscoAcumExp}</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro $\alpha$.</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] DISTRIBUIÇÃO EXPONENCIAL</span></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.1] FUNÇÕES</span></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a><span class="co"># As funções de sobrevivência, risco e risco acumulado são simplificadas</span></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>htexp <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha) <span class="fu">rep</span>(alpha, <span class="fu">length</span>(t))</span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>Ltexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) alpha <span class="sc">*</span> t</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> <span class="dv">1</span>) <span class="co"># Simulando dados de uma exponencial</span></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)     <span class="co"># Valores de alpha a serem avaliados</span></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(alphas, <span class="cf">function</span>(alpha) {</span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">Stexp</span>(tempo, alpha),</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htexp</span>(alpha),</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">Ltexp</span>(tempo, alpha),</span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fu">factor</span>(alpha)</span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a><span class="co"># [1.3] GRÁFICOS</span></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando uma função para gerar gráficos</span></span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> alpha)) <span class="sc">+</span></span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(alpha)) <span class="sc">+</span></span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(alphas, <span class="cf">function</span>(a) <span class="fu">bquote</span>(alpha <span class="sc">==</span> .(a)))) <span class="sc">+</span></span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-SobrExp. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro $\alpha$.</span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-134"><a href="#cb43-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-135"><a href="#cb43-135" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Sobrevivência para diferentes valores de α"</span></span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-SobrExp</span></span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Sobrevivência</span></span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "St", "S(t)", c("red", "blue", "green"), expression(S(t)))</span></span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscExp. Tal Figura mostra a função de risco para diferentes valores do parâmetro $\alpha$.</span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco para diferentes valores de α"</span></span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscExp</span></span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco</span></span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "ht", expression(lambda(t)), c("red", "blue", "green"), expression(lambda(t)))</span></span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-154"><a href="#cb43-154" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscAcumulExp. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro $\alpha$.</span>
<span id="cb43-155"><a href="#cb43-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco Acumulado para diferentes valores de α"</span></span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscAcumulExp</span></span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco Acumulado</span></span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "Lt", expression(Lambda(t)), c("red", "blue", "green"), expression(Lambda(t)))</span></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Algumas Considerações</span></span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-167"><a href="#cb43-167" aria-hidden="true" tabindex="-1"></a>Note que quanto maior o valor de $\alpha$ (risco), mas abruptamente a função de sobrevivência $S(t)$ decresce e maior é a inclinação que representa o risco acumulado.</span>
<span id="cb43-168"><a href="#cb43-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-169"><a href="#cb43-169" aria-hidden="true" tabindex="-1"></a>Como a distribuição exponencial possui um único parâmetro se torna matematicamente simples além de possuir um formato assimétrico.</span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a>O seu uso em análise de sobrevivência tem certa analogia com a presuposição de normalidade em outras técnicas e áreas da estatísticas. Porém, seu presuposto de risco constante é uma afirmação muuito forte a se fazer a respeito do risco. Por exemplo, está sendo realizado um estudo sobre o cancêr, o tempo de evento de tal experimento é o tempo até que ocorra a morte ou cura do paciente. Para aplicar a distribuição exponecial para modelar esse problema seria necessário pensar que o tempo desde o diagnóstico da doênça não afeta o tempo de ocorrência do evento. O que é delicado de se aceitar, tendo em vista que o prórprio passar do tempo afeta a probabilidade de sobrevivência, o risco, risco acumulado, etc. Tendo em vista que, isso pode ser simplismente por causas naturais como aumento da idade ao passar do tempo (envelhecimento), por exemplo. Desta forma, está consequência da distribuição exponencial, isso é denominado de **falta de memória da distribuição normal**.</span>
<span id="cb43-172"><a href="#cb43-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-173"><a href="#cb43-173" aria-hidden="true" tabindex="-1"></a>Quando $\alpha = 1$, diz-se que a **distribuição exponecial padrão**. A média $\left( E<span class="co">[</span><span class="ot">t</span><span class="co">]</span> \right)$ e variância $\left( Var<span class="co">[</span><span class="ot">T</span><span class="co">]</span> \right)$ do tempo de sobrevivência, quando este seguir uma distribuição em Exponecial, são obtidas a partir da inversa do risco ($\alpha$). Quanto maior o risco, menor o tempo médio de sobrevivência e menor variabilidade deste em torno na média.</span>
<span id="cb43-174"><a href="#cb43-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-175"><a href="#cb43-175" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-176"><a href="#cb43-176" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \dfrac{1}{\alpha}</span>
<span id="cb43-177"><a href="#cb43-177" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-178"><a href="#cb43-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-179"><a href="#cb43-179" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-180"><a href="#cb43-180" aria-hidden="true" tabindex="-1"></a>Var<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \dfrac{1}{\alpha^2}</span>
<span id="cb43-181"><a href="#cb43-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-182"><a href="#cb43-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-183"><a href="#cb43-183" aria-hidden="true" tabindex="-1"></a>Ao afirmar que o tempo de sobrevivência $T$ segue uma distribuição de exponencial equivale a dizer que na @eq-TempVidaAcel, $W$ segue uma distribuição valor extremo padrão, $\sigma = 1$. Assim para cada tempo $t$, a @eq-TempVidaAcel é escrita da seguinte forma: $\ln(T) = \mu + w$, como a $E<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \frac{1}{\alpha}$ na distribuição exponencial, tem-se que: $$\mu = - \ln(\alpha).$$</span>
<span id="cb43-184"><a href="#cb43-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-185"><a href="#cb43-185" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Essa é uma forma de parametrização dos modelos parâmetricos utilizada no R, isto é, o parâmetro $\alpha = e^{-\mu}$.</span></span>
<span id="cb43-186"><a href="#cb43-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-187"><a href="#cb43-187" aria-hidden="true" tabindex="-1"></a>Como a distribuição de $T$ é assimétrica, se torna mais usual utilizar o *tempo mediano de sobrevivência* ao invés de tempo médio. Pode-se obter o tempo mediano de sobrevivência a partir de um tempo $t$, tal que, $S(t) = 0,5$, logo</span>
<span id="cb43-188"><a href="#cb43-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-189"><a href="#cb43-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-190"><a href="#cb43-190" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-191"><a href="#cb43-191" aria-hidden="true" tabindex="-1"></a><span class="in">    S(t) &amp; = 0,5 \Leftrightarrow e^{-\alpha t} = 0,5 \Leftrightarrow -\alpha t = \ln(1/2) \\</span></span>
<span id="cb43-192"><a href="#cb43-192" aria-hidden="true" tabindex="-1"></a><span class="in">    \alpha t &amp; = - \ln(2^{-1}) \Leftrightarrow \alpha t = \ln((2^{-1})^{-1}) \\</span></span>
<span id="cb43-193"><a href="#cb43-193" aria-hidden="true" tabindex="-1"></a><span class="in">    \alpha t &amp; = - \ln(2).</span></span>
<span id="cb43-194"><a href="#cb43-194" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-195"><a href="#cb43-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-196"><a href="#cb43-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-197"><a href="#cb43-197" aria-hidden="true" tabindex="-1"></a>Desta forma, o tempo mediano de sobrevivência é definido como:</span>
<span id="cb43-198"><a href="#cb43-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-199"><a href="#cb43-199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-200"><a href="#cb43-200" aria-hidden="true" tabindex="-1"></a>T_{mediano} = \dfrac{\ln(2)}{\alpha}.</span>
<span id="cb43-201"><a href="#cb43-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-202"><a href="#cb43-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-203"><a href="#cb43-203" aria-hidden="true" tabindex="-1"></a>Em suma, o modelo exponecial se torna adequado quando o período do experimento é curto para que a supocisão de risco constante possa ser antendida.</span>
<span id="cb43-204"><a href="#cb43-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-205"><a href="#cb43-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distribuição Weibull {#sec-DistWeibull}</span></span>
<span id="cb43-206"><a href="#cb43-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-207"><a href="#cb43-207" aria-hidden="true" tabindex="-1"></a>Na maioria do casos de análise de sobrevivência na área da saúde, se torna mais lógico supor que o risco não é constante ao longo do tempo.</span>
<span id="cb43-208"><a href="#cb43-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-209"><a href="#cb43-209" aria-hidden="true" tabindex="-1"></a>Atualmente, a *Distribuição Weibull* é mais utilizada, pois permite a variação do risco ao longo do tempo. Será possível ver que a distribuição exponencial é um caso particular da distribuição weibull.</span>
<span id="cb43-210"><a href="#cb43-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-211"><a href="#cb43-211" aria-hidden="true" tabindex="-1"></a>Se o tempo de sobrevivência $T$ segue uma distribuição Weibull, isto é, $T \sim Weibull(\alpha, \gamma)$, sua função densidade de probabilidade é expressa por:</span>
<span id="cb43-212"><a href="#cb43-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-213"><a href="#cb43-213" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-214"><a href="#cb43-214" aria-hidden="true" tabindex="-1"></a>f(t) = \gamma \alpha^{\gamma} t^{\gamma - 1} \exp \left<span class="sc">\{</span> -\left( \dfrac{t}{\alpha} \right)^{\gamma} \right<span class="sc">\}</span>.</span>
<span id="cb43-215"><a href="#cb43-215" aria-hidden="true" tabindex="-1"></a>$$ {#eq-densitWei}</span>
<span id="cb43-216"><a href="#cb43-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-217"><a href="#cb43-217" aria-hidden="true" tabindex="-1"></a>A partir da @eq-densitWei é possível chegar a função de sobrevivência da distribuição Weibull sendo está função definida como:</span>
<span id="cb43-218"><a href="#cb43-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-219"><a href="#cb43-219" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-220"><a href="#cb43-220" aria-hidden="true" tabindex="-1"></a>S (t) = \exp \left<span class="sc">\{</span> -\left( \dfrac{t}{\alpha} \right)^{\gamma} \right<span class="sc">\}</span>,</span>
<span id="cb43-221"><a href="#cb43-221" aria-hidden="true" tabindex="-1"></a>$$ {#eq-StWeibull}</span>
<span id="cb43-222"><a href="#cb43-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-223"><a href="#cb43-223" aria-hidden="true" tabindex="-1"></a>onde $t \geq 0$, $\alpha$ o parâmetro taxa e $\gamma$ parâmetro de forma. Ambos os parâmetros sempre positivos.</span>
<span id="cb43-224"><a href="#cb43-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-225"><a href="#cb43-225" aria-hidden="true" tabindex="-1"></a>A função de risco, $\lambda(t)$, depende do tempo de sobrevivência. Apresentando variação no tempo conforme a expressão:</span>
<span id="cb43-226"><a href="#cb43-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-227"><a href="#cb43-227" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-228"><a href="#cb43-228" aria-hidden="true" tabindex="-1"></a>\lambda (t) = \gamma \alpha^{\gamma} t^{\gamma - 1}</span>
<span id="cb43-229"><a href="#cb43-229" aria-hidden="true" tabindex="-1"></a>$$ {#eq-RiscoWeibull}</span>
<span id="cb43-230"><a href="#cb43-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-231"><a href="#cb43-231" aria-hidden="true" tabindex="-1"></a>e a função de risco acumulado da distribuição Weibull é dada por:</span>
<span id="cb43-232"><a href="#cb43-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-233"><a href="#cb43-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-234"><a href="#cb43-234" aria-hidden="true" tabindex="-1"></a>\Lambda (t) = - \ln S (t) = -\left( \dfrac{t}{\alpha} \right)^{\gamma}.</span>
<span id="cb43-235"><a href="#cb43-235" aria-hidden="true" tabindex="-1"></a>$$ {#eq-RiscAcumWeibull}</span>
<span id="cb43-236"><a href="#cb43-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-237"><a href="#cb43-237" aria-hidden="true" tabindex="-1"></a>Note que, o parâmetro $\gamma$ determina a forma função de risco da seguinte maneira:</span>
<span id="cb43-238"><a href="#cb43-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-239"><a href="#cb43-239" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\gamma &lt; 1 \rightarrow$ função de risco decresce;</span>
<span id="cb43-240"><a href="#cb43-240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\gamma &gt; 1 \rightarrow$ função de risco cresce;</span>
<span id="cb43-241"><a href="#cb43-241" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\gamma &gt; 1 \rightarrow$ a função de risco se torna constante, caindo no caso particular da distribuição exponencial.</span>
<span id="cb43-242"><a href="#cb43-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-243"><a href="#cb43-243" aria-hidden="true" tabindex="-1"></a>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro $\gamma$.</span>
<span id="cb43-244"><a href="#cb43-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-247"><a href="#cb43-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-248"><a href="#cb43-248" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-249"><a href="#cb43-249" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-250"><a href="#cb43-250" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb43-251"><a href="#cb43-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-252"><a href="#cb43-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-255"><a href="#cb43-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-256"><a href="#cb43-256" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb43-257"><a href="#cb43-257" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] DISTRIBUIÇÃO WEIBULL</span></span>
<span id="cb43-258"><a href="#cb43-258" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb43-259"><a href="#cb43-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-260"><a href="#cb43-260" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-261"><a href="#cb43-261" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.1] FUNÇÕES</span></span>
<span id="cb43-262"><a href="#cb43-262" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-263"><a href="#cb43-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-264"><a href="#cb43-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Funções para Weibull</span></span>
<span id="cb43-265"><a href="#cb43-265" aria-hidden="true" tabindex="-1"></a>StWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) <span class="fu">exp</span>(<span class="sc">-</span>(t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma)</span>
<span id="cb43-266"><a href="#cb43-266" aria-hidden="true" tabindex="-1"></a>htWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) gamma <span class="sc">*</span> (alpha<span class="sc">^</span>gamma) <span class="sc">*</span> t<span class="sc">^</span>(gamma <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb43-267"><a href="#cb43-267" aria-hidden="true" tabindex="-1"></a>LtWei <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha, gamma) (t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma</span>
<span id="cb43-268"><a href="#cb43-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-269"><a href="#cb43-269" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-270"><a href="#cb43-270" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb43-271"><a href="#cb43-271" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-272"><a href="#cb43-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-273"><a href="#cb43-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulando dados de uma Weibull</span></span>
<span id="cb43-274"><a href="#cb43-274" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(n, <span class="at">shape =</span> <span class="dv">2</span>, <span class="at">scale =</span> <span class="dv">1</span>)</span>
<span id="cb43-275"><a href="#cb43-275" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span>   <span class="co"># Fixo para simplificar</span></span>
<span id="cb43-276"><a href="#cb43-276" aria-hidden="true" tabindex="-1"></a>gammas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">2.5</span>, <span class="fl">3.0</span>) <span class="co"># Valores de gamma</span></span>
<span id="cb43-277"><a href="#cb43-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-278"><a href="#cb43-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb43-279"><a href="#cb43-279" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(gammas, <span class="cf">function</span>(gamma) {</span>
<span id="cb43-280"><a href="#cb43-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb43-281"><a href="#cb43-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb43-282"><a href="#cb43-282" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">StWei</span>(tempo, alpha, gamma),</span>
<span id="cb43-283"><a href="#cb43-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htWei</span>(tempo, alpha, gamma),</span>
<span id="cb43-284"><a href="#cb43-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">LtWei</span>(tempo, alpha, gamma),</span>
<span id="cb43-285"><a href="#cb43-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">gamma =</span> <span class="fu">factor</span>(gamma)</span>
<span id="cb43-286"><a href="#cb43-286" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-287"><a href="#cb43-287" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb43-288"><a href="#cb43-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-289"><a href="#cb43-289" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------</span></span>
<span id="cb43-290"><a href="#cb43-290" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.3] GRÁFICOS</span></span>
<span id="cb43-291"><a href="#cb43-291" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------</span></span>
<span id="cb43-292"><a href="#cb43-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-293"><a href="#cb43-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Função genérica para gráficos</span></span>
<span id="cb43-294"><a href="#cb43-294" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb43-295"><a href="#cb43-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> gamma)) <span class="sc">+</span></span>
<span id="cb43-296"><a href="#cb43-296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-297"><a href="#cb43-297" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(gamma)) <span class="sc">+</span></span>
<span id="cb43-298"><a href="#cb43-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb43-299"><a href="#cb43-299" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(gammas, <span class="cf">function</span>(g) <span class="fu">bquote</span>(gamma <span class="sc">==</span> .(g)))) <span class="sc">+</span></span>
<span id="cb43-300"><a href="#cb43-300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb43-301"><a href="#cb43-301" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-302"><a href="#cb43-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-303"><a href="#cb43-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleta de cores</span></span>
<span id="cb43-304"><a href="#cb43-304" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"brown"</span>)</span>
<span id="cb43-305"><a href="#cb43-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-306"><a href="#cb43-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-307"><a href="#cb43-307" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-SobrWei. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro $\gamma$.</span>
<span id="cb43-308"><a href="#cb43-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-309"><a href="#cb43-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-310"><a href="#cb43-310" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Sobrevivência para diferentes valores de γ"</span></span>
<span id="cb43-311"><a href="#cb43-311" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-SobrWei</span></span>
<span id="cb43-312"><a href="#cb43-312" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-313"><a href="#cb43-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-314"><a href="#cb43-314" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Sobrevivência</span></span>
<span id="cb43-315"><a href="#cb43-315" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "St", expression(S(t)), color_values, expression(S(t)))</span></span>
<span id="cb43-316"><a href="#cb43-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-317"><a href="#cb43-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-318"><a href="#cb43-318" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscWei. Tal Figura mostra a função de risco para diferentes valores do parâmetro $\gamma$.</span>
<span id="cb43-319"><a href="#cb43-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-320"><a href="#cb43-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-321"><a href="#cb43-321" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco para diferentes valores de γ"</span></span>
<span id="cb43-322"><a href="#cb43-322" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscWei</span></span>
<span id="cb43-323"><a href="#cb43-323" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-324"><a href="#cb43-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-325"><a href="#cb43-325" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco</span></span>
<span id="cb43-326"><a href="#cb43-326" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "ht", expression(lambda(t)), color_values, expression(lambda(t)))</span></span>
<span id="cb43-327"><a href="#cb43-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-328"><a href="#cb43-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-329"><a href="#cb43-329" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscAcumWei. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro $\gamma$.</span>
<span id="cb43-330"><a href="#cb43-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-331"><a href="#cb43-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-332"><a href="#cb43-332" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco Acumulado para diferentes valores de γ"</span></span>
<span id="cb43-333"><a href="#cb43-333" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscAcumWei</span></span>
<span id="cb43-334"><a href="#cb43-334" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-335"><a href="#cb43-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-336"><a href="#cb43-336" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco Acumulado</span></span>
<span id="cb43-337"><a href="#cb43-337" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "Lt", expression(Lambda(t)), color_values, expression(Lambda(t)))</span></span>
<span id="cb43-338"><a href="#cb43-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-339"><a href="#cb43-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-340"><a href="#cb43-340" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Algumas Considerações</span></span>
<span id="cb43-341"><a href="#cb43-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-342"><a href="#cb43-342" aria-hidden="true" tabindex="-1"></a>É incluso a função gama na média e variância da distribuição Weibull, assim,</span>
<span id="cb43-343"><a href="#cb43-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-344"><a href="#cb43-344" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-345"><a href="#cb43-345" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \alpha \Gamma<span class="co">[</span><span class="ot">1 + (1/\gamma)</span><span class="co">]</span></span>
<span id="cb43-346"><a href="#cb43-346" aria-hidden="true" tabindex="-1"></a>$$ $$</span>
<span id="cb43-347"><a href="#cb43-347" aria-hidden="true" tabindex="-1"></a>Var<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = a^{2} \left<span class="co">[</span><span class="ot"> \Gamma [1 + (2/\gamma)] - \Gamma [1 + (1/\gamma)]^{2} \right</span><span class="co">]</span></span>
<span id="cb43-348"><a href="#cb43-348" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-349"><a href="#cb43-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-350"><a href="#cb43-350" aria-hidden="true" tabindex="-1"></a>sendo a função gama $\Gamma <span class="co">[</span><span class="ot">k</span><span class="co">]</span>$, expressa por $\Gamma <span class="co">[</span><span class="ot">k</span><span class="co">]</span> = \int_{0}^{\infty} x^{k -1} e^{- x} dx$.</span>
<span id="cb43-351"><a href="#cb43-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-352"><a href="#cb43-352" aria-hidden="true" tabindex="-1"></a>Afim de se obter o tempo mediano de sobrevivência, igualamos a probabilidade de sobrevivência a 0,5. Desta forma:</span>
<span id="cb43-353"><a href="#cb43-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-354"><a href="#cb43-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-355"><a href="#cb43-355" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-356"><a href="#cb43-356" aria-hidden="true" tabindex="-1"></a><span class="in">    S(t) &amp; = 0,5 \Leftrightarrow e^{(-\alpha t)^{\gamma}} = 1/2 \\</span></span>
<span id="cb43-357"><a href="#cb43-357" aria-hidden="true" tabindex="-1"></a><span class="in">    - (\alpha t)^{\gamma} &amp; = - \ln(2^{-1}) \Leftrightarrow \alpha t = \ln(2) \\</span></span>
<span id="cb43-358"><a href="#cb43-358" aria-hidden="true" tabindex="-1"></a><span class="in">    (\alpha t)^{\gamma} &amp; = \ln(2).</span></span>
<span id="cb43-359"><a href="#cb43-359" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-360"><a href="#cb43-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-361"><a href="#cb43-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-362"><a href="#cb43-362" aria-hidden="true" tabindex="-1"></a>Logo,</span>
<span id="cb43-363"><a href="#cb43-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-364"><a href="#cb43-364" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-365"><a href="#cb43-365" aria-hidden="true" tabindex="-1"></a>T_{mediano} = \dfrac{\ln(2)^{1/\gamma}}{\alpha}.</span>
<span id="cb43-366"><a href="#cb43-366" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-367"><a href="#cb43-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-368"><a href="#cb43-368" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Distribuição do valor extremo ou de Gambel</span></span>
<span id="cb43-369"><a href="#cb43-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-370"><a href="#cb43-370" aria-hidden="true" tabindex="-1"></a>Um ponto que deve ser chamada atenção é a relação da distribuição Weibull com outra distribuição. Esta outra distribuição é chamada de *distribuição do valor extremo* ou de *Gambel*. Tal distribuição surge ao se tomar o logaritmo de uma variável $T$ com distribuição de Weibull com $f(t)$ dada por @eq-densitWei, desta forma, $Y = \ln(T)$ tem distribuição do valor extremo com densidade da forma:</span>
<span id="cb43-371"><a href="#cb43-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-372"><a href="#cb43-372" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distribuição lognormal</span></span>
<span id="cb43-373"><a href="#cb43-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-374"><a href="#cb43-374" aria-hidden="true" tabindex="-1"></a>Uma outra possibilidade para modelar o tempo de sobrevivência é a *distribuição Log-normal*. Dizer que $T \sim Normal(\mu, \sigma^{2})$ implica em dizer que $\ln(T) \sim log-Normal(\mu, \sigma^{2})$ em que $\mu$ é a média do logaritmo do tempo de falha e $\sigma^{2}$ sua variância. Pode-se fazer uso desta relação para modelar o tempo de sobrevivência conforme uma distribuição normal, desde que, se aplique o logaritmo aos dados observados. A função densidade para tal distribuição é dada por:</span>
<span id="cb43-375"><a href="#cb43-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-376"><a href="#cb43-376" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-377"><a href="#cb43-377" aria-hidden="true" tabindex="-1"></a>f (t) = \dfrac{1}{t \sigma \sqrt{2 \pi}} \exp \left<span class="sc">\{</span>- \dfrac{1}{2} \left(\dfrac{\ln(t) - \mu}{\sigma}\right)^{2} \right<span class="sc">\}</span></span>
<span id="cb43-378"><a href="#cb43-378" aria-hidden="true" tabindex="-1"></a>$$ {#eq-densitLognormal}</span>
<span id="cb43-379"><a href="#cb43-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-380"><a href="#cb43-380" aria-hidden="true" tabindex="-1"></a>Assim, quando o tempo de sobrevivência segue uma distribuição log-normal, sua função de sobrevivência e as demais não tem uma forma análitica explícita, desde modo, deve-se fazer uso das relações entre as funções para se obter a função taxa de falha e taxa de falha acumulada. Desta forma, essas funções são expressas, respectivamente, por:</span>
<span id="cb43-381"><a href="#cb43-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-382"><a href="#cb43-382" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-383"><a href="#cb43-383" aria-hidden="true" tabindex="-1"></a>S (t) = \Phi \left( \dfrac{- \ln(t) + \mu}{\sigma} \right)</span>
<span id="cb43-384"><a href="#cb43-384" aria-hidden="true" tabindex="-1"></a>$$ {#eq-StLognormal}</span>
<span id="cb43-385"><a href="#cb43-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-386"><a href="#cb43-386" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-387"><a href="#cb43-387" aria-hidden="true" tabindex="-1"></a>\lambda (t) = \dfrac{f (t)}{S (t)} \ \text{ e } \ \Lambda (t) = - \ln S(t)</span>
<span id="cb43-388"><a href="#cb43-388" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-389"><a href="#cb43-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-390"><a href="#cb43-390" aria-hidden="true" tabindex="-1"></a>em que $\Phi (\cdot)$ é a função de distribuição acumulada da normal padrão.</span>
<span id="cb43-391"><a href="#cb43-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-392"><a href="#cb43-392" aria-hidden="true" tabindex="-1"></a>Afim de ilustrar para visualização e melhor aprendizado do autor e de quem for ler tal material foram simuladas as funções de sobrevivência, risco e risco acumulado variando o parâmetro $\mu$.</span>
<span id="cb43-393"><a href="#cb43-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-394"><a href="#cb43-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, message=FALSE}</span></span>
<span id="cb43-395"><a href="#cb43-395" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb43-396"><a href="#cb43-396" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb43-397"><a href="#cb43-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-398"><a href="#cb43-398" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb43-399"><a href="#cb43-399" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 1000</span></span>
<span id="cb43-400"><a href="#cb43-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-401"><a href="#cb43-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-404"><a href="#cb43-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-405"><a href="#cb43-405" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb43-406"><a href="#cb43-406" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] DISTRIBUIÇÃO LOG-NORMAL</span></span>
<span id="cb43-407"><a href="#cb43-407" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb43-408"><a href="#cb43-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-409"><a href="#cb43-409" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-410"><a href="#cb43-410" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.1] FUNÇÕES</span></span>
<span id="cb43-411"><a href="#cb43-411" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-412"><a href="#cb43-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-413"><a href="#cb43-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Função densidade (f)</span></span>
<span id="cb43-414"><a href="#cb43-414" aria-hidden="true" tabindex="-1"></a>ftLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb43-415"><a href="#cb43-415" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">/</span> (t <span class="sc">*</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi))) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> ((<span class="fu">log</span>(t) <span class="sc">-</span> mu) <span class="sc">/</span> sigma)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb43-416"><a href="#cb43-416" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-417"><a href="#cb43-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-418"><a href="#cb43-418" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência (S)</span></span>
<span id="cb43-419"><a href="#cb43-419" aria-hidden="true" tabindex="-1"></a>StLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb43-420"><a href="#cb43-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pnorm</span>(<span class="sc">-</span>(<span class="fu">log</span>(t) <span class="sc">-</span> mu) <span class="sc">/</span> sigma, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-421"><a href="#cb43-421" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-422"><a href="#cb43-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-423"><a href="#cb43-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco (h)</span></span>
<span id="cb43-424"><a href="#cb43-424" aria-hidden="true" tabindex="-1"></a>htLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb43-425"><a href="#cb43-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ftLogNormal</span>(t, mu, sigma) <span class="sc">/</span> <span class="fu">StLogNormal</span>(t, mu, sigma)</span>
<span id="cb43-426"><a href="#cb43-426" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-427"><a href="#cb43-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-428"><a href="#cb43-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Risco Acumulado (Lambda)</span></span>
<span id="cb43-429"><a href="#cb43-429" aria-hidden="true" tabindex="-1"></a>LtLogNormal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, mu, sigma) {</span>
<span id="cb43-430"><a href="#cb43-430" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">log</span>(<span class="fu">StLogNormal</span>(t, mu, sigma))</span>
<span id="cb43-431"><a href="#cb43-431" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-432"><a href="#cb43-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-433"><a href="#cb43-433" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-434"><a href="#cb43-434" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb43-435"><a href="#cb43-435" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-436"><a href="#cb43-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-437"><a href="#cb43-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulando dados da distribuição log-normal</span></span>
<span id="cb43-438"><a href="#cb43-438" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="dv">0</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)</span>
<span id="cb43-439"><a href="#cb43-439" aria-hidden="true" tabindex="-1"></a>mus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>) <span class="co"># Valores de mu</span></span>
<span id="cb43-440"><a href="#cb43-440" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span>         <span class="co"># Valor fixo de sigma</span></span>
<span id="cb43-441"><a href="#cb43-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-442"><a href="#cb43-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb43-443"><a href="#cb43-443" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(mus, <span class="cf">function</span>(mu) {</span>
<span id="cb43-444"><a href="#cb43-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb43-445"><a href="#cb43-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempo =</span> tempo,</span>
<span id="cb43-446"><a href="#cb43-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">ft =</span> <span class="fu">ftLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb43-447"><a href="#cb43-447" aria-hidden="true" tabindex="-1"></a>    <span class="at">St =</span> <span class="fu">StLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb43-448"><a href="#cb43-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">htLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb43-449"><a href="#cb43-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lt =</span> <span class="fu">LtLogNormal</span>(tempo, mu, sigma),</span>
<span id="cb43-450"><a href="#cb43-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> <span class="fu">factor</span>(mu)</span>
<span id="cb43-451"><a href="#cb43-451" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-452"><a href="#cb43-452" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb43-453"><a href="#cb43-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-454"><a href="#cb43-454" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-455"><a href="#cb43-455" aria-hidden="true" tabindex="-1"></a><span class="co"># [4.3] GRÁFICOS</span></span>
<span id="cb43-456"><a href="#cb43-456" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-457"><a href="#cb43-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-458"><a href="#cb43-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Função genérica para gráficos</span></span>
<span id="cb43-459"><a href="#cb43-459" aria-hidden="true" tabindex="-1"></a>plot_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var, y_label, color_values, y_expression) {</span>
<span id="cb43-460"><a href="#cb43-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> tempo, <span class="at">y =</span> <span class="sc">!!</span><span class="fu">sym</span>(y_var), <span class="at">color =</span> mu)) <span class="sc">+</span></span>
<span id="cb43-461"><a href="#cb43-461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> mean, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-462"><a href="#cb43-462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> y_expression, <span class="at">color =</span> <span class="fu">expression</span>(mu)) <span class="sc">+</span></span>
<span id="cb43-463"><a href="#cb43-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values,</span>
<span id="cb43-464"><a href="#cb43-464" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">lapply</span>(mus, <span class="cf">function</span>(m) <span class="fu">bquote</span>(mu <span class="sc">==</span> .(m)))) <span class="sc">+</span></span>
<span id="cb43-465"><a href="#cb43-465" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb43-466"><a href="#cb43-466" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-467"><a href="#cb43-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-468"><a href="#cb43-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleta de cores</span></span>
<span id="cb43-469"><a href="#cb43-469" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>)</span>
<span id="cb43-470"><a href="#cb43-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-471"><a href="#cb43-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-472"><a href="#cb43-472" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-SobrLognormal. Tal Figura mostra as curvas de sobrevivência para diferentes valores do parâmetro $\mu$.</span>
<span id="cb43-473"><a href="#cb43-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-474"><a href="#cb43-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-475"><a href="#cb43-475" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Sobrevivência para diferentes valores de μ"</span></span>
<span id="cb43-476"><a href="#cb43-476" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-SobrLognormal</span></span>
<span id="cb43-477"><a href="#cb43-477" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-478"><a href="#cb43-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-479"><a href="#cb43-479" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Sobrevivência</span></span>
<span id="cb43-480"><a href="#cb43-480" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "St", expression(S(t)), color_values, expression(S(t)))</span></span>
<span id="cb43-481"><a href="#cb43-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-482"><a href="#cb43-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-483"><a href="#cb43-483" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscLognormal. Tal Figura mostra a função de risco para diferentes valores do parâmetro $\mu$.</span>
<span id="cb43-484"><a href="#cb43-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-485"><a href="#cb43-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-486"><a href="#cb43-486" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco para diferentes valores de μ"</span></span>
<span id="cb43-487"><a href="#cb43-487" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscLognormal</span></span>
<span id="cb43-488"><a href="#cb43-488" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-489"><a href="#cb43-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-490"><a href="#cb43-490" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco</span></span>
<span id="cb43-491"><a href="#cb43-491" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "ht", expression(lambda(t)), color_values, expression(lambda(t)))</span></span>
<span id="cb43-492"><a href="#cb43-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-493"><a href="#cb43-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-494"><a href="#cb43-494" aria-hidden="true" tabindex="-1"></a>Veja a seguir a @fig-RiscAcumLognormal. Tal Figura mostra a função de risco acumulado para diferentes valores do parâmetro $\mu$.</span>
<span id="cb43-495"><a href="#cb43-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-496"><a href="#cb43-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-497"><a href="#cb43-497" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Função de Risco Acumulado para diferentes valores de μ"</span></span>
<span id="cb43-498"><a href="#cb43-498" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-RiscAcumLognormal</span></span>
<span id="cb43-499"><a href="#cb43-499" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-500"><a href="#cb43-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-501"><a href="#cb43-501" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Risco Acumulado</span></span>
<span id="cb43-502"><a href="#cb43-502" aria-hidden="true" tabindex="-1"></a><span class="in">plot_func(dados, "Lt", expression(Lambda(t)), color_values, expression(Lambda(t)))</span></span>
<span id="cb43-503"><a href="#cb43-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-504"><a href="#cb43-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-505"><a href="#cb43-505" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Algumas Considerações</span></span>
<span id="cb43-506"><a href="#cb43-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-507"><a href="#cb43-507" aria-hidden="true" tabindex="-1"></a>A média de $T$ é dada por:</span>
<span id="cb43-508"><a href="#cb43-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-509"><a href="#cb43-509" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-510"><a href="#cb43-510" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \exp <span class="sc">\{</span> \mu + \frac{\sigma^2}{2} <span class="sc">\}</span>,</span>
<span id="cb43-511"><a href="#cb43-511" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-512"><a href="#cb43-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-513"><a href="#cb43-513" aria-hidden="true" tabindex="-1"></a>e a variância de $T$ definida como:</span>
<span id="cb43-514"><a href="#cb43-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-515"><a href="#cb43-515" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-516"><a href="#cb43-516" aria-hidden="true" tabindex="-1"></a>Var<span class="co">[</span><span class="ot">T</span><span class="co">]</span> = \exp <span class="sc">\{</span> 2 \mu + \sigma^2 <span class="sc">\}</span> (\exp <span class="sc">\{</span> \sigma^{2} <span class="sc">\}</span> - 1).</span>
<span id="cb43-517"><a href="#cb43-517" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-518"><a href="#cb43-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-519"><a href="#cb43-519" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimação</span></span>
<span id="cb43-520"><a href="#cb43-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-521"><a href="#cb43-521" aria-hidden="true" tabindex="-1"></a>Foi mostrado alguns modelos probabilísticos. Porém, tais modelos apresentam quantidades desconhecidas denominadas de parâmetros ou parâmetro quando o modelo de probabilidade depende apenas de uma quantidade desconhecida, por exemplo, a distribuição exponencial.</span>
<span id="cb43-522"><a href="#cb43-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-523"><a href="#cb43-523" aria-hidden="true" tabindex="-1"></a><span class="fu">### Método de Máxima Verossimilhança</span></span>
<span id="cb43-524"><a href="#cb43-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-525"><a href="#cb43-525" aria-hidden="true" tabindex="-1"></a>O *Método de Máxima Verossimilhança* se baseia na ideia de que, a partir de uma amostra aleatória, a estimativa para o parâmetro de interesse maximiza a probabilidade de tal amostra aleatória ser obtida.</span>
<span id="cb43-526"><a href="#cb43-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-527"><a href="#cb43-527" aria-hidden="true" tabindex="-1"></a>Em termos simples, o método de máxima verossimilhança condensa toda informação contida, através da função de verossimilhança, na amostra. Afim de encontrar o(s) parâmetro(s) da distribuição que melhor expliquem essa amostra é realizado o produtório da densidade ($f (t)$) para cada observação amostral $t_{i}$, $i = 1, 2, \cdots, n$. Em livros de estatística básica, a seguinte definição da função verossimilhança é adotada, para um parâmetro (ou conjunto de parâmetros) $\theta$ qualquer:</span>
<span id="cb43-528"><a href="#cb43-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-529"><a href="#cb43-529" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-530"><a href="#cb43-530" aria-hidden="true" tabindex="-1"></a>L (\theta) = \prod_{i = 1}^{n} f (t_{i}, \theta).</span>
<span id="cb43-531"><a href="#cb43-531" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-532"><a href="#cb43-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-533"><a href="#cb43-533" aria-hidden="true" tabindex="-1"></a>Perceba que $L$ é função de $\theta$, sendo este um único parâmetro ou um conjunto de parâmetros, como na distribuição log-normal, onde $\theta = (\mu, \sigma^{2})$. Entretanto, nota-se que para qualquer observação não censurada, sua contribuição para $L (\theta)$ é a sua densidade, o que na análise de sobrevivência não é o suficiente, já que os dados apresentam censura, implicando no tempo de falha ser na verdade superior ao tempo de censura observado.</span>
<span id="cb43-534"><a href="#cb43-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-535"><a href="#cb43-535" aria-hidden="true" tabindex="-1"></a>Desta forma, faz-se uso da variável indicadora $\delta_{i}$, apresentada na @sec-ReprDados, que nos diz se o $i$-ésimo tempo é tempo de falha ou de censura. Logo, são feitos alguns ajustes na função de verossimilhança. Tais ajustes fazem com que para $\delta_{i} = 1$, o $i$-ésimo tempo é tempo de falha e a contribução para $L$ é a própria função densidade de probabilidade, em contraste a isso, se $\delta_{i} = 0$, o $i$-ésimo tempo é tempo de censura e a contribuição dessa observação é a função de sobrevivência. Assim, a função de verossimilhança para um parâmetro ou um conjunto de parâmetros $\theta$ pode ser escrita como:</span>
<span id="cb43-536"><a href="#cb43-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-537"><a href="#cb43-537" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-538"><a href="#cb43-538" aria-hidden="true" tabindex="-1"></a>L (\theta) = \prod_{i = 1}^{n} \ <span class="co">[</span><span class="ot">f (t_{i}, \theta)</span><span class="co">]</span>^{\delta_{i}} \ <span class="co">[</span><span class="ot">S(t_{i})</span><span class="co">]</span>^{1 - \delta_{i}}</span>
<span id="cb43-539"><a href="#cb43-539" aria-hidden="true" tabindex="-1"></a>$$ {#eq-verossilGeneric}</span>
<span id="cb43-540"><a href="#cb43-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-541"><a href="#cb43-541" aria-hidden="true" tabindex="-1"></a>A partir da deriva do log da verossimilhança igualada a zero, $$\dfrac{\partial \ln L (\theta)}{\partial \theta} = 0,$$ é possível encontrar um valor para $\theta$ que maximize $\ln L (\theta)$, portanto, maximize $L (\theta)$.</span>
<span id="cb43-542"><a href="#cb43-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-543"><a href="#cb43-543" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Aplicações</span></span>
<span id="cb43-544"><a href="#cb43-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-545"><a href="#cb43-545" aria-hidden="true" tabindex="-1"></a>Será mostrado nessa seção como encontrar o estimador ou estimadores de máxima verossimilhança para os parâmetros das disitribuições citadas.</span>
<span id="cb43-546"><a href="#cb43-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-547"><a href="#cb43-547" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Distribuição Exponecial</span></span>
<span id="cb43-548"><a href="#cb43-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-549"><a href="#cb43-549" aria-hidden="true" tabindex="-1"></a>Para uma distribuição exponencial conforme descrita na @sec-DistExp. O *Estimador de Máxima Verossimilhança* do parâmetro $\alpha$ pode ser obtido de acordo com os seguintes passos:</span>
<span id="cb43-550"><a href="#cb43-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-551"><a href="#cb43-551" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Determinar a função verossimilhança $L (\alpha)$:</span>
<span id="cb43-552"><a href="#cb43-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-553"><a href="#cb43-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-554"><a href="#cb43-554" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-555"><a href="#cb43-555" aria-hidden="true" tabindex="-1"></a><span class="in">    L (\alpha) &amp; = \prod_{i = 1}^{n} [\alpha \exp \{-\alpha t_{i}\}]^{\delta_{i}} [\exp \{-\alpha t_{i}\}]^{1 - \delta_{i}} \\</span></span>
<span id="cb43-556"><a href="#cb43-556" aria-hidden="true" tabindex="-1"></a><span class="in">               &amp; = \prod_{i = 1}^{n} \alpha^{\delta_{i}} \exp \{ - \alpha t_{i} \}.</span></span>
<span id="cb43-557"><a href="#cb43-557" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-558"><a href="#cb43-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-559"><a href="#cb43-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-560"><a href="#cb43-560" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Tomar o logaritmo da função verossimilhança $\ln L (\alpha)$:</span>
<span id="cb43-561"><a href="#cb43-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-562"><a href="#cb43-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-563"><a href="#cb43-563" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-564"><a href="#cb43-564" aria-hidden="true" tabindex="-1"></a><span class="in">    \ln L (\alpha) &amp; = \sum_{i = 1}^{n} \ln \left[ \alpha^{\delta_{i}} \exp \{ - \alpha t_{i} \} \right] = \sum_{i = 1}^{n} \ln \left[ \alpha^{\delta_{i}} \right] + \sum_{i = 1}^{n} \ln \left[ \exp \{ - \alpha t_{i} \} \right] \\</span></span>
<span id="cb43-565"><a href="#cb43-565" aria-hidden="true" tabindex="-1"></a><span class="in">                   &amp; = \sum_{i = 1}^{n} \delta_{i} \ln \alpha + \sum_{i = 1}^{n} - \alpha t_{i} =  \ln \alpha \sum_{i = 1}^{n} \delta_{i} - \alpha \sum_{i = 1}^{n} t_{i}. \\</span></span>
<span id="cb43-566"><a href="#cb43-566" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-567"><a href="#cb43-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-568"><a href="#cb43-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-569"><a href="#cb43-569" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Derivar a função do log da verossimilhança $\dfrac{\partial \ln L (\theta)}{\partial \theta} = 0$:</span>
<span id="cb43-570"><a href="#cb43-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-571"><a href="#cb43-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-572"><a href="#cb43-572" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-573"><a href="#cb43-573" aria-hidden="true" tabindex="-1"></a><span class="in">    \dfrac{\partial \ln L (\theta)}{\partial \theta}  &amp; = \dfrac{1}{\alpha} \sum_{i = 1}^{n} \delta_{i} - \sum_{i = 1}^{n} t_{i}.</span></span>
<span id="cb43-574"><a href="#cb43-574" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-575"><a href="#cb43-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-576"><a href="#cb43-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-577"><a href="#cb43-577" aria-hidden="true" tabindex="-1"></a>Ao igualar a derivada a zero e isolando $\alpha$ em um dos lados da igualdade e assuminado que a forma análitica de $\alpha$ obtida é um estimador de máxima verossimilhança temos:</span>
<span id="cb43-578"><a href="#cb43-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-579"><a href="#cb43-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-580"><a href="#cb43-580" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-581"><a href="#cb43-581" aria-hidden="true" tabindex="-1"></a><span class="in">    \dfrac{\partial \ln L (\theta)}{\partial \theta}  &amp; = 0 \\</span></span>
<span id="cb43-582"><a href="#cb43-582" aria-hidden="true" tabindex="-1"></a><span class="in">    \dfrac{1}{\hat{\alpha}} \sum_{i = 1}^{n} \delta_{i} - \sum_{i = 1}^{n} t_{i} &amp; = 0 \\</span></span>
<span id="cb43-583"><a href="#cb43-583" aria-hidden="true" tabindex="-1"></a><span class="in">    \hat{\alpha} &amp; = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\sum_{i = 1}^{n} t_{i}}</span></span>
<span id="cb43-584"><a href="#cb43-584" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-585"><a href="#cb43-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-586"><a href="#cb43-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-587"><a href="#cb43-587" aria-hidden="true" tabindex="-1"></a>Note que, para o caso em que não se tem censura o numerador, $\sum_{i = 1}^{n} \delta_{i}$, equivale ao tamanho da amostra $n$.</span>
<span id="cb43-588"><a href="#cb43-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-589"><a href="#cb43-589" aria-hidden="true" tabindex="-1"></a>A seguir, temos um exemplo computacional. Simulou-se uma amostra proveniente de uma distribuição exponecial e a partir de tal amostra se obteve a estimativa de máxima verossimilhança do parâmetro $\alpha$ de tal amostra.</span>
<span id="cb43-590"><a href="#cb43-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-593"><a href="#cb43-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-594"><a href="#cb43-594" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-595"><a href="#cb43-595" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb43-596"><a href="#cb43-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-597"><a href="#cb43-597" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-598"><a href="#cb43-598" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.1] FUNÇÕES</span></span>
<span id="cb43-599"><a href="#cb43-599" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-600"><a href="#cb43-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb43-601"><a href="#cb43-601" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb43-602"><a href="#cb43-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-603"><a href="#cb43-603" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-604"><a href="#cb43-604" aria-hidden="true" tabindex="-1"></a><span class="co"># [2.2] SIMULAÇÃO E VARIAÇÃO DE PARÂMETROS</span></span>
<span id="cb43-605"><a href="#cb43-605" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------</span></span>
<span id="cb43-606"><a href="#cb43-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-607"><a href="#cb43-607" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="co"># Parâmetro de taxa (escala) populacional</span></span>
<span id="cb43-608"><a href="#cb43-608" aria-hidden="true" tabindex="-1"></a>tempo <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> alpha) <span class="co"># Simulando dados de uma exponencial</span></span>
<span id="cb43-609"><a href="#cb43-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-610"><a href="#cb43-610" aria-hidden="true" tabindex="-1"></a>emvExp <span class="ot">&lt;-</span> n <span class="sc">/</span> <span class="fu">sum</span>(tempo) <span class="co"># EMV</span></span>
<span id="cb43-611"><a href="#cb43-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-612"><a href="#cb43-612" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando um Data Frame com valores das funções</span></span>
<span id="cb43-613"><a href="#cb43-613" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-614"><a href="#cb43-614" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tempo =</span> tempo,</span>
<span id="cb43-615"><a href="#cb43-615" aria-hidden="true" tabindex="-1"></a>  <span class="at">St =</span> <span class="fu">Stexp</span>(tempo, alpha),</span>
<span id="cb43-616"><a href="#cb43-616" aria-hidden="true" tabindex="-1"></a>  <span class="at">emvSt =</span> <span class="fu">Stexp</span>(tempo, emvExp)</span>
<span id="cb43-617"><a href="#cb43-617" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-618"><a href="#cb43-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-619"><a href="#cb43-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-620"><a href="#cb43-620" aria-hidden="true" tabindex="-1"></a>O valor de verdadeiro do parâmetro $\alpha =$ <span class="in">`{r} alpha`</span>. A estimativa de máxima verossimilhança obtida foi $\hat{\alpha} =$ <span class="in">`{r} round(emvExp, 2)`</span>.</span>
<span id="cb43-621"><a href="#cb43-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-622"><a href="#cb43-622" aria-hidden="true" tabindex="-1"></a>Veja a @tbl-EMVexpSt que mostra as dez primeiras observações e suas respectivas funções de sobrevivência, sobrevivência real e sobrevivência estimada.</span>
<span id="cb43-623"><a href="#cb43-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-624"><a href="#cb43-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb43-625"><a href="#cb43-625" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Real e Estimado para as Funções de Sobrevivência"</span></span>
<span id="cb43-626"><a href="#cb43-626" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-EMVexpSt</span></span>
<span id="cb43-627"><a href="#cb43-627" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap-location: top</span></span>
<span id="cb43-628"><a href="#cb43-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-629"><a href="#cb43-629" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb43-630"><a href="#cb43-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-631"><a href="#cb43-631" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(head(dados), </span></span>
<span id="cb43-632"><a href="#cb43-632" aria-hidden="true" tabindex="-1"></a><span class="in">             col.names = c("Tempo", "S(t)", "S(t) EMV"),</span></span>
<span id="cb43-633"><a href="#cb43-633" aria-hidden="true" tabindex="-1"></a><span class="in">             escape = FALSE,</span></span>
<span id="cb43-634"><a href="#cb43-634" aria-hidden="true" tabindex="-1"></a><span class="in">             align = 'c',</span></span>
<span id="cb43-635"><a href="#cb43-635" aria-hidden="true" tabindex="-1"></a><span class="in">             booktabs = TRUE)</span></span>
<span id="cb43-636"><a href="#cb43-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-637"><a href="#cb43-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-638"><a href="#cb43-638" aria-hidden="true" tabindex="-1"></a>Temos também a comparação dessas duas curvas de sobrevivência, ilustradas na @fig-CompEMVexp.</span>
<span id="cb43-639"><a href="#cb43-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-640"><a href="#cb43-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-641"><a href="#cb43-641" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Comparação do verdadeiro valor do parâmetro α com sua estimativa de máxima verossimilhança."</span></span>
<span id="cb43-642"><a href="#cb43-642" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-CompEMVexp</span></span>
<span id="cb43-643"><a href="#cb43-643" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-644"><a href="#cb43-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-645"><a href="#cb43-645" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dados, aes(x = Tempo)) +</span></span>
<span id="cb43-646"><a href="#cb43-646" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = St, color = "alpha"), lwd = 1.5) +</span></span>
<span id="cb43-647"><a href="#cb43-647" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = emvSt, color = "emvAlpha"), lwd = 1, lty = 4) +</span></span>
<span id="cb43-648"><a href="#cb43-648" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb43-649"><a href="#cb43-649" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("alpha" = "black", "emvAlpha" = "red"),</span></span>
<span id="cb43-650"><a href="#cb43-650" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = c(expression(alpha), expression(hat(alpha)))) +</span></span>
<span id="cb43-651"><a href="#cb43-651" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb43-652"><a href="#cb43-652" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Tempo",</span></span>
<span id="cb43-653"><a href="#cb43-653" aria-hidden="true" tabindex="-1"></a><span class="in">    y = expression(S(t)), </span></span>
<span id="cb43-654"><a href="#cb43-654" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "Parâmetro") + </span></span>
<span id="cb43-655"><a href="#cb43-655" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb43-656"><a href="#cb43-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-657"><a href="#cb43-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-658"><a href="#cb43-658" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Distribuição Weibull</span></span>
<span id="cb43-659"><a href="#cb43-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-660"><a href="#cb43-660" aria-hidden="true" tabindex="-1"></a>Para uma distribuição Weibull, descrita na @sec-DistWeibull não há uma forma análitica para $\gamma$ e $\alpha$. Logo, para obter a sua estimativa de máxima verossimilhança se usa um método de aproximação numérica, será introduzido aqui o *Método Iterativo de Newton-Raphson*.</span>
<span id="cb43-661"><a href="#cb43-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-662"><a href="#cb43-662" aria-hidden="true" tabindex="-1"></a>O **Método de Newton-Raphson** é uma abordagem iterativa eficiente para resolver equações não lineares, sendo amplamente utilizado na estimação de parâmetros de distribuições estatísticas. Quando aplicado ao ajuste de distribuições, como a **Weibull** no contexto de análise de sobrevivência, o método busca maximizar a função de verossimilhança, resolvendo o sistema de equações derivado das condições de otimalidade (gradiente nulo).</span>
<span id="cb43-663"><a href="#cb43-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-664"><a href="#cb43-664" aria-hidden="true" tabindex="-1"></a>A fórmula iterativa é:</span>
<span id="cb43-665"><a href="#cb43-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-666"><a href="#cb43-666" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-667"><a href="#cb43-667" aria-hidden="true" tabindex="-1"></a>\theta_{n+1} = \theta_n - \mathbf{H}^{-1}(\theta_n) \nabla L(\theta_n),</span>
<span id="cb43-668"><a href="#cb43-668" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-669"><a href="#cb43-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-670"><a href="#cb43-670" aria-hidden="true" tabindex="-1"></a>onde:</span>
<span id="cb43-671"><a href="#cb43-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-672"><a href="#cb43-672" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\theta_{n}$ é o vetor de parâmetros estimados na iteração $n$;</span>
<span id="cb43-673"><a href="#cb43-673" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$L(\theta)$ é a função log-verossimilhança;</span>
<span id="cb43-674"><a href="#cb43-674" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\nabla L(\theta)$ é o vetor gradiente (derivadas parciais de $L(\theta)$);</span>
<span id="cb43-675"><a href="#cb43-675" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mathbf{H}(\theta)$ é a matriz Hessiana (segunda derivada de $L(\theta)$).</span>
<span id="cb43-676"><a href="#cb43-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-677"><a href="#cb43-677" aria-hidden="true" tabindex="-1"></a>**Vantagens no ajuste de distribuições:**</span>
<span id="cb43-678"><a href="#cb43-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-679"><a href="#cb43-679" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Eficiência**: O método converge rapidamente quando o ponto inicial $\theta_{0}$ está próximo dos valores reais dos parâmetros.</span>
<span id="cb43-680"><a href="#cb43-680" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Flexibilidade**: Adequa-se a diferentes modelos, como a distribuição Weibull, usada para modelar tempos de vida ou sobrevivência.</span>
<span id="cb43-681"><a href="#cb43-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-682"><a href="#cb43-682" aria-hidden="true" tabindex="-1"></a>**Cuidados na aplicação:**</span>
<span id="cb43-683"><a href="#cb43-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-684"><a href="#cb43-684" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Convergência**: Garantida apenas se o ponto inicial estiver próximo da solução e as condições de regularidade forem atendidas.</span>
<span id="cb43-685"><a href="#cb43-685" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Cálculo da Hessiana**: Pode ser computacionalmente intensivo para distribuições complexas.</span>
<span id="cb43-686"><a href="#cb43-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-687"><a href="#cb43-687" aria-hidden="true" tabindex="-1"></a>No caso da distribuição Weibull, a aplicação do método Newton-Raphson envolve derivadas em relação aos parâmetros de forma ($\gamma$) e escala ($\alpha$), permitindo ajustar o modelo aos dados observados de tempos de sobrevivência de forma precisa e eficiente.</span>
<span id="cb43-688"><a href="#cb43-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-689"><a href="#cb43-689" aria-hidden="true" tabindex="-1"></a>Para utilizar o Método Iterativo de Newton-Raphson, pode-se escrever o algoritmo passo a passo. Outra forma, é usar a função do R <span class="in">`optim`</span>. Será aprensatado as duas formas e seus detalhes serão comentados.</span>
<span id="cb43-690"><a href="#cb43-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-691"><a href="#cb43-691" aria-hidden="true" tabindex="-1"></a>Começando pela construção do algoritmo passo a passo, precisamos definir algumas funções. A primeira é a função de verossimilhança da distribuição Weibull, que pode ser obtida a partir da @eq-verossilGeneric ao substituir respectivamente a função densidade e sobrevivência da distribuição Weibull respectivamente. Assim:</span>
<span id="cb43-692"><a href="#cb43-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-693"><a href="#cb43-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-694"><a href="#cb43-694" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-695"><a href="#cb43-695" aria-hidden="true" tabindex="-1"></a><span class="in">    L (\gamma, \alpha) &amp; = \prod_{i = 1}^{n} \left[ \gamma \alpha^{\gamma} t_{i}^{\gamma - 1} \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\} \right]^{\delta_{i}} \left[ \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\} \right]^{1 - \delta_{i}} \\</span></span>
<span id="cb43-696"><a href="#cb43-696" aria-hidden="true" tabindex="-1"></a><span class="in">    &amp; = \prod_{i = 1}^{n} \left[ \dfrac{\gamma}{\alpha^{\gamma}} t^{\gamma - 1} \right]^{\delta_{i}}  \exp \left\{ - \left(\dfrac{t_{i}}{\alpha}\right)^{\gamma} \right\}</span></span>
<span id="cb43-697"><a href="#cb43-697" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-698"><a href="#cb43-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-699"><a href="#cb43-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-700"><a href="#cb43-700" aria-hidden="true" tabindex="-1"></a>Toma-se o logaritmo de $L (\gamma, \alpha)$, logo:</span>
<span id="cb43-701"><a href="#cb43-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-702"><a href="#cb43-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb43-703"><a href="#cb43-703" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb43-704"><a href="#cb43-704" aria-hidden="true" tabindex="-1"></a><span class="in">    \ln L (\gamma, \alpha) &amp; = \sum_{i = 1}^{n} \delta_{i} \ln\{ \gamma \} - \sum_{i = 1}^{n} \delta_{i} \gamma \ln\{ \alpha \} + \sum_{i = 1}^{n} \delta_{i} (\gamma - 1) \ln \{ t_{i} \} + \sum_{i = 1}^{n} - (\alpha^{-1} t_{i})^{\gamma} \\</span></span>
<span id="cb43-705"><a href="#cb43-705" aria-hidden="true" tabindex="-1"></a><span class="in">    &amp; = \ln\{ \gamma \} \sum_{i = 1}^{n} \delta_{i} - \gamma \ln\{ \alpha \} \sum_{i = 1}^{n} \delta_{i} + (\gamma - 1) \sum_{i = 1}^{n} \delta_{i} \ln \{ t_{i} \} + \sum_{i = 1}^{n} - (\alpha^{-1} t_{i})^{\gamma}</span></span>
<span id="cb43-706"><a href="#cb43-706" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb43-707"><a href="#cb43-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-708"><a href="#cb43-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-709"><a href="#cb43-709" aria-hidden="true" tabindex="-1"></a>Agora, aplica-se as derivadas de primeira ordem em relação a $\gamma$ e $\alpha$.</span>
<span id="cb43-710"><a href="#cb43-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-711"><a href="#cb43-711" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-712"><a href="#cb43-712" aria-hidden="true" tabindex="-1"></a>\dfrac{\partial \ln L (\gamma, \alpha)}{\partial \gamma} = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\gamma} - \ln<span class="sc">\{</span>\alpha<span class="sc">\}</span> \sum_{i = 1}^{n} \delta_{i} + \sum_{i = 1}^{n} \delta_{i} \ln<span class="sc">\{</span>t_{i}<span class="sc">\}</span> - \sum_{i = 1}^{n} (\alpha^{-1} t_{i})^{\gamma} \ln<span class="sc">\{</span> (\alpha^{-1} t_{i})^{\gamma} <span class="sc">\}</span></span>
<span id="cb43-713"><a href="#cb43-713" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-714"><a href="#cb43-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-715"><a href="#cb43-715" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-716"><a href="#cb43-716" aria-hidden="true" tabindex="-1"></a>\dfrac{\partial \ln L (\gamma, \alpha)}{\partial \alpha} = - \dfrac{\gamma \sum_{i = 1}^{n} \delta_{i}}{\alpha} + \gamma \alpha^{- \gamma - 1}\sum_{i = 1}^{n} t_{i}^{\gamma}</span>
<span id="cb43-717"><a href="#cb43-717" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-718"><a href="#cb43-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-719"><a href="#cb43-719" aria-hidden="true" tabindex="-1"></a>Toma-se agora as derivadas de segunda ordem.</span>
<span id="cb43-720"><a href="#cb43-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-721"><a href="#cb43-721" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-722"><a href="#cb43-722" aria-hidden="true" tabindex="-1"></a>\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \gamma^{2}} = \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\gamma^{2}} - \sum_{i = 1}^{n} (\alpha^{-1} t_{i})^{\gamma} <span class="co">[</span><span class="ot"> \ln\{ (\alpha^{-1} t_{i})^{\gamma} \} </span><span class="co">]</span>^2</span>
<span id="cb43-723"><a href="#cb43-723" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-724"><a href="#cb43-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-725"><a href="#cb43-725" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-726"><a href="#cb43-726" aria-hidden="true" tabindex="-1"></a>\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \alpha^{2}} = \dfrac{\gamma \sum_{i = 1}^{n} \delta_{i}}{\alpha^{2}} - \gamma (\gamma + 1) \alpha^{- \gamma - 2} \sum_{i = 1}^{n} t_{i}^{\gamma}</span>
<span id="cb43-727"><a href="#cb43-727" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-728"><a href="#cb43-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-729"><a href="#cb43-729" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-730"><a href="#cb43-730" aria-hidden="true" tabindex="-1"></a>\dfrac{\partial^{2} \ln L (\gamma, \alpha)}{\partial \gamma \partial \alpha} = - \dfrac{\sum_{i = 1}^{n} \delta_{i}}{\alpha} + \sum_{i = 1}^{n} \dfrac{t_{i}^{\gamma}}{\alpha^{\gamma + 1}} \left( \gamma \ln \left<span class="sc">\{</span> \dfrac{t_{i}}{\alpha} \right<span class="sc">\}</span> + 1 \right)</span>
<span id="cb43-731"><a href="#cb43-731" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb43-732"><a href="#cb43-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-733"><a href="#cb43-733" aria-hidden="true" tabindex="-1"></a>Com todas as derivadas definidas, é possível definirmos algumas funções e variáveis que iremos precisar para utilizar o algoritmo de Newton-Raphson.</span>
<span id="cb43-734"><a href="#cb43-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-737"><a href="#cb43-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-738"><a href="#cb43-738" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Era para ser um bloco de código. Porém, tal código está em manutenção"</span>)</span>
<span id="cb43-739"><a href="#cb43-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-740"><a href="#cb43-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-741"><a href="#cb43-741" aria-hidden="true" tabindex="-1"></a>O bloco de código abaixo contém o algoritmo de Newton-Raphson.</span>
<span id="cb43-742"><a href="#cb43-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-745"><a href="#cb43-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-746"><a href="#cb43-746" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Era para ser um bloco de código. Porém, tal código está em manutenção"</span>)</span>
<span id="cb43-747"><a href="#cb43-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-748"><a href="#cb43-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-749"><a href="#cb43-749" aria-hidden="true" tabindex="-1"></a>O bloco abaixo mostra o uso da função <span class="in">`optim`</span> para otimização.</span>
<span id="cb43-750"><a href="#cb43-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-751"><a href="#cb43-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, message=FALSE}</span></span>
<span id="cb43-752"><a href="#cb43-752" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------</span></span>
<span id="cb43-753"><a href="#cb43-753" aria-hidden="true" tabindex="-1"></a><span class="in"># Otimização</span></span>
<span id="cb43-754"><a href="#cb43-754" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------</span></span>
<span id="cb43-755"><a href="#cb43-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-756"><a href="#cb43-756" aria-hidden="true" tabindex="-1"></a><span class="in"># Semente</span></span>
<span id="cb43-757"><a href="#cb43-757" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb43-758"><a href="#cb43-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-759"><a href="#cb43-759" aria-hidden="true" tabindex="-1"></a><span class="in"># ---------------------------------</span></span>
<span id="cb43-760"><a href="#cb43-760" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulação e Visualização do Dados</span></span>
<span id="cb43-761"><a href="#cb43-761" aria-hidden="true" tabindex="-1"></a><span class="in"># ---------------------------------</span></span>
<span id="cb43-762"><a href="#cb43-762" aria-hidden="true" tabindex="-1"></a><span class="in"># Tamanho da amostra</span></span>
<span id="cb43-763"><a href="#cb43-763" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 1000</span></span>
<span id="cb43-764"><a href="#cb43-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-765"><a href="#cb43-765" aria-hidden="true" tabindex="-1"></a><span class="in"># Parâmetros da distribuição</span></span>
<span id="cb43-766"><a href="#cb43-766" aria-hidden="true" tabindex="-1"></a><span class="in">wShape &lt;- 2</span></span>
<span id="cb43-767"><a href="#cb43-767" aria-hidden="true" tabindex="-1"></a><span class="in">wScale &lt;- 1.5</span></span>
<span id="cb43-768"><a href="#cb43-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-769"><a href="#cb43-769" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulação</span></span>
<span id="cb43-770"><a href="#cb43-770" aria-hidden="true" tabindex="-1"></a><span class="in">dadosWeibull &lt;- rweibull(n, shape = wShape, scale = wScale)</span></span>
<span id="cb43-771"><a href="#cb43-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-772"><a href="#cb43-772" aria-hidden="true" tabindex="-1"></a><span class="in"># --------------------------</span></span>
<span id="cb43-773"><a href="#cb43-773" aria-hidden="true" tabindex="-1"></a><span class="in"># Função Log-verossimilhança</span></span>
<span id="cb43-774"><a href="#cb43-774" aria-hidden="true" tabindex="-1"></a><span class="in"># --------------------------</span></span>
<span id="cb43-775"><a href="#cb43-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-776"><a href="#cb43-776" aria-hidden="true" tabindex="-1"></a><span class="in">logWeibull &lt;- function(theta, dados){</span></span>
<span id="cb43-777"><a href="#cb43-777" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- theta[1] # Parâmetro de forma</span></span>
<span id="cb43-778"><a href="#cb43-778" aria-hidden="true" tabindex="-1"></a><span class="in">  alpha &lt;- theta[2] # Parâmetro de escala</span></span>
<span id="cb43-779"><a href="#cb43-779" aria-hidden="true" tabindex="-1"></a><span class="in">  n &lt;- length(dados)</span></span>
<span id="cb43-780"><a href="#cb43-780" aria-hidden="true" tabindex="-1"></a><span class="in">  t &lt;- dados</span></span>
<span id="cb43-781"><a href="#cb43-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-782"><a href="#cb43-782" aria-hidden="true" tabindex="-1"></a><span class="in">logverossimil &lt;- (n * log(gamma)) - (gamma * log(alpha) * n) + (gamma - 1) * sum(log(t)) - sum((t/alpha)^gamma)</span></span>
<span id="cb43-783"><a href="#cb43-783" aria-hidden="true" tabindex="-1"></a><span class="in">return(-logverossimil)</span></span>
<span id="cb43-784"><a href="#cb43-784" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-785"><a href="#cb43-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-786"><a href="#cb43-786" aria-hidden="true" tabindex="-1"></a><span class="in"># ------------------------</span></span>
<span id="cb43-787"><a href="#cb43-787" aria-hidden="true" tabindex="-1"></a><span class="in"># Aplicando a função optim</span></span>
<span id="cb43-788"><a href="#cb43-788" aria-hidden="true" tabindex="-1"></a><span class="in"># ------------------------</span></span>
<span id="cb43-789"><a href="#cb43-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-790"><a href="#cb43-790" aria-hidden="true" tabindex="-1"></a><span class="in">theta0 &lt;- c(1.5, 1) # Chute inicial</span></span>
<span id="cb43-791"><a href="#cb43-791" aria-hidden="true" tabindex="-1"></a><span class="in">estimate &lt;- optim(par = theta0, fn = logWeibull, gr = NULL , method = "BFGS" ,</span></span>
<span id="cb43-792"><a href="#cb43-792" aria-hidden="true" tabindex="-1"></a><span class="in">             hessian = TRUE, dados=dadosWeibull)</span></span>
<span id="cb43-793"><a href="#cb43-793" aria-hidden="true" tabindex="-1"></a><span class="in">estimate</span></span>
<span id="cb43-794"><a href="#cb43-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-795"><a href="#cb43-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-796"><a href="#cb43-796" aria-hidden="true" tabindex="-1"></a>Assim como na distribuição exponencial, será feita uma comparação entre o real e estimado.</span>
<span id="cb43-797"><a href="#cb43-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-800"><a href="#cb43-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-801"><a href="#cb43-801" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb43-802"><a href="#cb43-802" aria-hidden="true" tabindex="-1"></a><span class="co"># AJUSTES DE FORMATAÇÃO</span></span>
<span id="cb43-803"><a href="#cb43-803" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb43-804"><a href="#cb43-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-805"><a href="#cb43-805" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb43-806"><a href="#cb43-806" aria-hidden="true" tabindex="-1"></a>StWeibull <span class="ot">&lt;-</span> <span class="cf">function</span>(t, gamma, alpha) <span class="fu">exp</span>(<span class="sc">-</span>(t<span class="sc">/</span>alpha)<span class="sc">^</span>gamma)</span>
<span id="cb43-807"><a href="#cb43-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-808"><a href="#cb43-808" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Frame</span></span>
<span id="cb43-809"><a href="#cb43-809" aria-hidden="true" tabindex="-1"></a>dfWeibull <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-810"><a href="#cb43-810" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tempo =</span> dadosWeibull,</span>
<span id="cb43-811"><a href="#cb43-811" aria-hidden="true" tabindex="-1"></a>  <span class="at">St =</span> <span class="fu">StWeibull</span>(dadosWeibull, wShape, wScale),</span>
<span id="cb43-812"><a href="#cb43-812" aria-hidden="true" tabindex="-1"></a>  <span class="at">EMVSt =</span> <span class="fu">StWeibull</span>(dadosWeibull, estimate<span class="sc">$</span>par[<span class="dv">1</span>], estimate<span class="sc">$</span>par[<span class="dv">2</span>])</span>
<span id="cb43-813"><a href="#cb43-813" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-814"><a href="#cb43-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-815"><a href="#cb43-815" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-816"><a href="#cb43-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-817"><a href="#cb43-817" aria-hidden="true" tabindex="-1"></a>Veja a @tbl-EMVweibullSt que mostra as dez primeiras observações e suas respectivas funções de sobrevivência, sobrevivência real e sobrevivência estimada.</span>
<span id="cb43-818"><a href="#cb43-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-819"><a href="#cb43-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb43-820"><a href="#cb43-820" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Real e Estimado para as Funções de Sobrevivência da Distribuição Weibull"</span></span>
<span id="cb43-821"><a href="#cb43-821" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-EMVweibullSt</span></span>
<span id="cb43-822"><a href="#cb43-822" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap-location: top</span></span>
<span id="cb43-823"><a href="#cb43-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-824"><a href="#cb43-824" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb43-825"><a href="#cb43-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-826"><a href="#cb43-826" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(head(dfWeibull), </span></span>
<span id="cb43-827"><a href="#cb43-827" aria-hidden="true" tabindex="-1"></a><span class="in">             col.names = c("Tempo", "S(t)", "S(t) EMV"),</span></span>
<span id="cb43-828"><a href="#cb43-828" aria-hidden="true" tabindex="-1"></a><span class="in">             escape = FALSE,</span></span>
<span id="cb43-829"><a href="#cb43-829" aria-hidden="true" tabindex="-1"></a><span class="in">             align = 'c',</span></span>
<span id="cb43-830"><a href="#cb43-830" aria-hidden="true" tabindex="-1"></a><span class="in">             booktabs = TRUE)</span></span>
<span id="cb43-831"><a href="#cb43-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-832"><a href="#cb43-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-833"><a href="#cb43-833" aria-hidden="true" tabindex="-1"></a>Temos também a comparação dessas duas curvas de sobrevivência, ilustradas na @fig-CompEMVWeibull.</span>
<span id="cb43-834"><a href="#cb43-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-835"><a href="#cb43-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb43-836"><a href="#cb43-836" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Comparação do verdadeiro valor dos parâmetros γ e α com suas estimativas de máxima verossimilhança."</span></span>
<span id="cb43-837"><a href="#cb43-837" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-CompEMVWeibull</span></span>
<span id="cb43-838"><a href="#cb43-838" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap-location: top</span></span>
<span id="cb43-839"><a href="#cb43-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-840"><a href="#cb43-840" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb43-841"><a href="#cb43-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-842"><a href="#cb43-842" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dfWeibull, aes(x = Tempo)) +</span></span>
<span id="cb43-843"><a href="#cb43-843" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = St, color = "Verdadeiro"), lwd = 2) +</span></span>
<span id="cb43-844"><a href="#cb43-844" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = EMVSt, color = "EMV"), lwd = 1, lty = 4) +</span></span>
<span id="cb43-845"><a href="#cb43-845" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb43-846"><a href="#cb43-846" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Verdadeiro" = "black", "EMV" = "red"),</span></span>
<span id="cb43-847"><a href="#cb43-847" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = c(</span></span>
<span id="cb43-848"><a href="#cb43-848" aria-hidden="true" tabindex="-1"></a><span class="in">      "Verdadeiro" = expression(paste("Verdadeiro: ", gamma, ", ", alpha)),</span></span>
<span id="cb43-849"><a href="#cb43-849" aria-hidden="true" tabindex="-1"></a><span class="in">      "EMV" = expression(paste("EMV: ", hat(gamma), ", ", hat(alpha)))</span></span>
<span id="cb43-850"><a href="#cb43-850" aria-hidden="true" tabindex="-1"></a><span class="in">    )) +</span></span>
<span id="cb43-851"><a href="#cb43-851" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb43-852"><a href="#cb43-852" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Tempo",</span></span>
<span id="cb43-853"><a href="#cb43-853" aria-hidden="true" tabindex="-1"></a><span class="in">    y = expression(S(t)), </span></span>
<span id="cb43-854"><a href="#cb43-854" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "Parâmetros") + </span></span>
<span id="cb43-855"><a href="#cb43-855" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb43-856"><a href="#cb43-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-857"><a href="#cb43-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-858"><a href="#cb43-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-859"><a href="#cb43-859" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Distribuição Log-Normal</span></span>
<span id="cb43-860"><a href="#cb43-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-861"><a href="#cb43-861" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Aplicações com Censura</span></span>
<span id="cb43-862"><a href="#cb43-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-863"><a href="#cb43-863" aria-hidden="true" tabindex="-1"></a>Podemos utilizar os conhecimentos até aqui obtidos para modelar e estimar parâmetros, e consequentemente, curvas de sobrevivência onde exista censura. Vejamos os blocos de códigos a seguir.</span>
<span id="cb43-864"><a href="#cb43-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-865"><a href="#cb43-865" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Ativamos os pacotes necessários:</span>
<span id="cb43-866"><a href="#cb43-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-869"><a href="#cb43-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-870"><a href="#cb43-870" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb43-871"><a href="#cb43-871" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] Ativação de Pacotes</span></span>
<span id="cb43-872"><a href="#cb43-872" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb43-873"><a href="#cb43-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-874"><a href="#cb43-874" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb43-875"><a href="#cb43-875" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-876"><a href="#cb43-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-877"><a href="#cb43-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-878"><a href="#cb43-878" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Simulamos os dados com censura:</span>
<span id="cb43-879"><a href="#cb43-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-882"><a href="#cb43-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-883"><a href="#cb43-883" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb43-884"><a href="#cb43-884" aria-hidden="true" tabindex="-1"></a><span class="co"># [2] Simulação dos Dados</span></span>
<span id="cb43-885"><a href="#cb43-885" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------</span></span>
<span id="cb43-886"><a href="#cb43-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-887"><a href="#cb43-887" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo Semente</span></span>
<span id="cb43-888"><a href="#cb43-888" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-889"><a href="#cb43-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-890"><a href="#cb43-890" aria-hidden="true" tabindex="-1"></a><span class="co"># Parâmetros</span></span>
<span id="cb43-891"><a href="#cb43-891" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>       <span class="co"># Número total de observações</span></span>
<span id="cb43-892"><a href="#cb43-892" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="dv">2</span>      <span class="co"># Parâmetro shape da Weibull</span></span>
<span id="cb43-893"><a href="#cb43-893" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">1.5</span>    <span class="co"># Parâmetro scale da Weibull</span></span>
<span id="cb43-894"><a href="#cb43-894" aria-hidden="true" tabindex="-1"></a>TaxaExp <span class="ot">&lt;-</span> <span class="dv">1</span>    <span class="co"># Taxa da distribuição exponencial</span></span>
<span id="cb43-895"><a href="#cb43-895" aria-hidden="true" tabindex="-1"></a>propCens <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="co"># Proporção desejada de censuras</span></span>
<span id="cb43-896"><a href="#cb43-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-897"><a href="#cb43-897" aria-hidden="true" tabindex="-1"></a><span class="co"># Vetores para armazenar os resultados</span></span>
<span id="cb43-898"><a href="#cb43-898" aria-hidden="true" tabindex="-1"></a>Tobservado <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb43-899"><a href="#cb43-899" aria-hidden="true" tabindex="-1"></a>indCensura <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb43-900"><a href="#cb43-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-901"><a href="#cb43-901" aria-hidden="true" tabindex="-1"></a><span class="co"># Contadores</span></span>
<span id="cb43-902"><a href="#cb43-902" aria-hidden="true" tabindex="-1"></a>nFalhas <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-903"><a href="#cb43-903" aria-hidden="true" tabindex="-1"></a>nCensuras <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-904"><a href="#cb43-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-905"><a href="#cb43-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop para gerar os tempos</span></span>
<span id="cb43-906"><a href="#cb43-906" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb43-907"><a href="#cb43-907" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gerar um tempo de falha e um tempo de censura</span></span>
<span id="cb43-908"><a href="#cb43-908" aria-hidden="true" tabindex="-1"></a>  Tfalha <span class="ot">&lt;-</span> <span class="fu">rweibull</span>(<span class="dv">1</span>, <span class="at">shape =</span> gamma, <span class="at">scale =</span> alpha)</span>
<span id="cb43-909"><a href="#cb43-909" aria-hidden="true" tabindex="-1"></a>  Tcensu <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1</span>, <span class="at">rate =</span> TaxaExp)</span>
<span id="cb43-910"><a href="#cb43-910" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-911"><a href="#cb43-911" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar qual é o menor tempo</span></span>
<span id="cb43-912"><a href="#cb43-912" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (Tfalha <span class="sc">&lt;=</span> Tcensu) {</span>
<span id="cb43-913"><a href="#cb43-913" aria-hidden="true" tabindex="-1"></a>    Tobservado[i] <span class="ot">&lt;-</span> Tfalha</span>
<span id="cb43-914"><a href="#cb43-914" aria-hidden="true" tabindex="-1"></a>    indCensura[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Falha</span></span>
<span id="cb43-915"><a href="#cb43-915" aria-hidden="true" tabindex="-1"></a>    nFalhas <span class="ot">&lt;-</span> nFalhas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-916"><a href="#cb43-916" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb43-917"><a href="#cb43-917" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nCensuras <span class="sc">&lt;</span> propCens <span class="sc">*</span> n) {</span>
<span id="cb43-918"><a href="#cb43-918" aria-hidden="true" tabindex="-1"></a>      Tobservado[i] <span class="ot">&lt;-</span> Tcensu</span>
<span id="cb43-919"><a href="#cb43-919" aria-hidden="true" tabindex="-1"></a>      indCensura[i] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Censura</span></span>
<span id="cb43-920"><a href="#cb43-920" aria-hidden="true" tabindex="-1"></a>      nCensuras <span class="ot">&lt;-</span> nCensuras <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-921"><a href="#cb43-921" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb43-922"><a href="#cb43-922" aria-hidden="true" tabindex="-1"></a>      Tobservado[i] <span class="ot">&lt;-</span> Tfalha</span>
<span id="cb43-923"><a href="#cb43-923" aria-hidden="true" tabindex="-1"></a>      indCensura[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Falha</span></span>
<span id="cb43-924"><a href="#cb43-924" aria-hidden="true" tabindex="-1"></a>      nFalhas <span class="ot">&lt;-</span> nFalhas <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-925"><a href="#cb43-925" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-926"><a href="#cb43-926" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-927"><a href="#cb43-927" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-928"><a href="#cb43-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-929"><a href="#cb43-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar as proporções</span></span>
<span id="cb43-930"><a href="#cb43-930" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporção de falhas:"</span>, nFalhas <span class="sc">/</span> n, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-931"><a href="#cb43-931" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporção de censuras:"</span>, nCensuras <span class="sc">/</span> n, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-932"><a href="#cb43-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-933"><a href="#cb43-933" aria-hidden="true" tabindex="-1"></a><span class="co"># Dados simulados</span></span>
<span id="cb43-934"><a href="#cb43-934" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Tempo =</span> Tobservado, <span class="at">Censura =</span> indCensura)</span>
<span id="cb43-935"><a href="#cb43-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-936"><a href="#cb43-936" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma</span></span>
<span id="cb43-937"><a href="#cb43-937" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dados, <span class="fu">aes</span>(<span class="at">x =</span> Tempo)) <span class="sc">+</span></span>
<span id="cb43-938"><a href="#cb43-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb43-939"><a href="#cb43-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histograma do Tempo de Sobrevivência - Simulação"</span>,</span>
<span id="cb43-940"><a href="#cb43-940" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Frequência"</span>) <span class="sc">+</span></span>
<span id="cb43-941"><a href="#cb43-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb43-942"><a href="#cb43-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb43-943"><a href="#cb43-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-944"><a href="#cb43-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-945"><a href="#cb43-945" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Estimação Não Paramétrica.</span>
<span id="cb43-946"><a href="#cb43-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-949"><a href="#cb43-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-950"><a href="#cb43-950" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-951"><a href="#cb43-951" aria-hidden="true" tabindex="-1"></a><span class="co"># [3] Estimação</span></span>
<span id="cb43-952"><a href="#cb43-952" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------</span></span>
<span id="cb43-953"><a href="#cb43-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-954"><a href="#cb43-954" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb43-955"><a href="#cb43-955" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.1] Estimação Não Paramátrica</span></span>
<span id="cb43-956"><a href="#cb43-956" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb43-957"><a href="#cb43-957" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb43-958"><a href="#cb43-958" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.1.1] Estimador de Kaplan-Meier</span></span>
<span id="cb43-959"><a href="#cb43-959" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------</span></span>
<span id="cb43-960"><a href="#cb43-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-961"><a href="#cb43-961" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo de Kaplan-Meier</span></span>
<span id="cb43-962"><a href="#cb43-962" aria-hidden="true" tabindex="-1"></a>ekm <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(Tempo, Censura) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dados)</span>
<span id="cb43-963"><a href="#cb43-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-964"><a href="#cb43-964" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatando como DataFrame</span></span>
<span id="cb43-965"><a href="#cb43-965" aria-hidden="true" tabindex="-1"></a>DataEKM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> ekm<span class="sc">$</span>time, <span class="at">Survival =</span> ekm<span class="sc">$</span>surv, <span class="at">Type =</span> <span class="st">"Kaplan-Meier"</span>)</span>
<span id="cb43-966"><a href="#cb43-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-967"><a href="#cb43-967" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização da curva</span></span>
<span id="cb43-968"><a href="#cb43-968" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> DataEKM, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb43-969"><a href="#cb43-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb43-970"><a href="#cb43-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t) - Kaplan-Meier"</span>,</span>
<span id="cb43-971"><a href="#cb43-971" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb43-972"><a href="#cb43-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb43-973"><a href="#cb43-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb43-974"><a href="#cb43-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-975"><a href="#cb43-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-976"><a href="#cb43-976" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Estimação Não Paramétrica - Distribuição Exponencial.</span>
<span id="cb43-977"><a href="#cb43-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-980"><a href="#cb43-980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-981"><a href="#cb43-981" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb43-982"><a href="#cb43-982" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.2] Estimação Paramátrica</span></span>
<span id="cb43-983"><a href="#cb43-983" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb43-984"><a href="#cb43-984" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------</span></span>
<span id="cb43-985"><a href="#cb43-985" aria-hidden="true" tabindex="-1"></a><span class="co"># [3.2.1] Distribuição Exponencial</span></span>
<span id="cb43-986"><a href="#cb43-986" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------</span></span>
<span id="cb43-987"><a href="#cb43-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-988"><a href="#cb43-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Sobrevivência</span></span>
<span id="cb43-989"><a href="#cb43-989" aria-hidden="true" tabindex="-1"></a>Stexp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, alpha) <span class="fu">exp</span>(<span class="sc">-</span>alpha <span class="sc">*</span> t)</span>
<span id="cb43-990"><a href="#cb43-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-991"><a href="#cb43-991" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV de α</span></span>
<span id="cb43-992"><a href="#cb43-992" aria-hidden="true" tabindex="-1"></a>emvExp <span class="ot">&lt;-</span> <span class="fu">sum</span>(dados<span class="sc">$</span>Censura) <span class="sc">/</span> <span class="fu">sum</span>(dados<span class="sc">$</span>Tempo)</span>
<span id="cb43-993"><a href="#cb43-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-994"><a href="#cb43-994" aria-hidden="true" tabindex="-1"></a><span class="co"># EMV da Sobrevivência</span></span>
<span id="cb43-995"><a href="#cb43-995" aria-hidden="true" tabindex="-1"></a>EMVSurvExp <span class="ot">&lt;-</span> <span class="fu">Stexp</span>(dados<span class="sc">$</span>Tempo, emvExp)</span>
<span id="cb43-996"><a href="#cb43-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-997"><a href="#cb43-997" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatando como DataFrame</span></span>
<span id="cb43-998"><a href="#cb43-998" aria-hidden="true" tabindex="-1"></a>DataExp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> dados<span class="sc">$</span>Tempo, <span class="at">Survival =</span> EMVSurvExp, <span class="at">Type =</span> <span class="st">"Exponencial"</span>)</span>
<span id="cb43-999"><a href="#cb43-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1000"><a href="#cb43-1000" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização da curva</span></span>
<span id="cb43-1001"><a href="#cb43-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> DataExp, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb43-1002"><a href="#cb43-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb43-1003"><a href="#cb43-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t) - Exponencial"</span>,</span>
<span id="cb43-1004"><a href="#cb43-1004" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb43-1005"><a href="#cb43-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb43-1006"><a href="#cb43-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb43-1007"><a href="#cb43-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1008"><a href="#cb43-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1009"><a href="#cb43-1009" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>4. Estimação Não Paramétrica - Distribuição Weibull.</span>
<span id="cb43-1010"><a href="#cb43-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1011"><a href="#cb43-1011" aria-hidden="true" tabindex="-1"></a>    <span class="in">```{r}</span></span>
<span id="cb43-1012"><a href="#cb43-1012" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------------</span></span>
<span id="cb43-1013"><a href="#cb43-1013" aria-hidden="true" tabindex="-1"></a><span class="in"># [3.2.1] Distribuição Weibull</span></span>
<span id="cb43-1014"><a href="#cb43-1014" aria-hidden="true" tabindex="-1"></a><span class="in"># ----------------------------</span></span>
<span id="cb43-1015"><a href="#cb43-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1016"><a href="#cb43-1016" aria-hidden="true" tabindex="-1"></a><span class="in"># Função de Sobrevivência</span></span>
<span id="cb43-1017"><a href="#cb43-1017" aria-hidden="true" tabindex="-1"></a><span class="in">StWeibull &lt;- function(t, gamma, alpha) exp(-(t / alpha)^gamma)</span></span>
<span id="cb43-1018"><a href="#cb43-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1019"><a href="#cb43-1019" aria-hidden="true" tabindex="-1"></a><span class="in"># EMV de γ e α</span></span>
<span id="cb43-1020"><a href="#cb43-1020" aria-hidden="true" tabindex="-1"></a><span class="in"># 1. Função Log-verossimilhança</span></span>
<span id="cb43-1021"><a href="#cb43-1021" aria-hidden="true" tabindex="-1"></a><span class="in">logWeibull &lt;- function(theta, dados){</span></span>
<span id="cb43-1022"><a href="#cb43-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- theta[1] # Parâmetro de forma</span></span>
<span id="cb43-1023"><a href="#cb43-1023" aria-hidden="true" tabindex="-1"></a><span class="in">  alpha &lt;- theta[2] # Parâmetro de escala</span></span>
<span id="cb43-1024"><a href="#cb43-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb43-1025"><a href="#cb43-1025" aria-hidden="true" tabindex="-1"></a><span class="in">  t &lt;- dados$Tempo   # Tempo de falha</span></span>
<span id="cb43-1026"><a href="#cb43-1026" aria-hidden="true" tabindex="-1"></a><span class="in">  c &lt;- dados$Censura # Variável indicadora</span></span>
<span id="cb43-1027"><a href="#cb43-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb43-1028"><a href="#cb43-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  logv &lt;- (sum(c) * log(gamma)) - (gamma * log(alpha) * sum(c)) +</span></span>
<span id="cb43-1029"><a href="#cb43-1029" aria-hidden="true" tabindex="-1"></a><span class="in">    (gamma - 1) * sum(c * log(t)) - sum((t / alpha)^gamma)</span></span>
<span id="cb43-1030"><a href="#cb43-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  return(-logv)</span></span>
<span id="cb43-1031"><a href="#cb43-1031" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb43-1032"><a href="#cb43-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1033"><a href="#cb43-1033" aria-hidden="true" tabindex="-1"></a><span class="in"># 2. Otimizando</span></span>
<span id="cb43-1034"><a href="#cb43-1034" aria-hidden="true" tabindex="-1"></a><span class="in">Theta0 &lt;- c(1.5, 1)</span></span>
<span id="cb43-1035"><a href="#cb43-1035" aria-hidden="true" tabindex="-1"></a><span class="in">estimate &lt;- optim(par = Theta0, fn = logWeibull,</span></span>
<span id="cb43-1036"><a href="#cb43-1036" aria-hidden="true" tabindex="-1"></a><span class="in">                  gr = NULL, method = "BFGS", hessian = TRUE, dados = dados)</span></span>
<span id="cb43-1037"><a href="#cb43-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1038"><a href="#cb43-1038" aria-hidden="true" tabindex="-1"></a><span class="in">estimate</span></span>
<span id="cb43-1039"><a href="#cb43-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1040"><a href="#cb43-1040" aria-hidden="true" tabindex="-1"></a><span class="in"># EMV da Sobrevivência</span></span>
<span id="cb43-1041"><a href="#cb43-1041" aria-hidden="true" tabindex="-1"></a><span class="in">EMVSurvWeib &lt;- StWeibull(dados$Tempo, estimate$par[1], estimate$par[2])</span></span>
<span id="cb43-1042"><a href="#cb43-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1043"><a href="#cb43-1043" aria-hidden="true" tabindex="-1"></a><span class="in"># Formatando como DataFrame</span></span>
<span id="cb43-1044"><a href="#cb43-1044" aria-hidden="true" tabindex="-1"></a><span class="in">DataWeib &lt;- data.frame(Time = dados$Tempo, Survival = EMVSurvWeib, Type = "Weibull")</span></span>
<span id="cb43-1045"><a href="#cb43-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1046"><a href="#cb43-1046" aria-hidden="true" tabindex="-1"></a><span class="in"># Visualização da curva</span></span>
<span id="cb43-1047"><a href="#cb43-1047" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = DataWeib, aes(x = Time, y = Survival)) +</span></span>
<span id="cb43-1048"><a href="#cb43-1048" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(color = "green", lwd = 1.5) +</span></span>
<span id="cb43-1049"><a href="#cb43-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "S(t) - Weibull",</span></span>
<span id="cb43-1050"><a href="#cb43-1050" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Tempo", y = "Probabilidade de Sobrevivência") +</span></span>
<span id="cb43-1051"><a href="#cb43-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_size = 14) +</span></span>
<span id="cb43-1052"><a href="#cb43-1052" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, face = "bold"))</span></span>
<span id="cb43-1053"><a href="#cb43-1053" aria-hidden="true" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb43-1054"><a href="#cb43-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1055"><a href="#cb43-1055" aria-hidden="true" tabindex="-1"></a>Por fim, com o objetivo de fazer uma comparação, visual, temos a Figura abaixo.</span>
<span id="cb43-1056"><a href="#cb43-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1059"><a href="#cb43-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-1060"><a href="#cb43-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------</span></span>
<span id="cb43-1061"><a href="#cb43-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] Análise Conjunta</span></span>
<span id="cb43-1062"><a href="#cb43-1062" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------</span></span>
<span id="cb43-1063"><a href="#cb43-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1064"><a href="#cb43-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># Unindo os dados para visualização</span></span>
<span id="cb43-1065"><a href="#cb43-1065" aria-hidden="true" tabindex="-1"></a>AllData <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DataEKM, DataExp, DataWeib)</span>
<span id="cb43-1066"><a href="#cb43-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1067"><a href="#cb43-1067" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico com ggplot2</span></span>
<span id="cb43-1068"><a href="#cb43-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(AllData, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Survival)) <span class="sc">+</span></span>
<span id="cb43-1069"><a href="#cb43-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Type, <span class="at">linetype =</span> Type), <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb43-1070"><a href="#cb43-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"S(t): Kaplan-Meier, Weibull e Exponencial"</span>,</span>
<span id="cb43-1071"><a href="#cb43-1071" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tempo"</span>, <span class="at">y =</span> <span class="st">"Probabilidade de Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb43-1072"><a href="#cb43-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb43-1073"><a href="#cb43-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb43-1074"><a href="#cb43-1074" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-1075"><a href="#cb43-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb43-1076"><a href="#cb43-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># c("solid", "dashed", "dotted")</span></span>
<span id="cb43-1077"><a href="#cb43-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-1078"><a href="#cb43-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1079"><a href="#cb43-1079" aria-hidden="true" tabindex="-1"></a>:::: progress</span>
<span id="cb43-1080"><a href="#cb43-1080" aria-hidden="true" tabindex="-1"></a>::: {.progress-bar style="width: 100%;"}</span>
<span id="cb43-1081"><a href="#cb43-1081" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-1082"><a href="#cb43-1082" aria-hidden="true" tabindex="-1"></a>::::</span>
</code><button title="Copiar para a área de transferência" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright: (<strong>SILVA, B.C.R - 2024</strong>)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Construído <a href="https://quarto.org/"> Pacote Quarto no R4.3</a>.</p>
</div>
  </div>
</footer>




</body></html>